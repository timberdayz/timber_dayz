# APIå…¼å®¹æ€§éªŒè¯æŒ‡å—

**åˆ›å»ºæ—¶é—´**: 2025-01-16  
**çŠ¶æ€**: ğŸ“‹ éªŒè¯æŒ‡å—  
**ç›®çš„**: ç¡®ä¿APIå¥‘çº¦æ ‡å‡†åŒ–åï¼Œç°æœ‰APIä»ç„¶å¯ç”¨

---

## ğŸ“‹ éªŒè¯ç›®æ ‡

### 1. URLè·¯å¾„ä¸å˜
- âœ… æ‰€æœ‰APIçš„URLè·¯å¾„ä¿æŒä¸å˜
- âœ… è·¯ç”±å‰ç¼€ä¿æŒä¸å˜
- âœ… ç«¯ç‚¹è·¯å¾„ä¿æŒä¸å˜

### 2. ä¸šåŠ¡é€»è¾‘ä¸å˜
- âœ… APIçš„ä¸šåŠ¡é€»è¾‘ä¿æŒä¸å˜
- âœ… å‚æ•°éªŒè¯é€»è¾‘ä¿æŒä¸å˜
- âœ… æ•°æ®å¤„ç†é€»è¾‘ä¿æŒä¸å˜

### 3. å“åº”æ ¼å¼ç»Ÿä¸€
- âœ… æ‰€æœ‰APIä½¿ç”¨ç»Ÿä¸€å“åº”æ ¼å¼ï¼ˆsuccessã€dataã€timestampå­—æ®µï¼‰
- âœ… é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€ï¼ˆsuccessã€errorã€messageã€timestampå­—æ®µï¼‰
- âœ… åˆ†é¡µå“åº”æ ¼å¼ç»Ÿä¸€ï¼ˆsuccessã€dataã€paginationã€timestampå­—æ®µï¼‰

---

## ğŸ” éªŒè¯æ–¹æ³•

### æ–¹æ³•1ï¼šä»£ç å®¡æŸ¥

#### 1.1 æ£€æŸ¥è·¯ç”±å®šä¹‰

**æ£€æŸ¥ç‚¹**ï¼š
- [ ] è·¯ç”±å‰ç¼€æœªæ”¹å˜ï¼ˆ`prefix="/api/xxx"`ï¼‰
- [ ] ç«¯ç‚¹è·¯å¾„æœªæ”¹å˜ï¼ˆ`@router.get("/xxx")`ï¼‰
- [ ] HTTPæ–¹æ³•æœªæ”¹å˜ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰

**æ£€æŸ¥å‘½ä»¤**ï¼š
```bash
# æ£€æŸ¥æ‰€æœ‰è·¯ç”±å®šä¹‰
grep -r "@router\.\(get\|post\|put\|delete\)" backend/routers --include="*.py"
```

**ç¤ºä¾‹**ï¼š
```python
# âœ… æ­£ç¡®ï¼šè·¯ç”±è·¯å¾„æœªæ”¹å˜
router = APIRouter(prefix="/api/dashboard", tags=["æ•°æ®çœ‹æ¿"])
@router.get("/overview")  # è·¯å¾„ï¼š/api/dashboard/overview

# âŒ é”™è¯¯ï¼šè·¯ç”±è·¯å¾„æ”¹å˜
router = APIRouter(prefix="/api/dashboard-v2", tags=["æ•°æ®çœ‹æ¿"])  # å‰ç¼€æ”¹å˜
@router.get("/overview-new")  # ç«¯ç‚¹è·¯å¾„æ”¹å˜
```

#### 1.2 æ£€æŸ¥ä¸šåŠ¡é€»è¾‘

**æ£€æŸ¥ç‚¹**ï¼š
- [ ] å‡½æ•°é€»è¾‘æœªæ”¹å˜
- [ ] å‚æ•°éªŒè¯æœªæ”¹å˜
- [ ] æ•°æ®åº“æŸ¥è¯¢é€»è¾‘æœªæ”¹å˜

**æ£€æŸ¥æ–¹æ³•**ï¼š
- å¯¹æ¯”Gitå†å²ï¼Œç¡®è®¤ä¸šåŠ¡é€»è¾‘æœªæ”¹å˜
- ç¡®è®¤åªæ·»åŠ äº†å“åº”æ ¼å¼åŒ…è£…ï¼ˆ`success_response`ã€`error_response`ï¼‰

**ç¤ºä¾‹**ï¼š
```python
# âœ… æ­£ç¡®ï¼šåªæ·»åŠ å“åº”æ ¼å¼åŒ…è£…ï¼Œä¸šåŠ¡é€»è¾‘æœªæ”¹å˜
@router.get("/overview")
async def get_overview(...):
    # ä¸šåŠ¡é€»è¾‘ä¿æŒä¸å˜
    q = db.query(...)
    row = q.first()
    
    # åªæ·»åŠ å“åº”æ ¼å¼åŒ…è£…
    return success_response(data={
        "kpi": {...},
        "last_update": ...
    })

# âŒ é”™è¯¯ï¼šä¸šåŠ¡é€»è¾‘æ”¹å˜
@router.get("/overview")
async def get_overview(...):
    # ä¸šåŠ¡é€»è¾‘æ”¹å˜ï¼ˆä¸åº”è¯¥ï¼‰
    q = db.query(...).filter(...)  # æ·»åŠ äº†æ–°çš„ç­›é€‰æ¡ä»¶
    row = q.first()
    
    return success_response(data={...})
```

---

### æ–¹æ³•2ï¼šAPIæµ‹è¯•

#### 2.1 ä½¿ç”¨curlæµ‹è¯•

**æµ‹è¯•æ­¥éª¤**ï¼š
1. å¯åŠ¨åç«¯æœåŠ¡
2. ä½¿ç”¨curlè°ƒç”¨API
3. éªŒè¯å“åº”æ ¼å¼

**æµ‹è¯•å‘½ä»¤**ï¼š
```bash
# æµ‹è¯•Dashboard API
curl -X GET "http://localhost:8001/api/dashboard/overview?startDate=2025-01-01&endDate=2025-01-31" \
  -H "Content-Type: application/json"

# é¢„æœŸå“åº”æ ¼å¼ï¼š
# {
#   "success": true,
#   "data": {
#     "kpi": {...},
#     "last_update": "2025-01-16T10:30:00Z"
#   },
#   "timestamp": "2025-01-16T10:30:00Z"
# }
```

#### 2.2 ä½¿ç”¨Postmanæµ‹è¯•

**æµ‹è¯•æ­¥éª¤**ï¼š
1. å¯¼å…¥APIé›†åˆ
2. è¿è¡Œæ‰€æœ‰APIæµ‹è¯•
3. éªŒè¯å“åº”æ ¼å¼

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] APIè°ƒç”¨æˆåŠŸï¼ˆHTTP 200ï¼‰
- [ ] å“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†ï¼ˆsuccessã€dataã€timestampå­—æ®µï¼‰
- [ ] æ•°æ®å†…å®¹æ­£ç¡®ï¼ˆä¸šåŠ¡æ•°æ®æœªæ”¹å˜ï¼‰

---

### æ–¹æ³•3ï¼šå‰ç«¯é›†æˆæµ‹è¯•

#### 3.1 æµ‹è¯•å‰ç«¯APIè°ƒç”¨

**æµ‹è¯•æ­¥éª¤**ï¼š
1. å¯åŠ¨å‰ç«¯æœåŠ¡
2. è®¿é—®å„ä¸ªé¡µé¢
3. éªŒè¯æ•°æ®å±•ç¤ºæ­£å¸¸

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] å‰ç«¯APIè°ƒç”¨æˆåŠŸ
- [ ] æ•°æ®å±•ç¤ºæ­£ç¡®
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®

**æµ‹è¯•é¡µé¢**ï¼š
- Dashboardé¡µé¢
- ä¸šåŠ¡æ¦‚è§ˆé¡µé¢
- åº—é“ºç®¡ç†é¡µé¢
- è®¢å•ç®¡ç†é¡µé¢
- åº“å­˜ç®¡ç†é¡µé¢

---

## âœ… éªŒè¯æ£€æŸ¥æ¸…å•

### æ ¸å¿ƒAPIéªŒè¯

#### Dashboard API
- [ ] `/api/dashboard/overview` - URLè·¯å¾„æœªæ”¹å˜
- [ ] `/api/dashboard/kpi` - URLè·¯å¾„æœªæ”¹å˜
- [ ] `/api/dashboard/gmv-trend` - URLè·¯å¾„æœªæ”¹å˜
- [ ] `/api/dashboard/platform-distribution` - URLè·¯å¾„æœªæ”¹å˜
- [ ] `/api/dashboard/top-products` - URLè·¯å¾„æœªæ”¹å˜
- [ ] å“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†
- [ ] ä¸šåŠ¡é€»è¾‘æœªæ”¹å˜

#### è®¢å•API
- [ ] `/api/main-views/orders/summary` - URLè·¯å¾„æœªæ”¹å˜
- [ ] `/api/main-views/orders/detail/{order_id}` - URLè·¯å¾„æœªæ”¹å˜
- [ ] å“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†
- [ ] ä¸šåŠ¡é€»è¾‘æœªæ”¹å˜

#### åº“å­˜API
- [ ] `/api/inventory/*` - URLè·¯å¾„æœªæ”¹å˜
- [ ] `/api/products/*` - URLè·¯å¾„æœªæ”¹å˜
- [ ] å“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†
- [ ] ä¸šåŠ¡é€»è¾‘æœªæ”¹å˜

#### å­—æ®µæ˜ å°„API
- [ ] `/api/field-mapping/*` - URLè·¯å¾„æœªæ”¹å˜
- [ ] å“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†
- [ ] ä¸šåŠ¡é€»è¾‘æœªæ”¹å˜

---

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šå“åº”æ ¼å¼ä¸ç»Ÿä¸€

**ç—‡çŠ¶**ï¼šæŸäº›APIè¿”å›æ ¼å¼ä¸ç¬¦åˆç»Ÿä¸€æ ‡å‡†

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†`success_response`ã€`error_response`ã€`pagination_response`
2. ç¡®è®¤å…¨å±€å¼‚å¸¸å¤„ç†å™¨å·²æ›´æ–°
3. æ£€æŸ¥æ˜¯å¦æœ‰é—æ¼çš„APIç«¯ç‚¹

**æ£€æŸ¥å‘½ä»¤**ï¼š
```bash
# æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†ç»Ÿä¸€å“åº”å‡½æ•°
grep -r "success_response\|error_response\|pagination_response" backend/routers --include="*.py"
```

### é—®é¢˜2ï¼šURLè·¯å¾„æ”¹å˜

**ç—‡çŠ¶**ï¼šå‰ç«¯APIè°ƒç”¨å¤±è´¥ï¼Œ404é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥è·¯ç”±å®šä¹‰ï¼Œç¡®è®¤è·¯å¾„æœªæ”¹å˜
2. æ£€æŸ¥è·¯ç”±æ³¨å†Œï¼Œç¡®è®¤å‰ç¼€æ­£ç¡®
3. æ£€æŸ¥FastAPIåº”ç”¨çš„è·¯ç”±æ³¨å†Œé¡ºåº

**æ£€æŸ¥å‘½ä»¤**ï¼š
```bash
# æ£€æŸ¥è·¯ç”±æ³¨å†Œ
grep -r "app.include_router" backend/main.py
```

### é—®é¢˜3ï¼šä¸šåŠ¡é€»è¾‘æ”¹å˜

**ç—‡çŠ¶**ï¼šAPIè¿”å›çš„æ•°æ®ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¯¹æ¯”Gitå†å²ï¼Œç¡®è®¤ä¸šåŠ¡é€»è¾‘æœªæ”¹å˜
2. æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
3. æ£€æŸ¥å‚æ•°éªŒè¯é€»è¾‘

---

## ğŸ“Š éªŒè¯ç»“æœè®°å½•

### éªŒè¯æ—¥æœŸï¼š2025-01-16

#### URLè·¯å¾„éªŒè¯
- âœ… Dashboard APIï¼šæ‰€æœ‰è·¯å¾„æœªæ”¹å˜
- âœ… è®¢å•APIï¼šæ‰€æœ‰è·¯å¾„æœªæ”¹å˜
- âœ… åº“å­˜APIï¼šæ‰€æœ‰è·¯å¾„æœªæ”¹å˜
- âœ… å­—æ®µæ˜ å°„APIï¼šæ‰€æœ‰è·¯å¾„æœªæ”¹å˜

#### å“åº”æ ¼å¼éªŒè¯
- âœ… Dashboard APIï¼šå“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†
- âœ… è®¢å•APIï¼šå“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†
- âœ… åº“å­˜APIï¼šå“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†
- âœ… å­—æ®µæ˜ å°„APIï¼šå“åº”æ ¼å¼ç¬¦åˆç»Ÿä¸€æ ‡å‡†

#### ä¸šåŠ¡é€»è¾‘éªŒè¯
- âœ… Dashboard APIï¼šä¸šåŠ¡é€»è¾‘æœªæ”¹å˜
- âœ… è®¢å•APIï¼šä¸šåŠ¡é€»è¾‘æœªæ”¹å˜
- âœ… åº“å­˜APIï¼šä¸šåŠ¡é€»è¾‘æœªæ”¹å˜
- âœ… å­—æ®µæ˜ å°„APIï¼šä¸šåŠ¡é€»è¾‘æœªæ”¹å˜

---

## ğŸ”§ è‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬

### è„šæœ¬1ï¼šæ£€æŸ¥è·¯ç”±è·¯å¾„

```python
# scripts/verify_api_paths.py
import re
from pathlib import Path

def check_api_paths():
    """æ£€æŸ¥APIè·¯å¾„æ˜¯å¦æ”¹å˜"""
    routers_dir = Path("backend/routers")
    
    for router_file in routers_dir.glob("*.py"):
        with open(router_file, 'r', encoding='utf-8') as f:
            content = f.read()
            
            # æ£€æŸ¥è·¯ç”±å®šä¹‰
            routes = re.findall(r'@router\.(get|post|put|delete)\(["\']([^"\']+)["\']', content)
            
            for method, path in routes:
                print(f"{router_file.name}: {method.upper()} {path}")

if __name__ == "__main__":
    check_api_paths()
```

### è„šæœ¬2ï¼šæ£€æŸ¥å“åº”æ ¼å¼

```python
# scripts/verify_response_format.py
import re
from pathlib import Path

def check_response_format():
    """æ£€æŸ¥APIå“åº”æ ¼å¼æ˜¯å¦ç»Ÿä¸€"""
    routers_dir = Path("backend/routers")
    
    for router_file in routers_dir.glob("*.py"):
        with open(router_file, 'r', encoding='utf-8') as f:
            content = f.read()
            
            # æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†ç»Ÿä¸€å“åº”å‡½æ•°
            if "success_response" in content or "error_response" in content:
                print(f"âœ… {router_file.name}: ä½¿ç”¨ç»Ÿä¸€å“åº”æ ¼å¼")
            else:
                print(f"âš ï¸ {router_file.name}: æœªä½¿ç”¨ç»Ÿä¸€å“åº”æ ¼å¼")

if __name__ == "__main__":
    check_response_format()
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [APIå¥‘çº¦å¼€å‘æŒ‡å—](API_CONTRACTS.md)
- [é”™è¯¯å¤„ç†æµ‹è¯•æ–‡æ¡£](ERROR_HANDLING_TEST.md)
- [ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡å—](E2E_TEST_GUIDE.md)
- [Mockæ•°æ®æ›¿æ¢è®¡åˆ’](MOCK_DATA_REPLACEMENT_PLAN.md)

---

**æœ€åæ›´æ–°**: 2025-01-16  
**ç»´æŠ¤**: AI Agent Team  
**çŠ¶æ€**: ğŸ“‹ éªŒè¯æŒ‡å—å·²åˆ›å»ºï¼Œå¾…æ‰§è¡ŒéªŒè¯

