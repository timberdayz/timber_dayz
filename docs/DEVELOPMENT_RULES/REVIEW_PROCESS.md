# 规则审查流程和责任人

**版本**: v4.12.0  
**创建时间**: 2025-11-20  
**状态**: ✅ 已完成

---

## 📋 概述

本文档定义规则审查的流程和责任人，确保数据库设计规则得到有效执行。

---

## 👥 责任人

### 1. 开发人员职责

**职责**:
- 遵循数据库设计规范
- 提交代码前完成自查
- 修复审查发现的问题
- 更新相关文档

**自查清单**:
- [ ] 运行数据库设计验证工具
- [ ] 运行数据入库流程验证
- [ ] 运行字段映射验证
- [ ] 检查代码是否符合检查清单

---

### 2. 代码审查人员职责

**职责**:
- 审查代码是否符合数据库设计规范
- 使用检查清单进行审查
- 提供修复建议
- 批准或拒绝代码合并

**审查清单**:
- [ ] 数据库模型定义审查
- [ ] 数据入库流程审查
- [ ] 字段映射审查
- [ ] 物化视图设计审查
- [ ] 数据验证审查

---

### 3. 数据库管理员职责

**职责**:
- 审查数据库变更（表结构、索引、外键等）
- 执行数据库迁移
- 监控数据库性能
- 维护数据库文档

**审查清单**:
- [ ] 表结构变更审查
- [ ] 索引变更审查
- [ ] 外键约束变更审查
- [ ] 物化视图变更审查

---

## 🔄 审查流程

### 1. 代码提交前自查

**流程**:
1. 开发人员完成代码开发
2. 运行验证工具进行自查
3. 修复发现的问题
4. 提交代码

**验证工具**:
- `python scripts/review_schema_compliance.py`
- `GET /api/database-design/validate`
- `GET /api/database-design/validate/data-ingestion`
- `GET /api/database-design/validate/field-mapping`

---

### 2. 代码审查

**流程**:
1. 代码审查人员接收审查请求
2. 使用检查清单进行审查
3. 记录发现的问题
4. 提供修复建议
5. 批准或拒绝代码合并

**审查工具**:
- [代码审查检查清单](CODE_REVIEW_CHECKLIST.md)
- [数据库设计规则示例](DATABASE_DESIGN_EXAMPLES.md)

---

### 3. 数据库变更审查

**流程**:
1. 开发人员创建Alembic迁移脚本
2. 数据库管理员审查迁移脚本
3. 测试迁移脚本（开发环境）
4. 执行迁移（生产环境）
5. 验证变更结果

**审查工具**:
- [数据库变更检查清单](DATABASE_CHANGE_CHECKLIST.md)
- 数据库设计验证工具

---

### 4. 定期审查

**流程**:
1. 定期运行数据库设计验证工具
2. 审查验证报告
3. 修复发现的问题
4. 更新文档

**频率**:
- 每周一次（开发阶段）
- 每月一次（生产阶段）

---

## 📊 审查结果处理

### 1. 问题分类

**问题级别**:
- **错误（Error）**: 必须修复，不允许合并
- **警告（Warning）**: 建议修复，可以合并但需要记录
- **信息（Info）**: 可选修复，可以合并

---

### 2. 问题处理流程

**错误级别问题**:
1. 记录问题
2. 要求开发人员修复
3. 重新审查修复后的代码
4. 批准合并（修复后）

**警告级别问题**:
1. 记录问题
2. 提供修复建议
3. 可以合并，但需要在后续版本中修复
4. 跟踪问题状态

**信息级别问题**:
1. 记录问题
2. 可选修复
3. 可以合并

---

### 3. 审查报告

**报告内容**:
- 审查日期和时间
- 审查人员
- 审查范围
- 发现的问题（按级别分类）
- 修复建议
- 审查结论（通过/不通过）

**报告格式**:
- Markdown文档
- JSON格式（API返回）
- 控制台输出（脚本运行）

---

## 🔧 审查工具

### 1. 自动化验证工具

**工具列表**:
- 数据库设计验证工具（`database_design_validator.py`）
- 数据入库流程验证工具（`data_ingestion_validator.py`）
- 字段映射验证工具（`field_mapping_validator.py`）
- Schema.py合规性审查脚本（`review_schema_compliance.py`）

**使用方法**:
```bash
# 运行数据库设计验证
python scripts/review_schema_compliance.py

# 运行API验证
curl http://localhost:8001/api/database-design/validate
```

---

### 2. 检查清单文档

**文档列表**:
- [代码审查检查清单](CODE_REVIEW_CHECKLIST.md)
- [数据库变更检查清单](DATABASE_CHANGE_CHECKLIST.md)
- [数据库设计检查清单](DATABASE_DESIGN_CHECKLIST.md)

---

## 📝 审查记录

### 审查记录格式

**记录内容**:
- 审查ID（唯一标识）
- 审查日期和时间
- 审查人员
- 审查范围（文件、表、API等）
- 发现的问题列表
- 修复状态
- 审查结论

**记录位置**:
- Git提交信息
- 审查报告文档
- 问题跟踪系统（如需要）

---

## 🎯 审查目标

### 1. 质量目标

**目标指标**:
- 错误级别问题：0个
- 警告级别问题：≤5个
- 代码审查覆盖率：100%
- 数据库变更审查覆盖率：100%

---

### 2. 效率目标

**目标指标**:
- 代码审查时间：≤2小时
- 数据库变更审查时间：≤4小时
- 问题修复时间：≤1天

---

## 📚 相关文档

- [代码审查检查清单](CODE_REVIEW_CHECKLIST.md)
- [数据库变更检查清单](DATABASE_CHANGE_CHECKLIST.md)
- [数据库设计检查清单](DATABASE_DESIGN_CHECKLIST.md)
- [数据库设计规则示例](DATABASE_DESIGN_EXAMPLES.md)

---

**最后更新**: 2025-11-20  
**维护**: AI Agent Team  
**状态**: ✅ 已完成

