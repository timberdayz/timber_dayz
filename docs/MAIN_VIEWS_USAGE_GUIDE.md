# ä¸»è§†å›¾å’Œè¾…åŠ©è§†å›¾ä½¿ç”¨æŒ‡å—

**ç‰ˆæœ¬**: v4.12.0  
**åˆ›å»ºæ—¶é—´**: 2025-11-20  
**è®¾è®¡æ ‡å‡†**: Hub-and-Spokeæ¨¡å‹

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜ä¸»è§†å›¾å’Œè¾…åŠ©è§†å›¾çš„ä½¿ç”¨åœºæ™¯ï¼Œå¸®åŠ©å‰ç«¯å¼€å‘äººå‘˜æ­£ç¡®é€‰æ‹©æŸ¥è¯¢æ¥å£ã€‚

### æ ¸å¿ƒåŸåˆ™

- **ä¸»è§†å›¾ï¼ˆHubï¼‰**ï¼šä¼˜å…ˆä½¿ç”¨ä¸»è§†å›¾æŸ¥è¯¢æ•°æ®åŸŸçš„æ‰€æœ‰æ ¸å¿ƒä¿¡æ¯
- **è¾…åŠ©è§†å›¾ï¼ˆSpokeï¼‰**ï¼šä»…ç”¨äºç‰¹å®šåˆ†æåœºæ™¯

---

## ğŸ¯ ä¸»è§†å›¾åˆ—è¡¨

### 1. ProductsåŸŸä¸»è§†å›¾ï¼š`mv_product_management`

**ç”¨é€”**ï¼šå•†å“é”€å”®è¡¨ç°æ•°æ®æŸ¥è¯¢

**æ ¸å¿ƒå­—æ®µ**ï¼š
- SKUã€åç§°ã€ä»·æ ¼ã€åº“å­˜
- é”€é‡ã€é”€å”®é¢ã€æµé‡ã€è½¬åŒ–ç‡
- å¥åº·åº¦è¯„åˆ†ã€é£é™©ç­‰çº§

**APIç«¯ç‚¹**ï¼š
- `GET /api/products/management`ï¼ˆé€šè¿‡inventory_managementè·¯ç”±ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- äº§å“ç®¡ç†é¡µé¢
- å•†å“åˆ—è¡¨æŸ¥è¯¢
- äº§å“å¥åº·åº¦ç›‘æ§

---

### 2. OrdersåŸŸä¸»è§†å›¾ï¼š`mv_order_summary`

**ç”¨é€”**ï¼šè®¢å•æ±‡æ€»æ•°æ®æŸ¥è¯¢

**æ ¸å¿ƒå­—æ®µ**ï¼š
- è®¢å•IDã€æ—¥æœŸã€é‡‘é¢ã€çŠ¶æ€
- å•†å“ä¿¡æ¯ï¼ˆèšåˆï¼‰ï¼šitem_count, total_quantity, sku_list
- ä¹°å®¶ä¿¡æ¯ï¼šbuyer_id, buyer_name

**APIç«¯ç‚¹**ï¼š
- `GET /api/main-views/orders/summary` â­æ–°å¢

**ä½¿ç”¨åœºæ™¯**ï¼š
- è®¢å•ç®¡ç†é¡µé¢
- è®¢å•åˆ—è¡¨æŸ¥è¯¢
- è®¢å•æ±‡æ€»åˆ†æ

---

### 3. OrdersåŸŸäº§å“çº§åˆ«è§†å›¾ï¼š`mv_sales_detail_by_product`

**ç”¨é€”**ï¼šä»¥product_idä¸ºåŸå­çº§çš„é”€å”®æ˜ç»†æŸ¥è¯¢

**æ ¸å¿ƒå­—æ®µ**ï¼š
- product_idï¼ˆäº§å“ID/SNï¼‰
- è®¢å•ä¿¡æ¯ã€ä»·æ ¼ä¿¡æ¯ã€åº—é“ºä¿¡æ¯
- æˆæœ¬ã€æ¯›åˆ©

**APIç«¯ç‚¹**ï¼š
- `GET /api/management/sales-detail-by-product`

**ä½¿ç”¨åœºæ™¯**ï¼š
- äº§å“çº§åˆ«é”€å”®æ˜ç»†æŸ¥è¯¢
- ç±»ä¼¼åä¸ºISRPçš„é”€å”®æ˜ç»†è¡¨
- äº§å“è¿½æº¯å’Œçº çº·å¤„ç†

---

### 4. TrafficåŸŸä¸»è§†å›¾ï¼š`mv_traffic_summary`

**ç”¨é€”**ï¼šæµé‡æ±‡æ€»æ•°æ®æŸ¥è¯¢

**æ ¸å¿ƒå­—æ®µ**ï¼š
- shop_idã€æ—¥æœŸã€UVã€PV
- è½¬åŒ–ç‡ã€æœåŠ¡æŒ‡æ ‡
- è¯„ä»·æŒ‡æ ‡

**APIç«¯ç‚¹**ï¼š
- `GET /api/main-views/traffic/summary` â­æ–°å¢

**ä½¿ç”¨åœºæ™¯**ï¼š
- æµé‡åˆ†æé¡µé¢
- åº—é“ºæµé‡ç›‘æ§
- è½¬åŒ–ç‡åˆ†æ

---

### 5. InventoryåŸŸä¸»è§†å›¾ï¼š`mv_inventory_by_sku`

**ç”¨é€”**ï¼šåº“å­˜æ˜ç»†æ•°æ®æŸ¥è¯¢ï¼ˆSKUçº§åˆ«ï¼‰

**æ ¸å¿ƒå­—æ®µ**ï¼š
- ä¸šåŠ¡æ ‡è¯†ï¼šplatform_code, shop_id, platform_sku, company_sku
- äº§å“ä¿¡æ¯ï¼šproduct_name, category, brand, specification, image_url
- åº“å­˜ä¿¡æ¯ï¼štotal_stock, available_stock, reserved_stock, in_transit_stock, stock_status
- ä»“åº“ä¿¡æ¯ï¼šwarehouse
- ä»·æ ¼ä¿¡æ¯ï¼šprice, price_rmb, inventory_value_rmb
- æ—¶é—´ç»´åº¦ï¼šsnapshot_date, granularity, period_start

**APIç«¯ç‚¹**ï¼š
- `GET /api/main-views/inventory/by-sku` â­æ–°å¢

**ä½¿ç”¨åœºæ™¯**ï¼š
- åº“å­˜ç®¡ç†é¡µé¢
- SKUçº§åˆ«åº“å­˜æ˜ç»†æŸ¥è¯¢
- åº“å­˜é¢„è­¦å’Œè¡¥è´§å»ºè®®

---

### 6. FinanceåŸŸä¸»è§†å›¾ï¼š`mv_financial_overview`

**ç”¨é€”**ï¼šè´¢åŠ¡æ¦‚è§ˆæ•°æ®æŸ¥è¯¢

**æ ¸å¿ƒå­—æ®µ**ï¼š
- æ”¶å…¥ã€æˆæœ¬ã€åˆ©æ¶¦
- ç¨è´¹ã€ç°é‡‘æµ

**APIç«¯ç‚¹**ï¼š
- `GET /api/finance/overview`ï¼ˆé€šè¿‡financeè·¯ç”±ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- è´¢åŠ¡æ¦‚è§ˆé¡µé¢
- æŸç›Šåˆ†æ
- è´¢åŠ¡æŠ¥è¡¨

---

## ğŸ”— è¾…åŠ©è§†å›¾åˆ—è¡¨

### ProductsåŸŸè¾…åŠ©è§†å›¾

- **mv_product_sales_trend**ï¼šé”€å”®è¶‹åŠ¿åˆ†æï¼ˆä¾èµ–mv_product_managementï¼‰
  - API: `GET /api/mv/query/sales-trend`
  - ç”¨é€”ï¼šæ—¶é—´åºåˆ—åˆ†æã€è¶‹åŠ¿é¢„æµ‹

- **mv_top_products**ï¼šTopNäº§å“æ’è¡Œï¼ˆä¾èµ–mv_product_managementï¼‰
  - API: `GET /api/mv/query/top-products`
  - ç”¨é€”ï¼šæ’è¡Œæ¦œã€æ˜æ˜Ÿäº§å“è¯†åˆ«

- **mv_shop_product_summary**ï¼šåº—é“ºç»´åº¦æ±‡æ€»ï¼ˆä¾èµ–mv_product_managementï¼‰
  - API: `GET /api/mv/query/shop-summary`
  - ç”¨é€”ï¼šåº—é“ºç»´åº¦åˆ†æã€å¤šåº—é“ºå¯¹æ¯”

### OrdersåŸŸè¾…åŠ©è§†å›¾

- **mv_daily_sales**ï¼šæ—¥åº¦é”€å”®æ±‡æ€»ï¼ˆä¾èµ–mv_order_summaryï¼‰
  - ç”¨é€”ï¼šæ—¥åº¦é”€å”®åˆ†æ

- **mv_weekly_sales**ï¼šå‘¨åº¦é”€å”®æ±‡æ€»ï¼ˆä¾èµ–mv_daily_salesï¼‰
  - ç”¨é€”ï¼šå‘¨åº¦é”€å”®åˆ†æ

- **mv_monthly_sales**ï¼šæœˆåº¦é”€å”®æ±‡æ€»ï¼ˆä¾èµ–mv_daily_salesï¼‰
  - ç”¨é€”ï¼šæœˆåº¦é”€å”®åˆ†æ

- **mv_order_sales_summary**ï¼šè®¢å•é”€å”®æ±‡æ€»ï¼ˆä¾èµ–mv_order_summaryï¼‰
  - ç”¨é€”ï¼šè®¢å•é”€å”®åˆ†æ

- **mv_sales_day_shop_sku**ï¼šæ—¥åº¦åº—é“ºSKUé”€å”®ï¼ˆä¾èµ–mv_order_summaryï¼‰
  - ç”¨é€”ï¼šåº—é“ºSKUç»´åº¦åˆ†æ

### TrafficåŸŸè¾…åŠ©è§†å›¾

- **mv_shop_traffic_day**ï¼šåº—é“ºæ—¥åº¦æµé‡ï¼ˆä¾èµ–mv_traffic_summaryï¼‰
  - ç”¨é€”ï¼šåº—é“ºæ—¥åº¦æµé‡åˆ†æ

---

## ğŸ“– ä½¿ç”¨å»ºè®®

### å‰ç«¯å¼€å‘æœ€ä½³å®è·µ

1. **ä¼˜å…ˆä½¿ç”¨ä¸»è§†å›¾**
   - æ•°æ®åŸŸçš„æ ¸å¿ƒä¿¡æ¯æŸ¥è¯¢ â†’ ä½¿ç”¨ä¸»è§†å›¾
   - ä¸€æ¬¡æ€§è·å–æ•°æ®åŸŸçš„æ‰€æœ‰æ ¸å¿ƒå­—æ®µ â†’ ä½¿ç”¨ä¸»è§†å›¾

2. **ç‰¹å®šåˆ†æåœºæ™¯ä½¿ç”¨è¾…åŠ©è§†å›¾**
   - æ—¶é—´åºåˆ—åˆ†æ â†’ ä½¿ç”¨mv_product_sales_trend
   - æ’è¡Œæ¦œæŸ¥è¯¢ â†’ ä½¿ç”¨mv_top_products
   - å¤šåº—é“ºå¯¹æ¯” â†’ ä½¿ç”¨mv_shop_product_summary

3. **æŸ¥è¯¢ç­–ç•¥**
   ```
   ä¸»è§†å›¾æŸ¥è¯¢ â†’ è·å–æ•°æ®åŸŸæ ¸å¿ƒä¿¡æ¯
   â†“
   è¾…åŠ©è§†å›¾æŸ¥è¯¢ â†’ ç‰¹å®šåˆ†æåœºæ™¯
   ```

### APIé€‰æ‹©æŒ‡å—

| æ•°æ®åŸŸ | ä¸»è§†å›¾API | è¾…åŠ©è§†å›¾API |
|--------|----------|------------|
| products | `/api/products/management` | `/api/mv/query/sales-trend`<br>`/api/mv/query/top-products` |
| orders | `/api/main-views/orders/summary` â­ | `/api/mv/query/*` |
| traffic | `/api/main-views/traffic/summary` â­ | `/api/mv/query/*` |
| inventory | `/api/main-views/inventory/by-sku` â­ | `/api/mv/query/*` |
| finance | `/api/finance/overview` | `/api/mv/query/*` |

---

## ğŸ”„ è§†å›¾åˆ·æ–°é¡ºåº

è§†å›¾åˆ·æ–°éµå¾ªä¾èµ–å…³ç³»ï¼š
1. **ä¸»è§†å›¾**ï¼ˆæ— ä¾èµ–ï¼Œç›´æ¥ä»äº‹å®è¡¨æŸ¥è¯¢ï¼‰
2. **è¾…åŠ©è§†å›¾**ï¼ˆä¾èµ–ä¸»è§†å›¾ï¼ŒæŒ‰ä¾èµ–å…³ç³»æ’åºï¼‰

åˆ·æ–°APIï¼š
- `POST /api/mv/refresh-all`ï¼šåˆ·æ–°æ‰€æœ‰è§†å›¾ï¼ˆè‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»ï¼‰

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [æ•°æ®åº“è®¾è®¡è§„èŒƒ](DEVELOPMENT_RULES/DATABASE_DESIGN.md)
- [ç‰©åŒ–è§†å›¾è®¾è®¡è§„åˆ™](openspec/changes/establish-database-design-rules/specs/database-design/spec.md)
- [MaterializedViewServiceæ–‡æ¡£](backend/services/materialized_view_service.py)

---

**æœ€åæ›´æ–°**: 2025-11-20  
**ç»´æŠ¤**: AI Agent Team  
**çŠ¶æ€**: âœ… æ­£å¼æ–‡æ¡£

