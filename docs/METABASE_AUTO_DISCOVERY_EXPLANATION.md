# Metabase è‡ªåŠ¨å‘ç°æœºåˆ¶è¯´æ˜

**æœ€åæ›´æ–°**ï¼š2025-12-08  
**æ ¸å¿ƒè¦ç‚¹**ï¼šMetabase **å®Œå…¨è‡ªåŠ¨**å‘ç°æ•°æ®åº“ä¸­çš„è¡¨ï¼Œä¸éœ€è¦æ‰‹åŠ¨é…ç½®ï¼

---

## ğŸ¯ æ ¸å¿ƒåŸç†

### Metabase å¦‚ä½•å‘ç°è¡¨ï¼Ÿ

Metabase é€šè¿‡ä»¥ä¸‹æ–¹å¼è‡ªåŠ¨å‘ç°è¡¨ï¼š

1. **è¿æ¥åˆ° PostgreSQL æ•°æ®åº“**
2. **æŸ¥è¯¢ `information_schema.tables`**ï¼š
   ```sql
   SELECT table_schema, table_name 
   FROM information_schema.tables 
   WHERE table_schema IN ('public', 'b_class', ...)
   ```
3. **è‡ªåŠ¨åŒæ­¥è¡¨ç»“æ„**ï¼š
   - æŸ¥è¯¢æ¯ä¸ªè¡¨çš„åˆ—ä¿¡æ¯
   - æŸ¥è¯¢æ¯ä¸ªè¡¨çš„æ•°æ®ç±»å‹
   - æŸ¥è¯¢æ¯ä¸ªè¡¨çš„ç´¢å¼•å’Œçº¦æŸ
4. **å­˜å‚¨åˆ° Metabase H2 æ•°æ®åº“**ï¼š
   - å°†è¡¨å…ƒæ•°æ®å­˜å‚¨åˆ° Metabase çš„å†…éƒ¨æ•°æ®åº“ï¼ˆH2ï¼‰
   - ç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œæ˜¾ç¤º

### å…³é”®ç‚¹

- âœ… **Metabase å®Œå…¨è‡ªåŠ¨**ï¼šä¸éœ€è¦æ‰‹åŠ¨é…ç½®è¡¨ååˆ—è¡¨
- âœ… **å®æ—¶åŒæ­¥**ï¼šMetabase ä¼šå®šæœŸåŒæ­¥æ•°æ®åº“ Schema
- âœ… **åŸºäºæ•°æ®åº“å®é™…çŠ¶æ€**ï¼šMetabase æ˜¾ç¤ºçš„æ˜¯æ•°æ®åº“ä¸­**å®é™…å­˜åœ¨çš„è¡¨**

---

## ğŸ” ä¸ºä»€ä¹ˆä¹‹å‰æ˜¾ç¤ºæ—§è¡¨ï¼Ÿ

### é—®é¢˜æ ¹æº

1. **æ•°æ®åº“ä¸­ç¡®å®æœ‰æ—§è¡¨**ï¼š
   - Alembic è¿ç§»è„šæœ¬åˆ›å»ºäº† `fact_raw_data_*` è¡¨
   - è¿™äº›è¡¨åœ¨ `b_class` schema ä¸­
   - Metabase æŸ¥è¯¢ `information_schema.tables` æ—¶çœ‹åˆ°äº†è¿™äº›è¡¨

2. **Metabase è‡ªåŠ¨å‘ç°äº†å®ƒä»¬**ï¼š
   - Metabase åŒæ­¥ Schema æ—¶ï¼ŒæŸ¥è¯¢åˆ°è¿™äº›è¡¨
   - Metabase è‡ªåŠ¨å°†å®ƒä»¬æ·»åŠ åˆ°è¡¨åˆ—è¡¨ä¸­
   - æ‰€ä»¥ Metabase UI ä¸­æ˜¾ç¤ºäº†è¿™äº›æ—§è¡¨

3. **åˆ é™¤æ—§è¡¨å**ï¼š
   - æ•°æ®åº“ä¸­ä¸å†æœ‰è¿™äº›è¡¨
   - Metabase ä¸‹æ¬¡åŒæ­¥æ—¶ï¼ŒæŸ¥è¯¢ `information_schema.tables` å°±æŸ¥ä¸åˆ°è¿™äº›è¡¨äº†
   - æ‰€ä»¥ Metabase UI ä¸­å°±ä¸å†æ˜¾ç¤ºè¿™äº›æ—§è¡¨

---

## ğŸ“Š Metabase åŒæ­¥æµç¨‹

### è‡ªåŠ¨åŒæ­¥æµç¨‹

```
1. Metabase è¿æ¥åˆ° PostgreSQL
   â†“
2. æŸ¥è¯¢ information_schema.tables
   SELECT table_schema, table_name 
   FROM information_schema.tables 
   WHERE table_schema IN (é…ç½®çš„ schemas)
   â†“
3. å¯¹æ¯ä¸ªè¡¨ï¼ŒæŸ¥è¯¢åˆ—ä¿¡æ¯
   SELECT column_name, data_type, ...
   FROM information_schema.columns 
   WHERE table_schema = ? AND table_name = ?
   â†“
4. å­˜å‚¨åˆ° Metabase H2 æ•°æ®åº“
   INSERT INTO metabase_table (name, schema, ...)
   â†“
5. åœ¨ UI ä¸­æ˜¾ç¤º
```

### æ‰‹åŠ¨è§¦å‘åŒæ­¥

å½“ä½ åœ¨ Metabase UI ä¸­ç‚¹å‡» **"Sync database schema now"** æ—¶ï¼š

1. Metabase é‡æ–°æ‰§è¡Œä¸Šè¿°æµç¨‹
2. å¯¹æ¯”å½“å‰æ•°æ®åº“ä¸­çš„è¡¨å’Œ Metabase H2 æ•°æ®åº“ä¸­å­˜å‚¨çš„è¡¨
3. **æ·»åŠ æ–°è¡¨**ï¼šå¦‚æœæ•°æ®åº“ä¸­æœ‰æ–°è¡¨ï¼ŒMetabase ä¼šè‡ªåŠ¨æ·»åŠ 
4. **åˆ é™¤æ—§è¡¨**ï¼šå¦‚æœæ•°æ®åº“ä¸­è¡¨ä¸å­˜åœ¨äº†ï¼ŒMetabase ä¼šè‡ªåŠ¨åˆ é™¤ï¼ˆå–å†³äºé…ç½®ï¼‰
5. **æ›´æ–°è¡¨ç»“æ„**ï¼šå¦‚æœè¡¨ç»“æ„å˜åŒ–äº†ï¼ŒMetabase ä¼šè‡ªåŠ¨æ›´æ–°

---

## âŒ å¸¸è§è¯¯è§£

### è¯¯è§£1ï¼šMetabase éœ€è¦æ‰‹åŠ¨é…ç½®è¡¨ååˆ—è¡¨

**é”™è¯¯**ï¼šè®¤ä¸ºéœ€è¦åœ¨ Metabase ä¸­æ‰‹åŠ¨æ·»åŠ æ¯ä¸ªè¡¨å

**æ­£ç¡®**ï¼š
- Metabase **å®Œå…¨è‡ªåŠ¨**å‘ç°è¡¨
- åªéœ€è¦é…ç½®æ•°æ®åº“è¿æ¥å’Œ Schema filters
- Metabase ä¼šè‡ªåŠ¨æŸ¥è¯¢ `information_schema.tables` è·å–æ‰€æœ‰è¡¨

### è¯¯è§£2ï¼šMetabase æ˜¾ç¤ºçš„è¡¨æ˜¯æ‰‹åŠ¨è®¾ç½®çš„

**é”™è¯¯**ï¼šè®¤ä¸º Metabase æ˜¾ç¤ºçš„è¡¨æ˜¯æ‰‹åŠ¨é…ç½®çš„

**æ­£ç¡®**ï¼š
- Metabase æ˜¾ç¤ºçš„è¡¨æ˜¯æ•°æ®åº“ä¸­**å®é™…å­˜åœ¨çš„è¡¨**
- å¦‚æœæ•°æ®åº“ä¸­æœ‰è¡¨ï¼ŒMetabase ä¼šè‡ªåŠ¨æ˜¾ç¤º
- å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¡¨ï¼ŒMetabase å°±ä¸ä¼šæ˜¾ç¤º

### è¯¯è§£3ï¼šåˆ é™¤è¡¨å Metabase ä»ä¼šæ˜¾ç¤º

**é”™è¯¯**ï¼šè®¤ä¸ºåˆ é™¤æ•°æ®åº“ä¸­çš„è¡¨åï¼ŒMetabase ä»ä¼šæ˜¾ç¤º

**æ­£ç¡®**ï¼š
- åˆ é™¤æ•°æ®åº“ä¸­çš„è¡¨åï¼ŒMetabase ä¸‹æ¬¡åŒæ­¥æ—¶ä¼šè‡ªåŠ¨åˆ é™¤
- å¦‚æœ Metabase ä»æ˜¾ç¤ºæ—§è¡¨ï¼Œè¯´æ˜ï¼š
  1. æ•°æ®åº“ä¸­ä»æœ‰è¿™äº›è¡¨ï¼ˆéœ€è¦æ£€æŸ¥ï¼‰
  2. Metabase è¿˜æ²¡æœ‰åŒæ­¥ï¼ˆéœ€è¦æ‰‹åŠ¨è§¦å‘åŒæ­¥ï¼‰

---

## âœ… æ­£ç¡®çš„ç†è§£

### Metabase çš„å·¥ä½œæ–¹å¼

1. **å®Œå…¨è‡ªåŠ¨**ï¼š
   - Metabase è‡ªåŠ¨æŸ¥è¯¢æ•°æ®åº“
   - Metabase è‡ªåŠ¨å‘ç°è¡¨
   - Metabase è‡ªåŠ¨åŒæ­¥ Schema

2. **åŸºäºæ•°æ®åº“å®é™…çŠ¶æ€**ï¼š
   - Metabase æ˜¾ç¤ºçš„æ˜¯æ•°æ®åº“ä¸­**å®é™…å­˜åœ¨çš„è¡¨**
   - å¦‚æœæ•°æ®åº“ä¸­æœ‰è¡¨ï¼ŒMetabase ä¼šæ˜¾ç¤º
   - å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¡¨ï¼ŒMetabase ä¸ä¼šæ˜¾ç¤º

3. **ä¸éœ€è¦æ‰‹åŠ¨é…ç½®è¡¨å**ï¼š
   - ä¸éœ€è¦åœ¨ Metabase ä¸­æ‰‹åŠ¨æ·»åŠ è¡¨å
   - ä¸éœ€è¦ç¡¬ç¼–ç è¡¨ååˆ—è¡¨
   - åªéœ€è¦é…ç½®æ•°æ®åº“è¿æ¥å’Œ Schema filters

---

## ğŸ”§ ä¸ºä»€ä¹ˆä¹‹å‰æœ‰è„šæœ¬ï¼Ÿ

### ä¹‹å‰çš„è„šæœ¬åšäº†ä»€ä¹ˆï¼Ÿ

ä¹‹å‰å½’æ¡£çš„è„šæœ¬ï¼ˆ`init_metabase_tables.py` ç­‰ï¼‰å®é™…ä¸Šï¼š

1. **åˆ›å»ºæ•°æ®åº“è¿æ¥**ï¼ˆå¯ä»¥é€šè¿‡ UI å®Œæˆï¼‰
2. **è°ƒç”¨åŒæ­¥ API**ï¼ˆMetabase ä¼šè‡ªåŠ¨æ‰§è¡Œï¼‰
3. **éªŒè¯è¡¨æ˜¯å¦åŒæ­¥**ï¼ˆç¡¬ç¼–ç è¡¨ååˆ—è¡¨ï¼Œä»…ç”¨äºéªŒè¯ï¼‰

### ä¸ºä»€ä¹ˆä¸éœ€è¦è¿™äº›è„šæœ¬ï¼Ÿ

- âœ… Metabase ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼ˆé€šè¿‡ UIï¼‰
- âœ… Metabase ä¼šè‡ªåŠ¨åŒæ­¥ Schemaï¼ˆé…ç½®è¿æ¥åè‡ªåŠ¨æ‰§è¡Œï¼‰
- âœ… Metabase ä¼šè‡ªåŠ¨å‘ç°æ‰€æœ‰è¡¨ï¼ˆä¸éœ€è¦ç¡¬ç¼–ç è¡¨ååˆ—è¡¨ï¼‰

---

## ğŸ“‹ æ­£ç¡®çš„é…ç½®æµç¨‹

### æ­¥éª¤1ï¼šé…ç½®æ•°æ®åº“è¿æ¥

1. åœ¨ Metabase UI ä¸­æ·»åŠ  PostgreSQL è¿æ¥
2. å¡«å†™è¿æ¥ä¿¡æ¯ï¼ˆHost, Port, Database, Username, Passwordï¼‰
3. **é‡è¦**ï¼šè®¾ç½® Schema filtersï¼ˆåŒ…å«æ‰€æœ‰éœ€è¦çš„ schemaï¼‰

### æ­¥éª¤2ï¼šMetabase è‡ªåŠ¨åŒæ­¥

1. Metabase è‡ªåŠ¨æŸ¥è¯¢ `information_schema.tables`
2. Metabase è‡ªåŠ¨å‘ç°æ‰€æœ‰è¡¨
3. Metabase è‡ªåŠ¨åŒæ­¥è¡¨ç»“æ„

### æ­¥éª¤3ï¼šéªŒè¯ç»“æœ

1. åœ¨ Metabase UI ä¸­æŸ¥çœ‹è¡¨åˆ—è¡¨
2. åº”è¯¥çœ‹åˆ°æ•°æ®åº“ä¸­**å®é™…å­˜åœ¨çš„æ‰€æœ‰è¡¨**
3. ä¸åº”è¯¥çœ‹åˆ°æ•°æ®åº“ä¸­**ä¸å­˜åœ¨çš„è¡¨**

---

## ğŸ¯ æ€»ç»“

### Metabase æ˜¯è‡ªåŠ¨çš„

- âœ… **è‡ªåŠ¨å‘ç°**ï¼šMetabase è‡ªåŠ¨æŸ¥è¯¢æ•°æ®åº“å‘ç°è¡¨
- âœ… **è‡ªåŠ¨åŒæ­¥**ï¼šMetabase è‡ªåŠ¨åŒæ­¥ Schema
- âœ… **è‡ªåŠ¨æ›´æ–°**ï¼šMetabase è‡ªåŠ¨æ›´æ–°è¡¨ç»“æ„

### ä¸éœ€è¦æ‰‹åŠ¨é…ç½®

- âŒ **ä¸éœ€è¦**ç¡¬ç¼–ç è¡¨ååˆ—è¡¨
- âŒ **ä¸éœ€è¦**æ‰‹åŠ¨æ·»åŠ æ¯ä¸ªè¡¨
- âŒ **ä¸éœ€è¦**è„šæœ¬éªŒè¯è¡¨æ˜¯å¦åŒæ­¥

### åªéœ€è¦é…ç½®è¿æ¥

- âœ… **åªéœ€è¦**é…ç½®æ•°æ®åº“è¿æ¥
- âœ… **åªéœ€è¦**è®¾ç½® Schema filters
- âœ… **åªéœ€è¦**ç­‰å¾… Metabase è‡ªåŠ¨åŒæ­¥

---

## ğŸ’¡ ä¸ºä»€ä¹ˆåˆ é™¤æ—§è¡¨å Metabase å°±ä¸æ˜¾ç¤ºäº†ï¼Ÿ

**ç­”æ¡ˆ**ï¼šå› ä¸º Metabase æ˜¾ç¤ºçš„æ˜¯æ•°æ®åº“ä¸­**å®é™…å­˜åœ¨çš„è¡¨**ï¼

1. **åˆ é™¤å‰**ï¼š
   - æ•°æ®åº“ä¸­æœ‰ `fact_raw_data_*` è¡¨
   - Metabase æŸ¥è¯¢ `information_schema.tables` æ—¶çœ‹åˆ°äº†è¿™äº›è¡¨
   - æ‰€ä»¥ Metabase UI ä¸­æ˜¾ç¤ºäº†è¿™äº›è¡¨

2. **åˆ é™¤å**ï¼š
   - æ•°æ®åº“ä¸­ä¸å†æœ‰ `fact_raw_data_*` è¡¨
   - Metabase æŸ¥è¯¢ `information_schema.tables` æ—¶æŸ¥ä¸åˆ°è¿™äº›è¡¨äº†
   - æ‰€ä»¥ Metabase UI ä¸­å°±ä¸å†æ˜¾ç¤ºè¿™äº›è¡¨

3. **é‡æ–°åŒæ­¥å**ï¼š
   - Metabase é‡æ–°æŸ¥è¯¢ `information_schema.tables`
   - åªçœ‹åˆ°æ–°è¡¨ï¼ˆ`fact_shopee_*`, `fact_tiktok_*` ç­‰ï¼‰
   - æ‰€ä»¥ Metabase UI ä¸­åªæ˜¾ç¤ºæ–°è¡¨

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-12-08  
**çŠ¶æ€**ï¼šâœ… Metabase å®Œå…¨è‡ªåŠ¨ï¼Œä¸éœ€è¦æ‰‹åŠ¨é…ç½®è¡¨å

