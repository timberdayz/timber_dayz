# 下一步操作指南 - 妙手ERP产品数据重新入库

**状态**: ✅ 系统已就绪  
**日期**: 2025-11-05  

## ✅ 已完成的准备工作

1. ✅ **数据库扩展** - 添加了4个细分库存字段
   - `total_stock` - 库存总量
   - `available_stock` - 可用库存
   - `reserved_stock` - 预占库存
   - `in_transit_stock` - 在途库存

2. ✅ **字段映射字典更新** - 添加了新字段定义和同义词
   - 支持自动识别"库存总量"、"可用库存"等中文字段
   - 支持自动识别"单价"、"*单价（元）"等价格字段

3. ✅ **清理重复映射** - 删除了所有重复的旧字段
   - Products域: 清理4个重复
   - Orders域: 清理2个重复
   - **现在所有映射都是唯一的**

## 🎯 现在您需要做什么

### Step 1: 准备Excel文件

确保您的妙手ERP产品数据Excel文件包含以下列：

**必需列**:
- `*商品名称` - 产品名称
- `*单价（元）` - 单个售卖价格

**库存列**（至少包含其中一些）:
- `库存总量` - 所有持有的库存
- `可用库存` - 可售卖的库存
- `预占库存` - 已拍但未付款
- `在途库存` - 运输中的库存

**可选列**:
- 其他产品信息（规格、分组、仓库等）

### Step 2: 打开字段映射界面

1. 启动系统（如果未启动）
   ```bash
   python run.py
   ```

2. 在浏览器打开前端界面
   - 默认地址: `http://localhost:5173`

3. 进入字段映射功能
   - 导航到"数据采集" → "字段映射"
   - 或直接访问: `http://localhost:5173/field-mapping`

### Step 3: 上传并映射

1. **上传文件**
   - 点击"上传文件"按钮
   - 选择您的妙手产品数据Excel文件
   - 等待文件上传完成

2. **预览数据**
   - 系统会自动预览前100行数据
   - 检查数据是否正确加载

3. **生成智能映射**
   - 点击"生成智能映射"按钮
   - 系统会自动识别并映射字段

4. **验证映射结果**
   
   **期望的映射结果**（应该都是绿色、高置信度）:
   ```
   *商品名称 → product_name ✅
   *单价（元） → price ✅
   库存总量 → total_stock ✅
   可用库存 → available_stock ✅
   预占库存 → reserved_stock ✅
   在途库存 → in_transit_stock ✅
   ```
   
   **不需要映射的字段**（选择"无需映射"）:
   ```
   总价（元） → 无需映射
   活动预留库存 → 无需映射
   计划库存 → 无需映射
   安全库存 → 无需映射
   ```

5. **检查重点**
   - ✅ 确认"库存总量"只有**1个**选项（`total_stock`）
   - ✅ 确认"可用库存"只有**1个**选项（`available_stock`）
   - ✅ 确认"预占库存"只有**1个**选项（`reserved_stock`）
   - ✅ 确认"在途库存"只有**1个**选项（`in_transit_stock`）
   - ✅ 确认"单价"映射到`price`

6. **确认映射并入库**
   - 检查无误后，点击"确认映射并入库"按钮
   - 等待数据入库完成
   - 查看成功消息: "数据入库成功！已导入xxx条记录"

### Step 4: 验证数据

1. **前往产品管理页面**
   - 导航到"产品管理"
   - 或访问: `http://localhost:5173/product-management`

2. **检查产品列表**
   - 查看产品是否正确显示
   - 检查价格信息是否正确
   - 检查库存信息是否正确

3. **查看产品详情**
   - 点击任意产品查看详情
   - 确认4个库存字段都有数据
   - 确认价格字段正确显示

### Step 5: 保存映射模板（可选）

如果映射配置正确，建议保存为模板以便后续使用：

1. 点击"保存为模板"按钮
2. 输入模板名称: `miaoshou_products_snapshot_v2`
3. 添加描述: "妙手产品快照v2 - 包含4个细分库存字段"
4. 保存

下次导入同类型文件时，系统会自动应用此模板！

## ⚠️ 常见问题

### Q1: 如果映射不正确怎么办？

**A**: 手动调整映射
1. 找到映射不正确的字段
2. 点击"标准字段"下拉框
3. 搜索正确的字段（支持中文搜索）
4. 选择后自动更新

### Q2: 如果看到重复的字段选项怎么办？

**A**: 这不应该发生了！我们已经清理了所有重复。如果您还看到重复：
1. 立即联系系统管理员
2. 不要选择任何重复的选项
3. 等待修复后再继续

### Q3: 如何知道数据是否正确入库？

**A**: 三种验证方法
1. **前端验证**: 产品管理页面查看数据
2. **数据库验证**: 
   ```bash
   python scripts/check_product_metrics_data.py
   ```
3. **日志查看**: 查看后端日志中的入库记录

### Q4: "总价"字段为什么不需要映射？

**A**: 总价是计算字段（数量 × 单价），只需要存储原子级数据。

### Q5: 数据入库后发现错误怎么办？

**A**: 
1. 检查"数据隔离区"是否有问题记录
2. 修正映射配置
3. 重新导入数据（系统会自动覆盖）

## 📞 需要帮助？

### 查看文档
- **完整技术文档**: `docs/INVENTORY_PRICE_MAPPING_SOLUTION.md`
- **快速映射指南**: `docs/MIAOSHOU_PRODUCT_MAPPING_GUIDE.md`
- **重复清理报告**: `docs/DUPLICATE_MAPPING_RESOLUTION_REPORT.md`

### 运行验证脚本
```bash
# 检查是否还有重复映射
python scripts/check_duplicate_mappings.py

# 检查产品数据
python scripts/check_product_metrics_data.py
```

### 查看系统日志
- 后端日志: 查看终端输出
- 数据隔离区: 前端界面 → 数据隔离区

## ✨ 预期效果

导入完成后，您应该看到：

1. **产品管理页面**
   - 产品列表正常显示
   - 价格信息正确（*单价（元）的值）
   - 库存信息正确（4个细分库存）

2. **库存看板**
   - 库存统计更新
   - 低库存预警生效
   - 库存明细清晰

3. **数据看板**
   - 产品销售排行更新
   - 库存周转分析生效

---

**准备好了吗？** 现在就开始重新导入您的妙手ERP产品数据吧！ 🚀

如果遇到任何问题，随时告诉我！

