# 字段映射系统快速上手指南

**版本**: v2.3  
**更新日期**: 2025-10-27  
**适用用户**: 数据管理员、运营人员

---

## 🚀 5分钟快速开始

### 第一步：启动系统

```bash
# 启动后端和前端服务
python run.py

# 等待服务启动完成（约10秒）
# 看到"西虹ERP系统启动完成"即可
```

访问地址：`http://localhost:5173`

---

### 第二步：扫描文件

1. 点击**"扫描采集文件"**按钮
2. 等待扫描完成（通常5-10秒）
3. 看到绿色提示"文件扫描完成"

**预期结果**: 发现数百个文件并注册到系统

---

### 第三步：选择文件

1. **选择平台**: 下拉选择（shopee/tiktok/miaoshou）
2. **选择数据域**: 下拉选择（products/orders/services等）
3. **选择粒度**: 下拉选择（daily/weekly/monthly）
4. **选择文件**: 下拉选择具体文件

**提示**: 
- 优先选择**XLSX格式**文件（预览快）
- 避免选择>10MB的妙手文件（可能较慢）

---

### 第四步：预览数据

1. 点击**"预览数据"**按钮
2. 等待1-5秒（根据文件大小）
3. 查看预览表格

**功能亮点**:
- ✨ 自动还原合并单元格（订单号/状态等）
- 显示前50-100行数据
- 显示列名和数据类型

**如果遇到问题**:
- 妙手大文件预览慢 → 参考`MIAOSHOU_FILE_HANDLING_GUIDE.md`
- XLS文件失败 → 用Excel转换为XLSX格式

---

### 第五步：生成字段映射

1. 点击**"生成字段映射"**按钮
2. 等待1-2秒
3. 查看映射结果

**映射说明**:
- **绿色**: 高置信度映射（0.8-1.0）
- **黄色**: 中置信度映射（0.5-0.8）
- **红色**: 低置信度映射（<0.5）或未映射

**手动调整**:
- 点击标准字段下拉框修改映射
- 点击**"修正低置信度"**批量处理

---

### 第六步：确认入库

1. 检查映射是否正确
2. 点击**"确认映射并入库"**按钮
3. 确认对话框中点击**"确定"**
4. 等待入库完成（5-30秒）

**预期结果**:
- 绿色提示"数据入库成功"
- Catalog状态中"已入库"数量+1

---

## 📖 详细功能说明

### 文件扫描

**功能**: 扫描`data/raw`目录，发现所有数据文件

**何时使用**:
- 首次使用系统
- 采集模块下载新文件后
- 手动上传文件后

**注意事项**:
- 扫描基于文件hash去重
- 重复扫描不会创建重复记录
- 扫描速度：约100文件/秒

### 数据预览

**功能**: 显示文件前50-100行数据

**特色功能**:
- ✨ **自动还原合并单元格**
  - 订单号/发货状态等维度列
  - 前向填充（ffill）
  - 金额/数量等度量列不填充

**表头行设置**:
- 0 = 无表头
- 1 = 第1行是表头（默认）
- 2+ = 第N行是表头

### 字段映射

**映射方法**:
- **精确匹配**: 字段名完全相同
- **模糊匹配**: 字段名相似（如"商品名称"→"product_name"）
- **别名匹配**: 使用预定义的字段别名库

**置信度说明**:
- **1.0**: 完全匹配
- **0.8-0.9**: 高度相似
- **0.5-0.7**: 可能匹配
- **<0.5**: 不确定，需人工确认

### 数据入库

**入库流程**:
1. 数据验证（必填字段、数据类型）
2. 数据暂存（staging表）
3. 数据导入（事实表，ON CONFLICT更新）
4. 失败数据隔离（quarantine表）
5. 更新文件状态（catalog_files.status）

**入库结果**:
- **全部成功**: status='ingested'
- **部分成功**: status='partial_success'（有隔离行）
- **全部失败**: status='failed'

---

## 🎯 最佳实践

### 1. 文件格式
- ✅ **推荐**: 标准.xlsx格式
- ⚠️ **慎用**: .xls格式（可能损坏）
- ❌ **避免**: >10MB的损坏文件

### 2. 批量处理
- 先处理小文件（<1MB）熟悉流程
- 再处理标准文件（1-10MB）
- 最后处理大文件（>10MB，建议转换）

### 3. 映射模板
- 保存常用映射为模板
- 下次同类文件可快速套用
- 减少重复配置工作

### 4. 数据验证
- 入库前检查映射完整性
- 查看验证错误提示
- 修正后重新入库

---

## ⚡ 快捷操作

| 操作 | 快捷方式 |
|------|---------|
| 扫描文件 | 点击按钮 |
| 刷新列表 | F5或点击刷新按钮 |
| 重新预览 | 调整表头行后点击 |
| 清空映射 | 点击"清空映射"按钮 |
| 修正低置信度 | 批量操作按钮 |

---

## 🆘 常见问题

### Q1: 预览一直loading怎么办？
**A**: 可能是大文件或损坏文件。刷新页面，换一个文件试试，或参考`MIAOSHOU_FILE_HANDLING_GUIDE.md`。

### Q2: 字段映射不准确怎么办？
**A**: 手动点击标准字段下拉框调整，或使用"修正低置信度"批量处理。

### Q3: 入库失败怎么办？
**A**: 查看错误提示，检查：
- 字段映射是否完整
- 数据是否有空值（必填字段）
- 日期格式是否正确

### Q4: 找不到文件怎么办？
**A**: 
1. 点击"扫描采集文件"刷新
2. 检查文件是否在`data/raw/2025/`目录
3. 点击"清理无效文件"删除孤儿记录

---

## 📊 系统监控

### Catalog状态

**含义**:
- **总文件数**: 系统中注册的所有文件
- **待处理**: 未入库的文件
- **已入库**: 成功入库的文件
- **失败**: 入库失败的文件

**健康指标**:
- 待处理<1000: 正常
- 失败率<5%: 正常
- 已入库持续增长: 正常

---

## 💡 高级功能

### 模板管理
- 保存映射模板
- 版本管理
- 快速套用

### 批量操作
- 按日期批量入库
- 批量清理
- 批量验证

### 数据质量
- 查看隔离数据
- 导出错误报告
- 数据修正建议

---

## 📞 获取帮助

**文档**:
- API契约: `FIELD_MAPPING_V2_CONTRACT.md`
- 运维指南: `FIELD_MAPPING_V2_OPERATIONS.md`
- 妙手文件: `MIAOSHOU_FILE_HANDLING_GUIDE.md`

**技术支持**:
- 查看后端日志: `backend/logs/`
- 查看前端控制台: 浏览器F12开发者工具
- 提交问题: GitHub Issues

---

**祝您使用愉快！** 🎉

