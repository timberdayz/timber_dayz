# 管理员审批指南

**版本**: v4.19.0  
**更新日期**: 2026-01-05  
**适用对象**: 系统管理员

---

## 📋 概述

本指南介绍如何审批新用户注册申请。系统管理员负责审核新用户的注册申请，决定是否批准其使用系统。

---

## 🚀 审批流程

### 步骤 1: 访问审批页面

1. 使用管理员账号登录系统
2. 导航到"用户审批"页面（`/admin/users/pending`）
3. 系统会显示所有待审批的用户列表

### 步骤 2: 查看待审批用户

在待审批用户列表中，您可以查看以下信息：

- **用户名**: 用户注册时填写的用户名
- **邮箱**: 用户注册时填写的邮箱
- **姓名**: 用户的真实姓名或显示名称
- **电话**: 用户的联系电话（如果有）
- **部门**: 用户所在的部门（如果有）
- **注册时间**: 用户提交注册的时间

### 步骤 3: 审批决定

对于每个待审批用户，您可以选择：

#### 批准用户

1. 点击"批准"按钮
2. 系统会：
   - 将用户状态设置为"active"（已激活）
   - 将`is_active`设置为`True`
   - 自动分配默认角色（operator）
   - 记录审批日志
   - 发送通知给用户（如果配置）

#### 拒绝用户

1. 点击"拒绝"按钮
2. 填写拒绝原因（必填）
3. 系统会：
   - 将用户状态设置为"rejected"（已拒绝）
   - 将`is_active`设置为`False`
   - 记录拒绝原因
   - 记录审批日志
   - 发送通知给用户（如果配置）

---

## 🔐 用户管理功能

### 密码重置

如果用户忘记密码，您可以：

1. 在用户管理页面找到该用户
2. 点击"重置密码"按钮
3. 选择：
   - **指定新密码**: 输入新密码（至少 8 位，包含字母和数字）
   - **生成临时密码**: 系统自动生成临时密码
4. 将新密码或临时密码告知用户
5. 建议用户首次登录后立即修改密码

### 账户解锁

如果用户账户因多次登录失败被锁定，您可以：

1. 在用户管理页面找到该用户
2. 点击"解锁账户"按钮
3. 系统会：
   - 清除锁定状态（`locked_until = None`）
   - 重置失败登录次数（`failed_login_attempts = 0`）
   - 记录解锁日志

### 账户暂停

如果需要临时禁用用户账户：

1. 在用户管理页面找到该用户
2. 将用户状态设置为"suspended"（已暂停）
3. 系统会：
   - 将`is_active`设置为`False`
   - 用户无法登录系统
   - 记录暂停日志

---

## 📊 审批记录

系统会记录所有审批操作到`user_approval_logs`表，包括：

- **操作类型**: approve（批准）或 reject（拒绝）
- **操作时间**: 审批时间
- **操作人**: 执行审批的管理员
- **拒绝原因**: 如果拒绝，记录拒绝原因

您可以在审计日志中查看所有审批记录。

---

## ⚠️ 注意事项

### 审批原则

1. **验证用户身份**

   - 确认用户信息真实有效
   - 检查邮箱是否属于用户本人
   - 验证用户是否符合系统使用要求

2. **角色分配**

   - 新用户默认分配"operator"角色
   - 如需分配其他角色，可以在批准后修改

3. **拒绝原因**
   - 必须填写明确的拒绝原因
   - 拒绝原因会告知用户，请使用专业、礼貌的措辞

### 安全建议

1. **定期审查**

   - 定期审查待审批用户列表
   - 及时处理注册申请

2. **密码安全**

   - 生成临时密码时，确保密码强度
   - 建议用户首次登录后立即修改密码

3. **账户锁定**
   - 如果用户账户被锁定，先了解原因
   - 确认是正常使用还是异常行为

---

## 🔍 常见场景

### 场景 1: 批量审批

如果有多个待审批用户：

1. 逐个查看用户信息
2. 批量批准符合条件的用户
3. 对于有疑问的用户，先拒绝并记录原因，后续再处理

### 场景 2: 用户重新注册

如果用户之前被拒绝，现在重新注册：

1. 系统允许 rejected 状态的用户重新注册
2. 重新注册后，用户状态会重置为 pending
3. 您可以重新审批

### 场景 3: 用户忘记密码

如果用户忘记密码：

1. 使用"重置密码"功能
2. 生成临时密码或设置新密码
3. 将密码通过安全渠道告知用户
4. 建议用户首次登录后立即修改密码

---

## 📞 获取帮助

如果您在审批过程中遇到问题，可以：

1. 查看系统帮助文档
2. 联系系统超级管理员
3. 查看审计日志了解操作历史

---

## 🔄 更新历史

- **v4.19.0** (2026-01-05): 初始版本，管理员审批机制
