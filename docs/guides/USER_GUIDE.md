# 🎯 智能字段映射审核系统 - 用户操作指南

## 📋 系统概述

智能字段映射审核系统是一个专门为跨境电商ERP设计的现代化数据处理平台，能够自动识别、映射、验证和入库不同平台的Excel数据文件。

### 🌟 核心功能
- **智能字段映射**: AI驱动的自动字段识别和映射
- **数据质量验证**: 多层次的数据验证和错误检测
- **外键关系管理**: 智能外键识别和关系审核
- **批量数据处理**: 支持大量文件的批量处理
- **现代化界面**: 基于Vue.js的用户友好界面

## 🚀 快速开始

### 1. 启动系统
```bash
# 启动主系统
python run_new.py

# 选择操作：
# 4. Vue字段映射审核
# 3. 启动完整系统
```

### 2. 访问界面
- **前端界面**: http://localhost:5173
- **后端API**: http://localhost:8000
- **API文档**: http://localhost:8000/docs

## 📖 详细操作指南

### 第一步：扫描采集文件

1. **点击扫描按钮**
   - 在界面顶部找到"扫描采集文件"按钮
   - 点击开始扫描系统中的Excel文件

2. **等待扫描完成**
   - 系统会自动扫描 `temp/outputs/`、`data/input/` 等目录
   - 扫描完成后会显示"扫描完成: 发现X个文件"

3. **查看扫描结果**
   - 扫描状态会显示在页面顶部的状态栏
   - 绿色表示成功，红色表示有错误

### 第二步：选择要处理的文件

1. **选择平台**
   - 在"选择平台"下拉菜单中选择数据来源平台
   - 支持：shopee、tiktok、miaoshou、amazon等

2. **选择数据域**
   - 在"选择数据域"下拉菜单中选择数据类型
   - 支持：products、orders、traffic、service等

3. **选择具体文件**
   - 在"选择文件"下拉菜单中选择要处理的Excel文件
   - 文件列表会显示该平台和数据域下的所有可用文件

### 第三步：文件预览

1. **自动预览**
   - 选择文件后，系统会自动加载文件预览
   - 预览表格显示前10行数据，帮助理解文件结构

2. **查看列信息**
   - 预览表格会显示所有列名和样本数据
   - 注意列名的格式（中文、英文、数字等）

### 第四步：智能字段映射

1. **生成智能映射**
   - 点击"🤖 智能映射"按钮
   - 系统会自动分析文件列名，生成字段映射建议

2. **查看映射结果**
   - 映射结果会显示在"智能字段映射"区域
   - 每个映射包含：原始字段、标准字段、置信度、类型

3. **理解映射类型**
   - **字段映射**: 普通数据字段的映射
   - **外键映射**: 需要关联到其他表的字段（如shop_id、product_id）

### 第五步：外键审核（重要）

1. **识别外键**
   - 系统会自动识别可能的外键字段
   - 外键字段会显示在"外键关系审核"区域

2. **审核外键关系**
   - 检查外键映射是否正确
   - 确认目标表（如dim_shops、fact_orders）是否正确
   - 点击"确认"按钮确认外键映射

3. **编辑外键映射**
   - 如果外键映射不正确，点击"编辑"按钮
   - 手动调整目标表和字段名

### 第六步：数据验证

1. **执行验证**
   - 点击"🔍 验证数据"按钮
   - 系统会检查数据质量，包括：
     - 数据类型是否正确
     - 必填字段是否为空
     - 外键值是否存在于目标表中
     - 业务规则是否满足

2. **查看验证结果**
   - 验证结果会显示在"数据验证结果"区域
   - 查看验证状态、错误数、警告数、错误率

3. **分析错误详情**
   - 如果有错误，查看"错误详情"表格
   - 每个错误包含：行号、列名、错误类型、错误信息、建议

4. **根据建议修复**
   - 查看"修复建议"部分
   - 根据建议调整数据或映射配置

### 第七步：数据入库

1. **确认入库条件**
   - 确保数据验证通过（状态为"通过"）
   - 确认所有外键关系已审核

2. **执行入库**
   - 点击"📥 数据入库"按钮
   - 系统会批量处理数据并入库

3. **查看入库结果**
   - 入库完成后会显示结果对话框
   - 查看处理行数、成功数、失败数

## 🔧 高级配置

### 外键映射配置

1. **理解外键概念**
   - 外键是连接不同表的字段
   - 例如：订单表中的shop_id对应店铺表中的shop_id

2. **常见外键映射**
   ```
   店铺相关:
   - shop_id → dim_shops.shop_id
   - store_id → dim_shops.shop_id
   
   产品相关:
   - product_id → dim_products.product_id
   - sku → dim_products.product_sku
   
   订单相关:
   - order_id → fact_orders.order_id
   - order_number → fact_orders.order_id
   ```

3. **外键验证**
   - 系统会检查外键值是否在目标表中存在
   - 如果外键值不存在，数据会被标记为错误

### 数据质量检查

1. **数据类型验证**
   - 数字字段：price、amount、quantity
   - 日期字段：order_date、created_at
   - 文本字段：product_name、description

2. **业务规则验证**
   - 订单金额必须大于0
   - 数量必须为正整数
   - 日期不能是未来日期

3. **必填字段检查**
   - products: product_id、product_name、shop_id
   - orders: order_id、order_amount、order_date、shop_id

## 📊 数据入库后检查

### 1. 验证入库结果

1. **检查入库统计**
   - 查看入库结果对话框中的统计数据
   - 确认成功处理的记录数

2. **检查错误记录**
   - 如果有失败记录，查看失败原因
   - 失败记录会被隔离到data_quarantine表

### 2. 数据库验证

1. **检查目标表**
   ```sql
   -- 检查订单数据
   SELECT COUNT(*) FROM fact_orders WHERE order_date >= '2025-01-01';
   
   -- 检查产品数据
   SELECT COUNT(*) FROM dim_products WHERE created_at >= '2025-01-01';
   ```

2. **验证数据完整性**
   ```sql
   -- 检查外键完整性
   SELECT o.order_id, o.shop_id 
   FROM fact_orders o 
   LEFT JOIN dim_shops s ON o.shop_id = s.shop_id 
   WHERE s.shop_id IS NULL;
   ```

3. **数据质量检查**
   ```sql
   -- 检查重复记录
   SELECT order_id, COUNT(*) 
   FROM fact_orders 
   GROUP BY order_id 
   HAVING COUNT(*) > 1;
   ```

### 3. 业务验证

1. **数据一致性检查**
   - 检查订单金额是否合理
   - 验证日期范围是否符合预期
   - 确认产品信息完整性

2. **关联数据检查**
   - 验证订单与产品的关联关系
   - 检查店铺信息的一致性
   - 确认客户数据的完整性

## ⚠️ 常见问题解决

### 1. 文件预览失败
**问题**: 选择文件后显示"文件不存在"
**解决**: 
- 检查文件路径是否正确
- 确认文件没有被移动或删除
- 点击"清理无效文件"清理数据库记录

### 2. 智能映射不准确
**问题**: 自动生成的映射不符合预期
**解决**:
- 点击"🤖 重新映射"重新生成
- 手动调整映射配置
- 检查列名是否标准化

### 3. 数据验证失败
**问题**: 验证结果显示大量错误
**解决**:
- 检查数据格式是否正确
- 确认必填字段是否有值
- 验证外键值是否存在于目标表

### 4. 外键验证失败
**问题**: 外键值在目标表中不存在
**解决**:
- 先导入基础数据（店铺、产品等）
- 检查外键映射配置是否正确
- 手动补充缺失的基础数据

### 5. 数据入库失败
**问题**: 入库过程中出现错误
**解决**:
- 检查数据库连接是否正常
- 确认数据库表结构是否正确
- 查看错误日志获取详细信息

## 💡 最佳实践

### 1. 数据处理流程
1. **先处理基础数据**: 店铺、产品等维度表
2. **再处理业务数据**: 订单、交易等事实表
3. **最后验证关联关系**: 检查外键完整性

### 2. 文件命名规范
- 使用统一的文件命名格式
- 包含平台、数据类型、日期等信息
- 避免使用特殊字符和中文

### 3. 数据质量控制
- 定期检查数据质量
- 建立数据验证规则
- 监控异常数据

### 4. 备份和恢复
- 定期备份数据库
- 保留原始Excel文件
- 建立数据恢复流程

## 📞 技术支持

如果遇到问题，可以：
1. 查看系统日志文件
2. 检查API文档: http://localhost:8000/docs
3. 参考系统设计文档: `docs/MAPPING_SYSTEM_DESIGN.md`
4. 查看完整系统报告: `docs/COMPLETE_MAPPING_SYSTEM_REPORT.md`

---

**祝您使用愉快！** 🎉
