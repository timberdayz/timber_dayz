# 测试检查清单

**日期**: 2025-01-31  
**测试目标**: 验证数据同步功能和模板保存功能

---

## ✅ 修复完成

### 1. 入库功能修复 ✅
- ✅ 修复`batch_calculate_data_hash`参数错误
- ✅ 修复DSS架构入库逻辑
- ✅ 修复缩进问题

### 2. 模板保存功能修复 ✅
- ✅ 更新API路径
- ✅ 更新参数格式（使用header_columns）

### 3. 字段映射字典移除 ✅
- ✅ 移除"加载辞典"按钮
- ✅ 移除相关函数调用

---

## 🧪 测试步骤

### 测试1: 数据入库

1. **刷新浏览器页面**（F5）
2. **选择文件**:
   - 平台: miaoshou
   - 数据域: inventory（或其他）
   - 粒度: 日度
   - 选择文件
3. **预览数据**:
   - 点击"预览数据"按钮
   - 确认可以看到25个字段
4. **数据入库**:
   - 点击"确认并入库"按钮
   - **预期**: 显示成功消息，数据写入到`fact_raw_data_*`表

### 测试2: 模板保存

1. **选择文件并预览数据**（同上）
2. **保存模板**:
   - 点击"保存为模板"按钮
   - 输入模板名称（如：`miaoshou_inventory_daily_v1`）
   - 点击"保存"
   - **预期**: 显示成功消息
3. **验证模板**:
   - 选择同类文件（相同platform + data_domain + granularity）
   - **预期**: 系统自动应用模板

---

## 🔍 问题排查

### 如果入库仍然失败

1. **查看后端日志**:
   - 打开后端PowerShell窗口
   - 查看详细错误堆栈
   - 记录错误信息

2. **检查数据库**:
   - 确认`fact_raw_data_*`表已创建
   - 确认表结构正确

3. **检查数据格式**:
   - 确认Excel文件格式正确
   - 确认表头行设置正确

### 如果模板保存仍然失败

1. **检查API响应**:
   - 打开浏览器控制台（F12）
   - 查看Network标签
   - 检查`/field-mapping/dictionary/templates/save`请求
   - 查看响应内容

2. **检查后端日志**:
   - 查看后端PowerShell窗口
   - 查看模板保存相关日志

---

## 📝 验证要点

### 数据入库验证

- [ ] 数据成功写入数据库
- [ ] JSONB格式正确（`raw_data`字段）
- [ ] 中文字段名保留（如"商品SKU"、"库存总量"）
- [ ] `header_columns`字段保存正确
- [ ] 数据写入到正确的表（`fact_raw_data_{domain}_{granularity}`）

### 模板保存验证

- [ ] 模板成功保存到数据库
- [ ] 显示成功消息
- [ ] 模板可以自动应用
- [ ] `header_columns`正确保存

---

**状态**: ✅ **代码修复完成，请刷新浏览器并测试**

