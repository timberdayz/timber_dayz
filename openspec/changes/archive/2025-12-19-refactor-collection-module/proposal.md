# Change: é‡æ„æ•°æ®é‡‡é›†æ¨¡å— - æ–¹æ¡ˆBï¼šç»„ä»¶é©±åŠ¨æ¶æ„

## Why

å½“å‰æ•°æ®é‡‡é›†æ¨¡å—ï¼ˆCollection Moduleï¼‰å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **å‰åç«¯ä¸åŒ¹é…**ï¼š`handlers.py` ä¸­çš„é‡‡é›†é€»è¾‘ä½¿ç”¨ `input()` é˜»å¡å¼äº¤äº’ï¼Œæ— æ³•é€šè¿‡ HTTP API è°ƒç”¨
2. **å‰ç«¯é¡µé¢ç©ºå£³**ï¼š`CollectionConfig.vue`ã€`CollectionTasks.vue`ã€`CollectionHistory.vue` å‡ä¸ºå ä½ç»„ä»¶
3. **ç¼ºå°‘å®æ—¶çŠ¶æ€**ï¼šé‡‡é›†ä»»åŠ¡çŠ¶æ€ä½¿ç”¨å†…å­˜å­—å…¸å­˜å‚¨ï¼Œæ— æ³•æŒä¹…åŒ–å’Œå‰ç«¯å®æ—¶å±•ç¤º
4. **ç¼ºå°‘å®šæ—¶è°ƒåº¦**ï¼šä»…æ”¯æŒæ‰‹åŠ¨è§¦å‘é‡‡é›†ï¼Œæ— æ³•é…ç½®å®šæ—¶è‡ªåŠ¨é‡‡é›†
5. **è„šæœ¬éš¾ç»´æŠ¤**ï¼šå½“å‰å½•åˆ¶çš„æ˜¯å®Œæ•´ Python è„šæœ¬ï¼Œç½‘ç«™æ›´æ–°æ—¶éœ€è¦é‡æ–°å½•åˆ¶æ•´ä¸ªæµç¨‹
6. **äº‘ç«¯é€‚é…ä¸è¶³**ï¼šç¼ºå°‘ä»£ç†IPæ¥å£ã€Docker headless æ¨¡å¼æœªå®Œå–„ã€ç¼ºå°‘è¿œç¨‹éªŒè¯ç å¤„ç†
7. **ç”¨æˆ·ä½“éªŒé—®é¢˜**ï¼ˆå®é™…ä½¿ç”¨åé¦ˆï¼‰ï¼š
   - é…ç½®å‘½åéœ€æ‰‹åŠ¨è¾“å…¥ï¼Œæ˜“å‡ºé”™ä¸”ä¸ç»Ÿä¸€
   - æ—¥æœŸé€‰æ‹©ä¸å¹³å°æ§ä»¶ä¸å¯¹é½ï¼ˆæ— æ³•é€‰æ‹©"å‘¨åº¦+30å¤©"ç»„åˆï¼‰
   - æœåŠ¡æ•°æ®åŸŸå­ç±»å‹é€‰æ‹©ä¸çµæ´»ï¼ˆagent/ai_assistantéœ€é¡ºåºé‡‡é›†ï¼‰
   - å½•åˆ¶å·¥å…·éœ€è¦æ‰§è¡Œå‘½ä»¤è¡Œï¼Œå¯¹ç®¡ç†å‘˜ä¸å¤Ÿå‹å¥½
8. **å½•åˆ¶å·¥å…·è®¾è®¡ç¼ºé™·**ï¼ˆå®é™…å½•åˆ¶ä¸­å‘ç°ï¼‰ï¼š
   - âŒ **ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œloginç»„ä»¶**ï¼šå½•åˆ¶éloginç»„ä»¶æ—¶ä»…å¯¼èˆªåˆ°ç™»å½•é¡µï¼Œä¸æ‰§è¡Œå·²å½•åˆ¶çš„login.yamlï¼Œéœ€æ‰‹åŠ¨é‡æ–°ç™»å½•
   - âŒ **ä¸ä¼šæ•è·ç”¨æˆ·æ“ä½œ**ï¼šæœªå¯ç”¨Playwright Inspectorï¼Œåªè®°å½•åˆå§‹navigateæ­¥éª¤ï¼Œæ‰€æœ‰ç‚¹å‡»/è¾“å…¥æ“ä½œéƒ½ä¸¢å¤±
   - âš ï¸ **è¶…æ—¶é…ç½®ä¸å¤Ÿå¥å£®**ï¼šç½‘ç»œå»¶è¿Ÿæ—¶å®¹æ˜“è¶…æ—¶ï¼Œç¼ºå°‘é‡è¯•æœºåˆ¶

**æ ¹æœ¬åŸå› **ï¼šé‡‡é›†æ¨¡å—æœ€åˆä¸ºæœ¬åœ° CLI å¼€å‘å·¥å…·è®¾è®¡ï¼Œæœªè€ƒè™‘ Web API é©±åŠ¨ã€ä¼ä¸šçº§è‡ªåŠ¨åŒ–å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–ã€‚

## What Changes

### æ ¸å¿ƒå˜æ›´ï¼šç»„ä»¶é©±åŠ¨æ¶æ„

æœ¬æ¬¡é‡æ„é‡‡ç”¨**æ–¹æ¡ˆBï¼šç»„ä»¶é©±åŠ¨æ¶æ„**ï¼Œæ ¸å¿ƒç†å¿µæ˜¯å°†é‡‡é›†æµç¨‹æ‹†åˆ†ä¸ºå¯å¤ç”¨çš„ç»„ä»¶ï¼š

```
ä¼ ç»Ÿè„šæœ¬é©±åŠ¨ï¼ˆæ–¹æ¡ˆCï¼‰        ç»„ä»¶é©±åŠ¨ï¼ˆæ–¹æ¡ˆBï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ¯ä¸ª å¹³å°+è´¦å·+æ•°æ®åŸŸ        å½•åˆ¶ç‹¬ç«‹ã€å¯å¤ç”¨çš„ç»„ä»¶ï¼š
ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ Python         - login.yamlï¼ˆç™»å½•ï¼‰
è„šæœ¬æ–‡ä»¶                     - navigation.yamlï¼ˆå¯¼èˆªï¼‰
                            - date_picker.yamlï¼ˆæ—¥æœŸé€‰æ‹©ï¼‰
                            - orders_export.yamlï¼ˆè®¢å•å¯¼å‡ºï¼‰
                            - products_export.yamlï¼ˆäº§å“å¯¼å‡ºï¼‰
                            - inventory_export.yamlï¼ˆåº“å­˜å¯¼å‡ºï¼‰
                            
éœ€è¦å½•åˆ¶ 45+ ä¸ªè„šæœ¬          åªéœ€å½•åˆ¶ ~27 ä¸ªç»„ä»¶
ç½‘ç«™æ›´æ–°éœ€æ”¹å¤šä¸ªè„šæœ¬          ç½‘ç«™æ›´æ–°åªæ”¹å•ä¸ªç»„ä»¶
```

### æ”¯æŒçš„æ•°æ®åŸŸ

| æ•°æ®åŸŸ | è¯´æ˜ | å­åŸŸ |
|--------|------|------|
| orders | è®¢å•æ•°æ® | - |
| products | äº§å“æ•°æ® | - |
| services | æœåŠ¡æ•°æ® | agent, ai_assistant |
| analytics | æµé‡åˆ†æ | - |
| finance | è´¢åŠ¡æ•°æ® | - |
| inventory | åº“å­˜æ•°æ® | - |

> æ³¨ï¼š`traffic` åŸŸå·²åºŸå¼ƒï¼Œç»Ÿä¸€ä½¿ç”¨ `analytics`

### æŠ€æœ¯å˜æ›´

#### 1. ç»„ä»¶é…ç½®ç³»ç»Ÿï¼ˆP0ï¼‰
- **ç»„ä»¶å­˜å‚¨**ï¼š`config/collection_components/{platform}/{component}.yaml`
- **ç»„ä»¶ç±»å‹**ï¼šloginã€navigationã€date_pickerã€exportï¼ˆå„æ•°æ®åŸŸï¼‰ã€verification
- **ç»„ä»¶æ ¼å¼**ï¼šYAML æè¿°çš„ Playwright æ“ä½œæ­¥éª¤

```yaml
# config/collection_components/shopee/orders_export.yaml
name: shopee_orders_export
platform: shopee
type: export
data_domain: orders
steps:
  - action: click
    selector: "button:has-text('å¯¼å‡ºæ•°æ®')"
  - action: wait_for_download
    timeout: 60000
```

#### 2. ç»„ä»¶å½•åˆ¶å·¥å…·é‡æ„ï¼ˆP0ï¼‰â­ **NEW**

**å½“å‰é—®é¢˜ï¼ˆå®é™…å½•åˆ¶å‘ç°ï¼‰**ï¼š
1. âŒ å½•åˆ¶éloginç»„ä»¶æ—¶ï¼Œåªå¯¼èˆªåˆ°ç™»å½•é¡µï¼Œä¸æ‰§è¡Œå·²å½•åˆ¶çš„login.yaml
2. âŒ æœªå¯ç”¨Playwright Inspectorï¼Œæ— æ³•æ•è·ç”¨æˆ·æ“ä½œï¼Œåªè®°å½•navigateæ­¥éª¤
3. âš ï¸ è¶…æ—¶é…ç½®ç®€å•ï¼Œç½‘ç»œæ…¢æ—¶å®¹æ˜“å¤±è´¥

**é‡æ„æ–¹æ¡ˆï¼ˆComponentRecorder V2ï¼‰**ï¼š

**Phase 1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆP0 - å¿…é¡»ï¼‰**
- âœ… **è‡ªåŠ¨ç™»å½•åŠŸèƒ½**ï¼š
  - å½•åˆ¶éloginç»„ä»¶æ—¶ï¼Œè‡ªåŠ¨åŠ è½½å¹¶æ‰§è¡Œ`{platform}/login.yaml`
  - loginç»„ä»¶ä¸å­˜åœ¨æ—¶ï¼Œé™çº§ä¸ºæ‰‹åŠ¨ç™»å½•ï¼ˆå¯¼èˆªåˆ°ç™»å½•é¡µ + ç­‰å¾…ç”¨æˆ·æŒ‰Enterï¼‰
  - ä½¿ç”¨ç°æœ‰çš„`ComponentLoader`å’Œ`CollectionExecutorV2`æ‰§è¡Œç™»å½•
- âœ… **Playwright Inspectoré›†æˆ**ï¼š
  - ä½¿ç”¨`page.pause()`å¯åŠ¨Inspectorï¼Œæ•è·æ‰€æœ‰ç”¨æˆ·æ“ä½œ
  - æ”¯æŒ`--no-inspector`å‚æ•°ï¼Œä»…ä½¿ç”¨Traceå½•åˆ¶ï¼ˆæ— äº¤äº’ï¼‰
- âœ… **å¢å¼ºè¶…æ—¶é…ç½®**ï¼š
  - å¤šçº§è¶…æ—¶ç­–ç•¥ï¼šdomcontentloaded(60s) â†’ load(90s) â†’ ä¸ç­‰å¾…(120s)
  - è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š2æ¬¡ï¼‰
  - å¯é€‰çš„networkidleç­‰å¾…ï¼ˆä¸é˜»å¡ï¼‰
- âœ… **é›†æˆå¼¹çª—å¤„ç†**ï¼š
  - è‡ªåŠ¨ç™»å½•å‰åè°ƒç”¨`UniversalPopupHandler.close_popups()`
  - å½•åˆ¶å‰å…³é—­å¼¹çª—ï¼Œé¿å…å¹²æ‰°

**Phase 2: å¢å¼ºåŠŸèƒ½ï¼ˆP1 - é‡è¦ï¼‰**
- âœ… **Traceå½•åˆ¶å’Œä¿å­˜**ï¼š
  - å¯ç”¨`context.tracing.start()`ï¼Œå½•åˆ¶å®Œæ•´æ“ä½œå†å²
  - ä¿å­˜ä¸º`temp/traces/{platform}_{component}_{timestamp}.zip`
  - æä¾›`playwright show-trace`å‘½ä»¤æŸ¥çœ‹
- âœ… **æ™ºèƒ½YAMLç”Ÿæˆ**ï¼š
  - æ ¹æ®ç»„ä»¶ç±»å‹ç”Ÿæˆåˆé€‚çš„`success_criteria`ï¼ˆlogin: URLè·³è½¬ + èœå•å‡ºç°ï¼‰
  - è‡ªåŠ¨æ·»åŠ `popup_handling`å’Œ`verification_handlers`é…ç½®
  - ç”Ÿæˆæ¨¡æ¿æ­¥éª¤ï¼ˆå¦‚æœæœªæ•è·åˆ°æ“ä½œï¼‰
- âœ… **éªŒè¯ç æ£€æµ‹æç¤º**ï¼š
  - å½•åˆ¶è¿‡ç¨‹ä¸­å®æ—¶æ£€æµ‹éªŒè¯ç å…ƒç´ 
  - æç¤ºç”¨æˆ·éªŒè¯ç å¤„ç†ç­–ç•¥ï¼ˆç³»ç»Ÿè¿è¡Œæ—¶è‡ªåŠ¨æš‚åœï¼‰

**Phase 3: é«˜çº§åŠŸèƒ½ï¼ˆP2 - å¯é€‰ï¼‰**
- âš ï¸ ä»Traceè‡ªåŠ¨æå–selector
- âš ï¸ å½•åˆ¶åè‡ªåŠ¨æµ‹è¯•ï¼ˆè°ƒç”¨`tools/test_component.py`ï¼‰
- âš ï¸ å¤šç»„ä»¶æ‰¹é‡å½•åˆ¶
- âš ï¸ AIè¾…åŠ©ä¼˜åŒ–YAML

**å·¥å…·è·¯å¾„**ï¼š`tools/record_component.py`ï¼ˆé‡æ„ç‰ˆï¼‰
**è¾“å‡ºæ ¼å¼**ï¼šYAMLç»„ä»¶ + Traceæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
**é¢„æœŸæ”¹è¿›**ï¼šæ˜“ç”¨æ€§â†‘300%ï¼Œå‡†ç¡®æ€§â†‘500%ï¼Œå¯è°ƒè¯•æ€§â†‘1000%

#### 3. é‡‡é›†æ‰§è¡Œå¼•æ“ï¼ˆP0ï¼‰
- **å¼•æ“è·¯å¾„**ï¼š`modules/apps/collection_center/executor_v2.py`
- **æ‰§è¡Œæ–¹å¼**ï¼šåŠ¨æ€åŠ è½½å¹¶ç»„è£…ç»„ä»¶åºåˆ—ï¼ˆlogin â†’ navigation â†’ date_picker â†’ exportï¼‰
- **çŠ¶æ€å›è°ƒ**ï¼šæ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡å›è°ƒå‡½æ•°æ¨é€çŠ¶æ€
- **è¶…æ—¶æ§åˆ¶**ï¼šå•ç»„ä»¶è¶…æ—¶ 5 åˆ†é’Ÿï¼Œå•ä»»åŠ¡æ€»è¶…æ—¶ 30 åˆ†é’Ÿ
- **å–æ¶ˆæ£€æµ‹**ï¼šæ¯ä¸ªæ­¥éª¤åæ£€æŸ¥ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ

#### 4. åç«¯ API é‡æ„ï¼ˆP0ï¼‰â­ **Contract-Firstå¼€å‘**
- **é…ç½®ç®¡ç† API**ï¼š`GET/POST/PUT/DELETE /api/collection/configs`
- **è´¦å·åˆ—è¡¨ API**ï¼š`GET /api/collection/accounts`
  - ä» `platform_accounts` è¡¨è¯»å–ï¼ˆå·²å®Œæˆæ•°æ®åº“è¿ç§»ï¼‰âœ…
  - è¿”å›è„±æ•ä¿¡æ¯ï¼ˆç§»é™¤passwordç­‰æ•æ„Ÿå­—æ®µï¼‰
  - æ”¯æŒå¹³å°ç­›é€‰ï¼š`?platform=shopee`
- **ä»»åŠ¡ç®¡ç† API**ï¼š
  - `POST /api/collection/tasks` - åˆ›å»ºä»»åŠ¡
  - `GET /api/collection/tasks` - åˆ—è¡¨æŸ¥è¯¢
  - `DELETE /api/collection/tasks/{id}` - å–æ¶ˆä»»åŠ¡
  - `POST /api/collection/tasks/{id}/retry` - é‡è¯•å¤±è´¥ä»»åŠ¡ï¼ˆåˆ›å»ºæ–°ä»»åŠ¡ï¼Œé‡æ–°å¼€å§‹ï¼‰
  - `POST /api/collection/tasks/{id}/resume` - ç»§ç»­æš‚åœä»»åŠ¡ï¼ˆä»æš‚åœç‚¹ç»§ç»­ï¼‰
  - `POST /api/collection/tasks/{id}/verify` - æäº¤éªŒè¯ç ï¼ˆæ”¯æŒå¤šç§éªŒè¯ç ç±»å‹ï¼‰
- **å†å²æŸ¥è¯¢ API**ï¼š`GET /api/collection/history` åˆ†é¡µæŸ¥è¯¢é‡‡é›†å†å²å’Œç»Ÿè®¡

**Contract-Firstå¼ºåˆ¶è¦æ±‚**ï¼ˆ2025-12-19èµ·ç”Ÿæ•ˆï¼‰â­â­â­ï¼š
1. âœ… æ‰€æœ‰Pydanticæ¨¡å‹å¿…é¡»å®šä¹‰åœ¨`backend/schemas/collection.py`
2. âœ… æ‰€æœ‰APIç«¯ç‚¹å¿…é¡»åŒ…å«`response_model`å‚æ•°
3. âœ… æ‰€æœ‰è¯·æ±‚/å“åº”å¿…é¡»æœ‰æ˜ç¡®çš„ç±»å‹å®šä¹‰
4. âœ… å‚è€ƒç°æœ‰schemasï¼š`backend/schemas/account.py`, `backend/schemas/common.py`

#### 5. æ•°æ®åº“æ¨¡å‹æ–°å¢ï¼ˆP0ï¼‰â­
- `collection_configs` è¡¨ï¼šå­˜å‚¨é‡‡é›†é…ç½®æ¨¡æ¿
  - æ–°å¢å­—æ®µï¼š`sub_domains: List[str]`ï¼ˆæ”¹ä¸ºæ•°ç»„ï¼Œæ”¯æŒå¤šé€‰ï¼‰
  - è´¦å·ç­–ç•¥ï¼š`account_ids=[]` è¡¨ç¤ºä½¿ç”¨è¯¥å¹³å°æ‰€æœ‰æ´»è·ƒè´¦å·
- `collection_tasks` è¡¨ï¼šå­˜å‚¨ä»»åŠ¡æ‰§è¡Œè®°å½•ï¼ˆå¢å¼ºç°æœ‰è¡¨ï¼Œå¤ç”¨ `account` å­—æ®µï¼‰
  - ä»»åŠ¡ç²’åº¦è°ƒæ•´ï¼šä¸€ä¸ªä»»åŠ¡ = ä¸€ä¸ªè´¦å· + æ‰€æœ‰é…ç½®çš„æ•°æ®åŸŸ
  - æ–°å¢å­—æ®µï¼š
    - `data_domains: List[str]`ï¼ˆè¦é‡‡é›†çš„æ•°æ®åŸŸåˆ—è¡¨ï¼‰
    - `sub_domains: List[str]`ï¼ˆserviceså­åŸŸåˆ—è¡¨ï¼‰
    - `total_domains: int`ï¼ˆæ€»æ•°æ®åŸŸæ•°é‡ï¼‰
    - `completed_domains: List[str]`ï¼ˆå·²å®Œæˆçš„æ•°æ®åŸŸï¼‰
    - `failed_domains: List[Dict]`ï¼ˆå¤±è´¥çš„æ•°æ®åŸŸåŠåŸå› ï¼‰
    - `current_domain: str`ï¼ˆå½“å‰æ­£åœ¨é‡‡é›†çš„æ•°æ®åŸŸï¼‰
  - çŠ¶æ€å¢å¼ºï¼šæ”¯æŒ `partial_success`ï¼ˆéƒ¨åˆ†æˆåŠŸï¼‰
- `collection_task_logs` è¡¨ï¼šå­˜å‚¨ä»»åŠ¡è¯¦ç»†æ—¥å¿—

#### 6. å‰ç«¯é¡µé¢å®ç°ï¼ˆP0/P1ï¼‰
- **CollectionConfig.vue**ï¼š
  - é…ç½®åˆ—è¡¨ã€æ–°å¢/ç¼–è¾‘é…ç½®è¡¨å•
  - **é…ç½®å‘½åè‡ªåŠ¨ç”Ÿæˆ**ï¼š`{platform}-{domain(s)}-v{n}` æ ¼å¼ï¼Œå¯ç¼–è¾‘ â­
  - **è´¦å·é€‰æ‹©**ï¼šæ‰‹åŠ¨å¤šé€‰è´¦å·ï¼ˆä¿ç•™ï¼‰
  - **æ•°æ®åŸŸå¤šé€‰**ï¼šæ”¯æŒå…¨é€‰6ä¸ªæ•°æ®åŸŸ
  - **æœåŠ¡å­åŸŸå¢å¼º**ï¼šæ”¯æŒå¤šé€‰æ•°ç»„ + "å…¨é€‰"å¿«æ·æŒ‰é’® â­
  - **æ—¥æœŸé€‰æ‹©å¹³å°å¯¹é½**ï¼šç§»é™¤ç‹¬ç«‹granularityï¼Œä½¿ç”¨å¹³å°é¢„è®¾ï¼ˆä»Šå¤©/æ˜¨å¤©/7å¤©/30å¤©/è‡ªå®šä¹‰ï¼‰â­
  - **å¿«é€Ÿé…ç½®åŠŸèƒ½**ï¼š3æ­¥å‘å¯¼ï¼Œä¸€é”®åˆ›å»ºæ ‡å‡†å®šæ—¶é‡‡é›†é…ç½®ï¼ˆæ—¥åº¦+å‘¨åº¦+æœˆåº¦ï¼‰â­
  - **å½•åˆ¶å·¥å…·å…¥å£**ï¼šå‰ç«¯ç”Ÿæˆå½•åˆ¶å‘½ä»¤ï¼Œä¸€é”®å¤åˆ¶æ‰§è¡Œ â­
- **CollectionTasks.vue**ï¼šä»»åŠ¡åˆ—è¡¨ã€æ‰‹åŠ¨è§¦å‘é‡‡é›†ï¼ˆå¿«é€Ÿé‡‡é›†é¢æ¿ï¼‰ã€å®æ—¶è¿›åº¦å±•ç¤ºã€éªŒè¯ç å¤„ç†
- **CollectionHistory.vue**ï¼šå†å²è®°å½•åˆ—è¡¨ã€æˆåŠŸç‡ç»Ÿè®¡å›¾è¡¨ã€æ—¥å¿—è¯¦æƒ…

#### 7. WebSocket å®æ—¶çŠ¶æ€æ¨é€ï¼ˆP1ï¼‰
- å®ç° `/ws/collection/{task_id}` WebSocket ç«¯ç‚¹
- å‰ç«¯ `useCollectionStatus()` composable å¤„ç†è¿æ¥/é‡è¿/æ¶ˆæ¯
- æ”¯æŒéªŒè¯ç é€šçŸ¥å’Œæˆªå›¾å±•ç¤º

#### 8. å®šæ—¶è°ƒåº¦åŠŸèƒ½ï¼ˆP1ï¼‰â­
- ä½¿ç”¨ APScheduler å®ç° cron å¼å®šæ—¶é‡‡é›†
- **æ ‡å‡†è°ƒåº¦æ—¶é—´**ï¼š
  - **æ—¥åº¦å®æ—¶**ï¼šæ¯å¤©4æ¬¡ï¼ˆ06:00, 12:00, 18:00, 22:00ï¼‰é‡‡é›†"ä»Šå¤©"æ•°æ®
  - **å‘¨åº¦æ±‡æ€»**ï¼šæ¯å‘¨ä¸€ 05:00 é‡‡é›†"æœ€è¿‘7å¤©"æ•°æ®
  - **æœˆåº¦æ±‡æ€»**ï¼šæ¯æœˆ1å· 05:00 é‡‡é›†"æœ€è¿‘30å¤©"æ•°æ®
- **å¿«é€Ÿé…ç½®**ï¼šä¸€é”®åˆ›å»ºæ ‡å‡†å®šæ—¶é‡‡é›†é…ç½®ï¼ˆ3ä¸ªé…ç½® Ã— 1ä¸ªå¹³å°ï¼‰
- å‰ç«¯ Cron è¡¨è¾¾å¼å¯è§†åŒ–é…ç½®ç»„ä»¶ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

#### 9. ç”Ÿäº§ç¯å¢ƒå®¹é”™æœºåˆ¶ï¼ˆP0ï¼‰â­ **NEW**

**èƒŒæ™¯**: ç”Ÿäº§ç¯å¢ƒå­˜åœ¨5å¤§å¸¸è§çªå‘æƒ…å†µï¼ˆéªŒè¯ç 30%ã€å¼¹çª—20%ã€ç½‘ç»œå»¶è¿Ÿ15%ã€é¡µé¢æ”¹ç‰ˆ5%ã€æµè§ˆå™¨å´©æºƒ2%ï¼‰ï¼Œéœ€è¦å®Œå–„çš„å®¹é”™æœºåˆ¶ç¡®ä¿é‡‡é›†æˆåŠŸç‡â‰¥95%ã€‚

**5å±‚å®¹é”™æœºåˆ¶**ï¼š

**ç¬¬1å±‚ï¼šä»»åŠ¡çº§è¿‡æ»¤ï¼ˆæœ€æ—©ï¼‰**
- **è´¦å·èƒ½åŠ›æ£€æŸ¥**ï¼š
  - `local_accounts.py`æ·»åŠ `capabilities`å­—æ®µ
  - åˆ›å»ºä»»åŠ¡å‰æ£€æŸ¥è´¦å·æ˜¯å¦æ”¯æŒè¯¥æ•°æ®åŸŸ
  - ç¤ºä¾‹ï¼šå…¨çƒè´¦å·ä¸æ”¯æŒservicesåŸŸï¼Œè‡ªåŠ¨è¿‡æ»¤
- **å®ç°ä½ç½®**ï¼š`backend/services/task_service.py` (create_taskæ–¹æ³•)

**ç¬¬2å±‚ï¼šé¢„æ£€æµ‹ï¼ˆæ‰§è¡Œå‰ï¼‰**
- **URLå¯è®¿é—®æ€§æ£€æµ‹**ï¼š
  - å¯¼èˆªå‰å¿«é€Ÿæ£€æŸ¥URLæ˜¯å¦è¿”å›404/403
  - å¤±è´¥ç­–ç•¥ï¼š`skip_task` / `fail_task` / `continue`
- **å…³é”®å…ƒç´ å­˜åœ¨æ€§**ï¼š
  - æ£€æŸ¥é¡µé¢æ˜¯å¦æœ‰å¿…éœ€çš„åŠŸèƒ½æ¨¡å—
  - ç¤ºä¾‹ï¼šæ£€æŸ¥`.services-module`æ˜¯å¦å­˜åœ¨
- **YAMLé…ç½®**ï¼š
  ```yaml
  pre_check:
    - type: url_accessible
      url: "{{account.login_url}}/services"
      on_failure: skip_task
    - type: element_exists
      selector: ".services-module"
      on_failure: skip_task
  ```
- **å®ç°ä½ç½®**ï¼š`modules/apps/collection_center/executor_v2.py` (_run_pre_checksæ–¹æ³•)

**ç¬¬3å±‚ï¼šå¯é€‰æ­¥éª¤ï¼ˆæ‰§è¡Œä¸­ï¼‰** â­ **æœ€é‡è¦**
- **optionalå‚æ•°æ”¯æŒ**ï¼š
  - æ­¥éª¤æ·»åŠ `optional: true`æ ‡è®°
  - å…ƒç´ ä¸å­˜åœ¨æ—¶ï¼Œå¿«é€Ÿæ£€æµ‹ï¼ˆ1ç§’ï¼‰å¹¶è·³è¿‡
  - ä¸å½±å“æ•´ä½“ä»»åŠ¡æ‰§è¡Œ
- **YAMLé…ç½®**ï¼š
  ```yaml
  - action: click
    selector: "role=button[name='å…³é—­å¼¹çª—']"
    optional: true  # å¼¹çª—ä¸å‡ºç°è‡ªåŠ¨è·³è¿‡
  ```
- **å®ç°ä½ç½®**ï¼š`modules/apps/collection_center/executor_v2.py` (_execute_stepæ–¹æ³•)
- **å½±å“**: è§£å†³å¼¹çª—ä¸å‡ºç°å¯¼è‡´å¡æ­»çš„é—®é¢˜

**ç¬¬4å±‚ï¼šæ™ºèƒ½é‡è¯•ï¼ˆæ‰§è¡Œä¸­ï¼‰**
- **æ­¥éª¤çº§é‡è¯•æœºåˆ¶**ï¼š
  - å¤±è´¥åè‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
  - é‡è¯•å‰è‡ªåŠ¨å…³é—­å¼¹çª—ï¼ˆå¯èƒ½æ˜¯å¼¹çª—é®æŒ¡ï¼‰
  - é‡è¯•å»¶è¿Ÿå¯é…ç½®ï¼ˆé»˜è®¤2ç§’ï¼‰
- **YAMLé…ç½®**ï¼š
  ```yaml
  - action: click
    selector: ".date-picker"
    retry:
      max_attempts: 3
      delay: 2000
      on_retry: close_popup
  ```
- **è‡ªé€‚åº”è¶…æ—¶**ï¼š
  - ç¬¬1æ¬¡ï¼šå¿«é€Ÿæ£€æµ‹ï¼ˆ1ç§’ï¼‰
  - ç¬¬2æ¬¡ï¼šå…³é—­å¼¹çª—åé‡è¯•ï¼ˆ10ç§’ï¼‰
  - ç¬¬3æ¬¡ï¼šç­‰å¾…ç½‘ç»œç©ºé—²ï¼ˆ30ç§’ï¼‰
- **å®ç°ä½ç½®**ï¼š`modules/apps/collection_center/executor_v2.py` (_execute_step_with_retryæ–¹æ³•)

**ç¬¬5å±‚ï¼šé™çº§ç­–ç•¥ï¼ˆå¤±è´¥åï¼‰**
- **å¤šç§æ‰§è¡Œæ–¹å¼**ï¼š
  - primary_methodå¤±è´¥åå°è¯•fallback
  - ç¤ºä¾‹ï¼šç‚¹å‡»å¯¼å‡º â†’ å¿«æ·é”® â†’ èœå•æ“ä½œ
- **YAMLé…ç½®**ï¼š
  ```yaml
  - action: export
    primary_method: "click_button"
    fallback_methods:
      - "keyboard_shortcut"  # Ctrl+E
      - "menu_export"
  ```
- **å®ç°ä½ç½®**ï¼š`modules/apps/collection_center/executor_v2.py` (_execute_with_fallbackæ–¹æ³•)

**è´¦å·èƒ½åŠ›æ•°æ®ç»“æ„**ï¼š
```python
# local_accounts.py
{
    "account_id": "miaoshou_global_001",
    "type": "global",
    "capabilities": {  # æ–°å¢
        "orders": True,
        "products": True,
        "services": False,  # å…¨çƒè´¦å·ä¸æ”¯æŒ
        "analytics": True,
        "finance": True,
        "inventory": True
    }
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- æˆåŠŸç‡: 95% â†’ **99%**
- äººå·¥ä»‹å…¥é¢‘ç‡: 30% â†’ **10%**
- å¹³å‡è€—æ—¶: 25åˆ†é’Ÿ â†’ **18åˆ†é’Ÿ**
- è‡ªåŠ¨æ¢å¤ç‡: 50% â†’ **90%**

#### 10. å‰ç«¯è´¦å·ç®¡ç†ç³»ç»Ÿï¼ˆP1ï¼‰â­ **NEW - äº§å“åŒ–å‡çº§** âœ… **å·²å®Œæˆ (2025-12-14)**

**èƒŒæ™¯**: å½“å‰è´¦å·é…ç½®é€šè¿‡æ‰‹åŠ¨ç¼–è¾‘ `local_accounts.py` æ–‡ä»¶ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- éœ€è¦Pythonè¯­æ³•çŸ¥è¯†ï¼Œä¸é€‚åˆæ™®é€šç”¨æˆ·
- åº—é“ºè¾ƒå¤šæ—¶éš¾ä»¥ç®¡ç†ï¼ˆå¦‚Shopeeä¸€ä¸ªä¸»è´¦å·ä¸‹æœ‰å¤šä¸ªåº—é“ºï¼‰
- å¯†ç æ˜æ–‡å­˜å‚¨ï¼Œå®‰å…¨éšæ‚£
- æ— æ³•åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹
- ä¸é€‚åˆå•†ä¸šåŒ–å‡ºå”®

**è§£å†³æ–¹æ¡ˆ**: å‰ç«¯GUIè´¦å·ç®¡ç†ç³»ç»Ÿ + æ•°æ®åº“åŠ å¯†å­˜å‚¨

**å®æ–½çŠ¶æ€**: âœ… **å®Œå…¨å®ç°å¹¶è¿ç§»å®Œæˆ**
- æ•°æ®åº“è¡¨ `platform_accounts` å·²åˆ›å»º
- å¯†ç åŠ å¯†æœåŠ¡å·²å®ç°ï¼ˆFernetåŠ å¯†ï¼‰
- åç«¯APIå®Œæ•´å®ç°ï¼ˆCRUD + æ‰¹é‡æ“ä½œ + ç»Ÿè®¡ï¼‰âœ… **Contract-Firstæ¶æ„**
- å‰ç«¯è´¦å·ç®¡ç†é¡µé¢å·²å®Œæˆ
- æ•°æ®é‡‡é›†æ¨¡å—å·²å®Œå…¨è¿ç§»åˆ°æ•°æ®åº“
- `local_accounts.py` å·²ä¸å†ä½¿ç”¨ï¼ˆä»…ä½œå¤‡ä»½ä¿ç•™ï¼‰

**Contract-Firstå®æ–½**ï¼ˆ2025-12-19å·²å®Œæˆï¼‰â­ï¼š
- âœ… Pydanticæ¨¡å‹å·²å®šä¹‰åœ¨`backend/schemas/account.py`ï¼ˆ5ä¸ªæ¨¡å‹ï¼‰
- âœ… æ‰€æœ‰APIç«¯ç‚¹å·²æ·»åŠ `response_model`å‚æ•°
- âœ… å®Œæ•´çš„ç±»å‹å®šä¹‰å’ŒéªŒè¯
- ğŸ“– å‚è€ƒï¼š`docs/CONTRACT_FIRST_FINAL_REPORT.md`

**æ ¸å¿ƒåŠŸèƒ½**:
1. **æ•°æ®åº“è¡¨** - `platform_accounts` è¡¨
   - è´¦å·åŸºæœ¬ä¿¡æ¯ï¼ˆIDã€å¹³å°ã€åº—é“ºåã€ç±»å‹ã€åŒºåŸŸï¼‰
   - ç™»å½•ä¿¡æ¯ï¼ˆç”¨æˆ·åã€åŠ å¯†å¯†ç ã€ç™»å½•URLï¼‰
   - èƒ½åŠ›é…ç½®ï¼ˆcapabilities JSONBå­—æ®µï¼‰
   - å®¡è®¡å­—æ®µï¼ˆåˆ›å»º/æ›´æ–°æ—¶é—´ã€æ“ä½œäººï¼‰

2. **å¯†ç åŠ å¯†æœåŠ¡**
   - ä½¿ç”¨ Fernet å¯¹ç§°åŠ å¯†
   - å¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡
   - åŠ å¯†/è§£å¯†API

3. **åç«¯API** - `/api/accounts/`
   - CRUDæ“ä½œï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰
   - ä» `local_accounts.py` å¯¼å…¥
   - å¯¼å‡ºåˆ°é…ç½®æ–‡ä»¶ï¼ˆå¤‡ä»½ï¼‰
   - æ‰¹é‡æ·»åŠ åº—é“ºï¼ˆåŒä¸€ä¸»è´¦å·å¤šåº—é“ºï¼‰

4. **å‰ç«¯ç•Œé¢**
   - è´¦å·åˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰ã€æœç´¢ï¼‰
   - åˆ›å»º/ç¼–è¾‘å¯¹è¯æ¡†ï¼ˆåˆ†Tab: åŸºæœ¬ä¿¡æ¯/ç™»å½•ä¿¡æ¯/èƒ½åŠ›é…ç½®ï¼‰
   - æ‰¹é‡æ·»åŠ åº—é“ºå‘å¯¼ï¼ˆä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªåº—é“ºï¼‰
   - è´¦å·ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»æ•°ã€æ´»è·ƒã€å¼‚å¸¸ï¼‰
   - åº—é“ºç±»å‹æ ‡è¯†ï¼ˆæœ¬åœ°åº—/å…¨çƒåº—ï¼‰
   - èƒ½åŠ›é…ç½®å¯è§†åŒ–ï¼ˆå¤é€‰æ¡†ï¼‰

**åº—é“ºçº§åˆ«é…ç½®ç¤ºä¾‹**:
```python
# ä¸€ä¸ªShopeeä¸»è´¦å·ï¼Œæ‹†åˆ†ä¸º3ä¸ªåº—é“ºè®°å½•
{
    "account_id": "shopee_sg_local_hongxi",
    "parent_account": "hongxikeji:main",  # ä¸»è´¦å·æ ‡è¯†
    "shop_type": "local",
    "shop_region": "SG",
    "capabilities": {
        "services": True  # æœ¬åœ°åº—æ”¯æŒå®¢æœæ•°æ®
    }
}
{
    "account_id": "shopee_global_hongxi",
    "parent_account": "hongxikeji:main",
    "shop_type": "global",
    "shop_region": "GLOBAL",
    "capabilities": {
        "services": False  # å…¨çƒåº—ä¸æ”¯æŒå®¢æœæ•°æ®
    }
}
```

**æ¸è¿›å¼è¿ç§»**:
- **é˜¶æ®µ1**: åˆ›å»ºè¡¨å’ŒAPIï¼Œä¿æŒå‘åå…¼å®¹
- **é˜¶æ®µ2**: å®ç°å‰ç«¯ç•Œé¢ï¼Œæä¾›"å¯¼å…¥"åŠŸèƒ½
- **é˜¶æ®µ3**: å®Œå…¨åˆ‡æ¢åˆ°æ•°æ®åº“ï¼Œ`local_accounts.py` ä½œä¸ºå¤‡ä»½

**é¢„æœŸæ•ˆæœ**:
- ç”¨æˆ·ä½“éªŒ: æ‰‹åŠ¨ç¼–è¾‘ â†’ **GUIæ“ä½œ**
- ç®¡ç†æ•ˆç‡: é€è¡Œç¼–è¾‘ â†’ **æ‰¹é‡ç®¡ç†**
- å®‰å…¨æ€§: æ˜æ–‡å¯†ç  â†’ **åŠ å¯†å­˜å‚¨**
- äº§å“åŒ–: å¼€å‘è€…å·¥å…· â†’ **å•†ä¸šçº§äº§å“**

#### 11. äº‘ç«¯é€‚é…å¢å¼ºï¼ˆP2ï¼‰
- ä»£ç†IPæ¥å£é¢„ç•™ï¼šå®šä¹‰ `ProxyProvider` æ¥å£
- Docker headless æ¨¡å¼ä¼˜åŒ–
- æŒ‡çº¹åº“æ‰©å±•
- è¿œç¨‹éªŒè¯ç å¤„ç†æµç¨‹

#### 10. æ–‡ä»¶å¤„ç†æµç¨‹ï¼ˆP0ï¼‰âœ…

**æ–‡ä»¶ä¸‹è½½æœºåˆ¶**ï¼ˆå·²å®ç°ï¼‰ï¼š
- **Playwright Download API**ï¼šè‡ªåŠ¨ç›‘å¬ä¸‹è½½äº‹ä»¶ï¼Œç¡®ä¿æ–‡ä»¶å®Œæ•´ä¸‹è½½
- **ä¸‹è½½å®Œæ•´æ€§ä¿è¯**ï¼šç­‰å¾…ä¸‹è½½å®Œæˆï¼ŒéªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼Œæ— ä¸´æ—¶æ–‡ä»¶æ®‹ç•™
- **ä¸´æ—¶ä¸‹è½½**ï¼š`temp/downloads/{task_uuid}/` - æµè§ˆå™¨ä¸‹è½½åŸå§‹æ–‡ä»¶
- **æœ€ç»ˆå­˜å‚¨**ï¼š`data/raw/YYYY/` - æ ‡å‡†å‘½åæ–‡ä»¶ + `.meta.json`
- **è‡ªåŠ¨æ³¨å†Œ**ï¼šé‡‡é›†å®Œæˆåè‡ªåŠ¨è°ƒç”¨ `FileRegistrationService` æ³¨å†Œåˆ° `catalog_files`

**å¹³å°å·®å¼‚åŒ–æ”¯æŒ**ï¼ˆç»„ä»¶åŒ–å¤©ç„¶æ”¯æŒï¼‰ï¼š
- **ç›´æ¥ä¸‹è½½**ï¼šç‚¹å‡»å¯¼å‡º â†’ ç«‹å³ä¸‹è½½ï¼ˆShopee/TikTokï¼‰
- **ç”Ÿæˆåä¸‹è½½**ï¼šè¯·æ±‚ç”Ÿæˆ â†’ ç­‰å¾…å®Œæˆ â†’ é€‰æ‹©æ–‡ä»¶ â†’ ä¸‹è½½ï¼ˆå¦™æ‰‹ERPï¼‰
- **å¼‚æ­¥ä¸‹è½½**ï¼šè¯·æ±‚æŠ¥å‘Š â†’ åå°å¤„ç† â†’ è¿›å…¥åˆ—è¡¨ â†’ ä¸‹è½½ï¼ˆAmazonç­‰ï¼‰
- **å®ç°æ–¹å¼**ï¼šæ¯ä¸ªå¹³å°ç‹¬ç«‹çš„exportç»„ä»¶YAMLï¼Œæ”¯æŒå¤æ‚å¤šæ­¥éª¤æµç¨‹

**å®ç°ä½ç½®**ï¼š
- `modules/apps/collection_center/executor_v2.py` - `_execute_export_component()`æ–¹æ³•
- `backend/services/file_registration_service.py` - æ–‡ä»¶æ³¨å†Œå’Œç§»åŠ¨æœåŠ¡

#### 11. è¾¹ç•Œåœºæ™¯å¤„ç†ï¼ˆP1ï¼‰â­

**ä»»åŠ¡åˆ›å»ºç²’åº¦**ï¼ˆä¼˜åŒ–ï¼‰ï¼š
- **ä¸€è´¦å·ä¸€ä»»åŠ¡**ï¼šä¸€ä¸ªä»»åŠ¡åŒ…å«è¯¥è´¦å·çš„æ‰€æœ‰æ•°æ®åŸŸé‡‡é›†
- **æµè§ˆå™¨å¤ç”¨**ï¼šä¸€æ¬¡ç™»å½•é‡‡é›†æ‰€æœ‰æ•°æ®åŸŸï¼ˆè€Œéæ¯åŸŸç™»å½•ä¸€æ¬¡ï¼‰
- **éƒ¨åˆ†æˆåŠŸæ”¯æŒ**ï¼šå•ä¸ªæ•°æ®åŸŸå¤±è´¥ä¸å½±å“å…¶ä»–åŸŸç»§ç»­æ‰§è¡Œ
- **è¿›åº¦è·Ÿè¸ªå¢å¼º**ï¼š`completed_domains`ã€`failed_domains`ã€`current_domain`å­—æ®µ
- **çŠ¶æ€åˆ¤å®š**ï¼š
  - `completed`ï¼šæ‰€æœ‰æ•°æ®åŸŸæˆåŠŸ
  - `partial_success`ï¼šéƒ¨åˆ†æ•°æ®åŸŸæˆåŠŸ
  - `failed`ï¼šæ‰€æœ‰æ•°æ®åŸŸå¤±è´¥

**å¤šè´¦å·æ‰¹é‡é‡‡é›†ç­–ç•¥**ï¼š
- åŒä¸€å¹³å°å¤šè´¦å·ï¼š**é¡ºåºæ‰§è¡Œ**ï¼ˆé¿å…è´¦å·é—´ç™»å½•çŠ¶æ€å¹²æ‰°ï¼‰
- ä¸åŒå¹³å°ï¼š**å¯å¹¶è¡Œæ‰§è¡Œ**ï¼ˆå— `MAX_COLLECTION_TASKS` é™åˆ¶ï¼Œé»˜è®¤ 3ï¼‰
- **è´¦å·è§£æ**ï¼š`account_ids=[]` è¡¨ç¤ºä½¿ç”¨è¯¥å¹³å°æ‰€æœ‰æ´»è·ƒè´¦å·ï¼ˆæ‰§è¡Œæ—¶åŠ¨æ€è·å–ï¼‰

**é•¿æ—¶é—´ä»»åŠ¡å¤„ç†**ï¼š
- å•ç»„ä»¶è¶…æ—¶ï¼š5 åˆ†é’Ÿ
- å•ä»»åŠ¡æ€»è¶…æ—¶ï¼š30 åˆ†é’Ÿ
- è¶…æ—¶åï¼šæ ‡è®°å¤±è´¥ï¼Œä¿å­˜æˆªå›¾ï¼Œè®°å½•æ—¥å¿—
- æœåŠ¡é‡å¯æ¢å¤ï¼šæ£€æŸ¥ `running` çŠ¶æ€ä»»åŠ¡ï¼Œæ ‡è®°ä¸º `interrupted`

**è¿œç¨‹éªŒè¯ç å¤„ç†**ï¼š
1. æ£€æµ‹åˆ°éªŒè¯ç  â†’ æˆªå›¾ä¿å­˜åˆ° `temp/screenshots/{task_id}/`
2. WebSocket æ¨é€ `verification_required` + `screenshot_url`
3. å‰ç«¯æ˜¾ç¤ºæˆªå›¾å’Œè¾“å…¥æ¡†ï¼ˆæ ¹æ®éªŒè¯ç ç±»å‹ï¼šè¾“å…¥æ¡†æˆ–"å·²æ‰‹åŠ¨å®Œæˆ"æŒ‰é’®ï¼‰
4. ç”¨æˆ·æäº¤ â†’ `POST /api/collection/tasks/{id}/verify`
5. åç«¯æ³¨å…¥éªŒè¯ç  â†’ ç»§ç»­æ‰§è¡Œ
6. è¶…æ—¶ç­–ç•¥ï¼š5åˆ†é’Ÿè¶…æ—¶ï¼Œä¿æŒ `paused` çŠ¶æ€ï¼Œç”¨æˆ·å¯é€‰æ‹©ç»§ç»­ç­‰å¾…/è·³è¿‡/å–æ¶ˆ

#### 12. å¼¹çª—è‡ªåŠ¨å¤„ç†ï¼ˆP0ï¼‰âœ…

**ä¸‰å±‚å¼¹çª—å¤„ç†æœºåˆ¶**ï¼ˆå·²å®ç°ï¼‰ï¼š
- **é€šç”¨å¼¹çª—å¤„ç†å™¨**ï¼šå¤„ç†æ‰€æœ‰å¹³å°çš„å¸¸è§å¼¹çª—ï¼ˆ30+é€šç”¨é€‰æ‹©å™¨ï¼‰
- **å¹³å°ç‰¹å®šé…ç½®**ï¼šæ¯ä¸ªå¹³å°ä¸€ä¸ª `popup_config.yaml` é…ç½®æ–‡ä»¶
- **ç»„ä»¶çº§æ§åˆ¶**ï¼šç»„ä»¶YAMLä¸­é…ç½® `popup_handling` ç­–ç•¥

**å¤„ç†ç­–ç•¥**ï¼š
- ç»„ä»¶æ‰§è¡Œå‰åè‡ªåŠ¨æ£€æŸ¥å¼¹çª—ï¼ˆå¯é…ç½®ï¼‰
- æ­¥éª¤æ‰§è¡Œå‰åæ£€æŸ¥å¼¹çª—ï¼ˆæ­¥éª¤çº§é…ç½®ï¼‰
- é”™è¯¯æ—¶æ£€æŸ¥å¼¹çª—ï¼ˆå¯èƒ½æ˜¯å¼¹çª—é®æŒ¡å¯¼è‡´å¤±è´¥ï¼‰
- å¤šç­–ç•¥å…œåº•ï¼šç‚¹å‡»å…³é—­æŒ‰é’® + ESCé”® + è½®è¯¢é‡è¯•
- æ”¯æŒiframeå†…å¼¹çª—å¤„ç†

**å®ç°ä½ç½®**ï¼š
- `modules/apps/collection_center/popup_handler.py` - UniversalPopupHandlerç±»
- `config/collection_components/{platform}/popup_config.yaml` - å¹³å°é…ç½®

#### 13. ç³»ç»Ÿå¯é æ€§å¢å¼ºï¼ˆP1ï¼‰

**èµ„æºæ¸…ç†æœºåˆ¶**ï¼š
- å®šæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼ˆä¸‹è½½æ–‡ä»¶7å¤©ã€æˆªå›¾30å¤©ï¼‰
- å­¤å„¿æµè§ˆå™¨è¿›ç¨‹æ£€æµ‹å’Œæ¸…ç†ï¼ˆå¯åŠ¨æ—¶ + æ¯å°æ—¶æ£€æŸ¥ï¼‰
- ä»»åŠ¡å¼‚å¸¸ç»ˆæ­¢æ—¶çš„èµ„æºå›æ”¶

**æ•°æ®ä¸€è‡´æ€§ä¿éšœ**ï¼š
- æ–‡ä»¶ç§»åŠ¨å’Œcatalogæ³¨å†Œä½¿ç”¨äº‹åŠ¡ä¿è¯åŸå­æ€§
- ä»»åŠ¡çŠ¶æ€æ›´æ–°ä½¿ç”¨ä¹è§‚é”é˜²æ­¢ç«æ€æ¡ä»¶
- æ’é˜Ÿä»»åŠ¡è‡ªåŠ¨å¯åŠ¨æœºåˆ¶ï¼ˆä»»åŠ¡å®Œæˆæ—¶è§¦å‘ï¼‰

**å®‰å…¨å¢å¼º**ï¼š
- WebSocketè¿æ¥JWT Tokenè®¤è¯
- ç»„ä»¶YAMLå†…å®¹å®‰å…¨éªŒè¯ï¼ˆselectoræ³¨å…¥æ£€æµ‹ï¼‰
- æˆªå›¾APIè®¿é—®æ§åˆ¶ï¼ˆä»…ä»»åŠ¡æ‰€å±ç®¡ç†å‘˜å¯è®¿é—®ï¼‰

**ç³»ç»Ÿç›‘æ§**ï¼š
- å¥åº·æ£€æŸ¥ç«¯ç‚¹ `GET /api/collection/health`
- è¿”å›ï¼šè¿è¡Œä¸­ä»»åŠ¡æ•°ã€æ’é˜Ÿä»»åŠ¡æ•°ã€æµè§ˆå™¨æ± çŠ¶æ€

#### 14. ç¯å¢ƒæ„ŸçŸ¥æµè§ˆå™¨é…ç½®ï¼ˆP1ï¼‰â­

**é—®é¢˜**ï¼šå½“å‰ä»£ç å¤šå¤„ç¡¬ç¼–ç  `headless=False`ï¼Œæ— æ³•æ ¹æ®ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **ç¯å¢ƒå˜é‡é©±åŠ¨**ï¼š
  - `ENVIRONMENT`: development / production
  - `PLAYWRIGHT_HEADLESS`: true / false
  - `PLAYWRIGHT_SLOW_MO`: æ…¢é€Ÿæ¨¡å¼ï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰
- **è‡ªåŠ¨é…ç½®**ï¼š
  - å¼€å‘ç¯å¢ƒï¼šé»˜è®¤æœ‰å¤´æ¨¡å¼ï¼ˆheadless=false, slow_mo=100ï¼‰
  - ç”Ÿäº§ç¯å¢ƒï¼šè‡ªåŠ¨æ— å¤´æ¨¡å¼ï¼ˆheadless=true, slow_mo=0ï¼‰
- **è°ƒè¯•æ¨¡å¼æ”¯æŒ**ï¼š
  - APIå‚æ•°ï¼š`debug_mode: bool`
  - å‰ç«¯å¼€å…³ï¼šä¸´æ—¶å¯ç”¨æœ‰å¤´æ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒè°ƒè¯•ç”¨ï¼‰
  - ä»»åŠ¡å­—æ®µï¼š`debug_mode` å­˜å‚¨è°ƒè¯•æ ‡è¯†

**å®ç°ä½ç½®**ï¼š
- `backend/utils/config.py` - Settings.browser_configå±æ€§
- `modules/apps/collection_center/executor_v2.py` - `_start_browser()`æ–¹æ³•
- `frontend/src/views/collection/CollectionTasks.vue` - è°ƒè¯•æ¨¡å¼å¼€å…³

## Impact

### å—å½±å“çš„è§„æ ¼ï¼ˆAffected Specsï¼‰

- **data-collection** (ä¿®æ”¹è§„æ ¼) - æ–°å¢ç»„ä»¶é©±åŠ¨é‡‡é›†ã€API é©±åŠ¨ç®¡ç†ã€é…ç½®ç®¡ç†ã€å®šæ—¶è°ƒåº¦ã€ä»»åŠ¡æ¢å¤ç­‰ Requirement

### Contract-Firstæ¶æ„è¦æ±‚ï¼ˆ2025-12-19æ–°å¢ï¼‰â­â­â­

**æ‰€æœ‰æ–°APIå¿…é¡»éµå®ˆ**ï¼š
1. **Pydanticæ¨¡å‹é›†ä¸­ç®¡ç†**ï¼š
   - æ‰€æœ‰æ¨¡å‹å®šä¹‰åœ¨`backend/schemas/collection.py`
   - ä»`backend/schemas/__init__.py`ç»Ÿä¸€å¯¼å‡º
   - ç¦æ­¢åœ¨`backend/routers/`ä¸­å®šä¹‰æ¨¡å‹

2. **response_modelå¼ºåˆ¶æ·»åŠ **ï¼š
   - æ‰€æœ‰`@router`è£…é¥°å™¨å¿…é¡»åŒ…å«`response_model`å‚æ•°
   - ç¤ºä¾‹ï¼š`@router.get("/tasks", response_model=TaskListResponse)`

3. **ç±»å‹å®šä¹‰å®Œæ•´æ€§**ï¼š
   - è¯·æ±‚æ¨¡å‹ï¼š`TaskCreateRequest`, `ConfigCreateRequest`
   - å“åº”æ¨¡å‹ï¼š`TaskResponse`, `ConfigResponse`, `TaskListResponse`
   - é€šç”¨å“åº”ï¼šå¤ç”¨`backend/schemas/common.py`ä¸­çš„`SuccessResponse`

4. **å‚è€ƒç°æœ‰å®ç°**ï¼š
   - âœ… `backend/schemas/account.py` - è´¦å·ç®¡ç†schemasï¼ˆ5ä¸ªæ¨¡å‹ï¼‰
   - âœ… `backend/schemas/collection.py` - æ•°æ®é‡‡é›†schemasï¼ˆ7ä¸ªæ¨¡å‹ï¼‰
   - âœ… `backend/schemas/account_alignment.py` - è´¦å·å¯¹é½schemasï¼ˆ15ä¸ªæ¨¡å‹ï¼‰
   - âœ… `backend/routers/account_management.py` - å®Œæ•´çš„Contract-Firstç¤ºä¾‹

5. **éªŒè¯å‘½ä»¤**ï¼š
   ```bash
   # å¼€å‘å‰å¿…è·‘
   python scripts/verify_contract_first.py
   
   # æ£€æŸ¥é¡¹ï¼š
   # - é‡å¤Pydanticæ¨¡å‹å®šä¹‰
   # - response_modelè¦†ç›–ç‡
   # - schemas/ç›®å½•è¦†ç›–ç‡
   ```

**è¯¦ç»†è§„èŒƒ**: å‚è§ `.cursorrules` å’Œ `docs/CONTRACT_FIRST_QUICK_GUIDE.md`

---

### å—å½±å“çš„ä»£ç ï¼ˆAffected Codeï¼‰

#### éœ€è¦æ–°å¢çš„æ–‡ä»¶

**ç»„ä»¶ç³»ç»Ÿï¼š**
- `config/collection_components/shopee/login.yaml` - Shopee ç™»å½•ç»„ä»¶
- `config/collection_components/shopee/navigation.yaml` - Shopee å¯¼èˆªç»„ä»¶
- `config/collection_components/shopee/date_picker.yaml` - Shopee æ—¥æœŸé€‰æ‹©ç»„ä»¶
- `config/collection_components/shopee/orders_export.yaml` - Shopee è®¢å•å¯¼å‡ºç»„ä»¶
- `config/collection_components/shopee/products_export.yaml` - Shopee äº§å“å¯¼å‡ºç»„ä»¶
- `config/collection_components/shopee/services_export.yaml` - Shopee æœåŠ¡å¯¼å‡ºç»„ä»¶
- `config/collection_components/shopee/analytics_export.yaml` - Shopee æµé‡å¯¼å‡ºç»„ä»¶
- `config/collection_components/shopee/finance_export.yaml` - Shopee è´¢åŠ¡å¯¼å‡ºç»„ä»¶
- `config/collection_components/shopee/inventory_export.yaml` - Shopee åº“å­˜å¯¼å‡ºç»„ä»¶
- `config/collection_components/tiktok/...` - TikTok å¹³å°ç»„ä»¶
- `config/collection_components/miaoshou/...` - å¦™æ‰‹å¹³å°ç»„ä»¶

**å½•åˆ¶å·¥å…·ï¼š**
- `tools/record_component.py` - ç»„ä»¶å½•åˆ¶å·¥å…·
- `tools/test_component.py` - ç»„ä»¶æµ‹è¯•å·¥å…·

**åç«¯ï¼š**
- `backend/schemas/collection.py` - **Pydanticæ¨¡å‹é›†ä¸­å®šä¹‰ï¼ˆContract-Firstï¼‰** â­â­â­
- `modules/apps/collection_center/executor_v2.py` - æ–°é‡‡é›†æ‰§è¡Œå¼•æ“
- `modules/apps/collection_center/component_loader.py` - ç»„ä»¶åŠ è½½å™¨
- `modules/apps/collection_center/popup_handler.py` - é€šç”¨å¼¹çª—å¤„ç†å™¨
- `backend/routers/collection_config.py` - é…ç½®ç®¡ç† API è·¯ç”±ï¼ˆå¿…é¡»æ·»åŠ response_modelï¼‰â­
- `backend/routers/collection_websocket.py` - WebSocket ç«¯ç‚¹
- `backend/services/collection_scheduler.py` - å®šæ—¶è°ƒåº¦æœåŠ¡
- `modules/utils/proxy_provider.py` - ä»£ç†IPæ¥å£
- `backend/services/cleanup_service.py` - ä¸´æ—¶æ–‡ä»¶æ¸…ç†æœåŠ¡
- `backend/services/task_queue_service.py` - æ’é˜Ÿä»»åŠ¡ç®¡ç†æœåŠ¡

**å¹³å°å¼¹çª—é…ç½®ï¼š**
- `config/collection_components/shopee/popup_config.yaml` - Shopee å¼¹çª—é…ç½®
- `config/collection_components/tiktok/popup_config.yaml` - TikTok å¼¹çª—é…ç½®
- `config/collection_components/miaoshou/popup_config.yaml` - å¦™æ‰‹ERP å¼¹çª—é…ç½®

**å‰ç«¯ï¼š**
- `frontend/src/composables/useCollectionStatus.js` - WebSocket Hook
- `frontend/src/api/collection.js` - é‡‡é›†æœåŠ¡å°è£…
- `frontend/src/components/CronEditor.vue` - Cron å¯è§†åŒ–ç¼–è¾‘å™¨
- `frontend/src/components/VerificationDialog.vue` - éªŒè¯ç è¾“å…¥å¼¹çª—

#### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶
- `backend/routers/collection.py` - å¢å¼ºä»»åŠ¡ç®¡ç† APIï¼ˆæ–°å¢ retry/resume/verifyï¼‰â­ **å¿…é¡»æ·»åŠ response_model**
- `backend/schemas/__init__.py` - å¯¼å‡ºcollectionç›¸å…³schemas â­
- `modules/core/db/schema.py` - æ•°æ®åº“æ¨¡å‹å¢å¼ºï¼šâ­
  - `collection_configs` è¡¨ï¼š`sub_domains` æ”¹ä¸ºæ•°ç»„
  - `collection_tasks` è¡¨ï¼šæ–°å¢ `data_domains`, `sub_domains`, `total_domains`, `completed_domains`, `failed_domains`, `current_domain`, `debug_mode` å­—æ®µ
  - ä»»åŠ¡çŠ¶æ€æ–°å¢ `partial_success` æšä¸¾å€¼
- `backend/utils/config.py` - æ·»åŠ ç¯å¢ƒæ„ŸçŸ¥æµè§ˆå™¨é…ç½®ï¼ˆSettings.browser_configå±æ€§ï¼‰â­
- `modules/apps/collection_center/handlers.py` - ä¿ç•™ CLI åŠŸèƒ½ï¼Œæ–°å¢å‚æ•°é©±åŠ¨æ¨¡å¼
- `modules/apps/collection_center/executor_v2.py` - æ‰§è¡Œå¼•æ“è°ƒæ•´ï¼ˆä¸€è´¦å·ä¸€ä»»åŠ¡ï¼Œå¾ªç¯é‡‡é›†æ‰€æœ‰åŸŸï¼‰â­
- `frontend/src/views/collection/CollectionConfig.vue` - å®Œæ•´åŠŸèƒ½å®ç°ï¼š
  - â­ é…ç½®åè‡ªåŠ¨ç”Ÿæˆï¼ˆ`{platform}-{domains}-v{n}`ï¼‰
  - â­ æ—¥æœŸé€‰æ‹©å¹³å°å¯¹é½ï¼ˆç§»é™¤granularityï¼Œä½¿ç”¨å¹³å°é¢„è®¾ï¼‰
  - â­ æœåŠ¡å­åŸŸå¤šé€‰ + "å…¨é€‰"æŒ‰é’®
  - â­ å¿«é€Ÿé…ç½®åŠŸèƒ½ï¼ˆ3æ­¥å‘å¯¼ï¼‰
  - â­ å½•åˆ¶å·¥å…·å…¥å£ï¼ˆå‰ç«¯ç”Ÿæˆå‘½ä»¤ï¼‰
- `frontend/src/views/collection/CollectionTasks.vue` - å®ç°å®Œæ•´åŠŸèƒ½ï¼ˆå«éªŒè¯ç å¤„ç†ã€è¿›åº¦å¢å¼ºï¼‰â­
- `frontend/src/views/collection/CollectionHistory.vue` - å®ç°å®Œæ•´åŠŸèƒ½

### ç ´åæ€§å˜æ›´ï¼ˆBreaking Changesï¼‰

**æ— ç ´åæ€§å˜æ›´** - æœ¬ change ä¸ºå¢é‡å®ç°ï¼š
- ä¿ç•™ç°æœ‰ CLI é‡‡é›†åŠŸèƒ½ï¼ˆ`python main.py` å½•åˆ¶å‘å¯¼ï¼‰
- æ–°å¢ç»„ä»¶é©±åŠ¨çš„ API é‡‡é›†åŠŸèƒ½
- å‰ç«¯é¡µé¢ä»ç©ºå£³å‡çº§ä¸ºå®Œæ•´åŠŸèƒ½

## Non-Goals

- âŒ **ä¸åœ¨å‰ç«¯å®ç°å½•åˆ¶åŠŸèƒ½**ï¼šç»„ä»¶å½•åˆ¶éœ€è¦æœ¬åœ° Playwright Inspectorï¼Œä¿ç•™ä¸º CLI å·¥å…·
- âŒ **ä¸è¿ç§»è´¦å·é…ç½®åˆ°æ•°æ®åº“**ï¼šè´¦å·æ•æ„Ÿä¿¡æ¯ä¿æŒåœ¨ `local_accounts.py`ï¼Œä»…é‡‡é›†é…ç½®å…¥åº“
- âŒ **ä¸å®ç°ä»£ç†IPæ± **ï¼šä»…é¢„ç•™æ¥å£ï¼Œå…·ä½“ä»£ç†æœåŠ¡åç»­é›†æˆ
- âŒ **ä¸æ”¯æŒ Amazon å¹³å°**ï¼šå½“å‰ä»…æ”¯æŒ Shopeeã€TikTokã€å¦™æ‰‹ERPï¼ˆä»å¹³å°åˆ—è¡¨ä¸­ç§»é™¤Amazonï¼‰
- âŒ **ä¸ä¿ç•™æ—§ç‰ˆå®Œæ•´è„šæœ¬å½•åˆ¶**ï¼šç»Ÿä¸€è¿ç§»åˆ°ç»„ä»¶é©±åŠ¨æ¶æ„
  - Phase 2å®Œæˆåï¼šå½’æ¡£æ—§è„šæœ¬ï¼Œä¿ç•™CLIåŠŸèƒ½ï¼ˆdeprecatedï¼‰
  - Phase 4å®Œæˆåï¼šè¯„ä¼°å¹¶æ¸…ç†CLIåŠŸèƒ½ï¼ˆå¦‚æœæ–°ç³»ç»Ÿç¨³å®šï¼‰
- âŒ **ä¸å®ç°è‡ªåŠ¨éªŒè¯ç è¯†åˆ«**ï¼šä»…æ”¯æŒè¿œç¨‹äººå·¥å¤„ç†éªŒè¯ç 
- âŒ **Phase 1ä¸å®ç°ç»„ä»¶é«˜çº§ç‰¹æ€§**ï¼šæ¡ä»¶åˆ¤æ–­ï¼ˆifï¼‰ã€å¾ªç¯ï¼ˆloopï¼‰ç­‰åç»­ç‰ˆæœ¬æ”¯æŒ

## æˆåŠŸæ ‡å‡†

### Phase 1: ç»„ä»¶ç³»ç»Ÿä¸åŸºç¡€æ¶æ„ï¼ˆP0ï¼‰
- âœ… ç»„ä»¶ YAML æ ¼å¼å®šä¹‰å®Œæˆï¼ˆå« JSON Schemaï¼‰
- âœ… ç»„ä»¶åŠ è½½å™¨å®ç°å¹¶æµ‹è¯•é€šè¿‡
- âœ… ç»„ä»¶å½•åˆ¶å·¥å…·å¯ä»¥å½•åˆ¶å•ä¸ªç»„ä»¶
- âœ… æ•°æ®åº“æ¨¡å‹åˆ›å»ºå¹¶è¿ç§»å®Œæˆ
- âœ… é…ç½®ç®¡ç† API å®ç°å¹¶å¯ç”¨
- âœ… ä»»åŠ¡ç®¡ç† API æ”¯æŒåˆ›å»º/åˆ—è¡¨/å–æ¶ˆ/é‡è¯•/ç»§ç»­
- âœ… è´¦å·åˆ—è¡¨ API å®ç°ï¼ˆä»local_accounts.pyè¯»å–ï¼Œè„±æ•è¿”å›ï¼‰
- âœ… å¼¹çª—å¤„ç†æœºåˆ¶å®ç°ï¼ˆé€šç”¨å¤„ç†å™¨ + å¹³å°é…ç½®ï¼‰
- âœ… WebSocketè®¤è¯å®ç°ï¼ˆJWT TokenéªŒè¯ï¼‰
- âœ… ä»»åŠ¡çŠ¶æ€ä¹è§‚é”å®ç°ï¼ˆé˜²æ­¢å¹¶å‘æ›´æ–°å†²çªï¼‰

### Phase 2: ç»„ä»¶å½•åˆ¶ä¸å‰ç«¯åŸºç¡€ï¼ˆP0ï¼‰
- âœ… å„å¹³å°æ ¸å¿ƒç»„ä»¶å½•åˆ¶å®Œæˆï¼ˆlogin, navigation, export Ã— 6 æ•°æ®åŸŸï¼‰
- âœ… ç»„ä»¶æµ‹è¯•å·¥å…·éªŒè¯ç»„ä»¶å¯ç”¨
- âœ… `CollectionConfig.vue` å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼š
  - â­ é…ç½®åè‡ªåŠ¨ç”Ÿæˆå¹¶å¯ç¼–è¾‘
  - â­ æ—¥æœŸé€‰æ‹©å¹³å°å¯¹é½ï¼ˆç§»é™¤granularityï¼‰
  - â­ æœåŠ¡å­åŸŸå¤šé€‰ + "å…¨é€‰"
  - â­ å½•åˆ¶å·¥å…·å…¥å£ï¼ˆç”Ÿæˆå‘½ä»¤+å¤åˆ¶ï¼‰
- âœ… `CollectionTasks.vue` å¯ä»¥æ‰‹åŠ¨è§¦å‘é‡‡é›†
- âœ… ä»»åŠ¡ç²’åº¦ä¼˜åŒ–ï¼šä¸€è´¦å·ä¸€ä»»åŠ¡ï¼Œå¾ªç¯é‡‡é›†æ‰€æœ‰åŸŸ

### Phase 3: å®æ—¶çŠ¶æ€ä¸è°ƒåº¦å®Œæˆï¼ˆP1ï¼‰
- âœ… WebSocket ç«¯ç‚¹å®ç°å¹¶å¯è¿æ¥
- âœ… å‰ç«¯å®æ—¶æ˜¾ç¤ºé‡‡é›†è¿›åº¦ï¼ˆæ˜¾ç¤ºå·²å®Œæˆ/å¤±è´¥çš„æ•°æ®åŸŸï¼‰â­
- âœ… éªŒè¯ç è¿œç¨‹å¤„ç†æµç¨‹å¯ç”¨
- âœ… APScheduler å®šæ—¶è°ƒåº¦è¿è¡Œæ­£å¸¸ï¼ˆæ”¯æŒæ—¥åº¦4æ¬¡ï¼š06:00/12:00/18:00/22:00ï¼‰â­
- âœ… å¿«é€Ÿé…ç½®åŠŸèƒ½å¯ç”¨ï¼š
  - â­ 3æ­¥å‘å¯¼åˆ›å»ºæ ‡å‡†é…ç½®
  - â­ è‡ªåŠ¨åˆ›å»ºæ—¥åº¦+å‘¨åº¦+æœˆåº¦é…ç½®
  - â­ é¢„è§ˆé…ç½®å’Œé¢„è®¡ä»»åŠ¡æ•°
- âœ… `CollectionHistory.vue` å±•ç¤ºå†å²è®°å½•å’Œç»Ÿè®¡
- âœ… æ’é˜Ÿä»»åŠ¡è‡ªåŠ¨å¯åŠ¨æœºåˆ¶å®ç°
- âœ… ä¸´æ—¶æ–‡ä»¶å®šæ—¶æ¸…ç†ä»»åŠ¡è¿è¡Œæ­£å¸¸
- âœ… ç³»ç»Ÿå¥åº·æ£€æŸ¥ç«¯ç‚¹å¯ç”¨
- âœ… **è¯¦ç»†éªŒè¯**: å‚è§ tasks.md éªŒè¯æ¸…å• V29-V42ï¼ˆ14é¡¹ç”¨æˆ·åé¦ˆä¼˜åŒ–éªŒè¯ï¼‰â­

### Phase 4: äº‘ç«¯é€‚é…å®Œæˆï¼ˆP2ï¼‰
- âœ… ä»£ç†IPæ¥å£å®šä¹‰å®Œæˆ
- âœ… Docker headless æ¨¡å¼æµ‹è¯•é€šè¿‡
- âœ… æŒ‡çº¹åº“æ‰©å±•åˆ° 20+ UA

## é£é™©è¯„ä¼°

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| ç»„ä»¶ YAML æ ¼å¼è®¾è®¡ä¸å½“ | é«˜ | å…ˆå®ç° 2 ä¸ªå¹³å°ï¼ŒéªŒè¯æ ¼å¼åå†æ‰©å±• |
| Playwright headless æ¨¡å¼åæ£€æµ‹å¤±æ•ˆ | é«˜ | ä¿ç•™ headed æ¨¡å¼ä½œä¸ºå¤‡é€‰ï¼Œå¢å¼ºæŒ‡çº¹åº“ |
| ç»„ä»¶å½•åˆ¶å­¦ä¹ æ›²çº¿ | ä¸­ | æä¾›è¯¦ç»†å½•åˆ¶æ–‡æ¡£å’Œç¤ºä¾‹ |
| WebSocket è¿æ¥ä¸ç¨³å®š | ä¸­ | å®ç°è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼Œå¢åŠ å¿ƒè·³æ£€æµ‹ |
| å®šæ—¶ä»»åŠ¡èµ„æºç«äº‰ | ä½ | ä»»åŠ¡åŠ é”ï¼Œé˜²æ­¢åŒä¸€è´¦å·å¹¶å‘é‡‡é›† |
| é•¿æ—¶é—´ä»»åŠ¡è¶…æ—¶ | ä¸­ | å®ç°ä»»åŠ¡è¶…æ—¶æ§åˆ¶å’Œæ¢å¤æœºåˆ¶ |
| éªŒè¯ç é˜»æ–­é‡‡é›† | ä¸­ | å®ç°è¿œç¨‹éªŒè¯ç å¤„ç†æµç¨‹ |
| å¼¹çª—å¤„ç†ä¸å®Œæ•´ | ä¸­ | ä¸‰å±‚æœºåˆ¶ï¼ˆé€šç”¨+å¹³å°ç‰¹å®š+ç»„ä»¶çº§ï¼‰ï¼Œå¤šç­–ç•¥å…œåº• |
| è´¦å·é…ç½®è¯»å–å¤±è´¥ | ä½ | ä½¿ç”¨importlibåŠ¨æ€å¯¼å…¥ï¼Œå¼‚å¸¸å¤„ç†å®Œå–„ |
| WebSocketæœªè®¤è¯ | é«˜ | JWT Tokenè®¤è¯ï¼Œè¿æ¥æ—¶éªŒè¯ |
| æµè§ˆå™¨è¿›ç¨‹æ³„æ¼ | é«˜ | å¯åŠ¨æ—¶+å®šæœŸæ£€æŸ¥æ¸…ç†å­¤å„¿è¿›ç¨‹ |
| ä»»åŠ¡çŠ¶æ€ç«æ€ | ä¸­ | ä½¿ç”¨ä¹è§‚é”é˜²æ­¢å¹¶å‘æ›´æ–°å†²çª |
| æ’é˜Ÿä»»åŠ¡ä¸å¯åŠ¨ | ä¸­ | ä»»åŠ¡å®Œæˆå›è°ƒè§¦å‘æ’é˜Ÿä»»åŠ¡å¯åŠ¨ |
| ä¸´æ—¶æ–‡ä»¶å †ç§¯ | ä½ | å®šæ—¶æ¸…ç†ä»»åŠ¡ï¼ˆä¸‹è½½7å¤©ã€æˆªå›¾30å¤©ï¼‰ |

#### 15. æ˜¾å¼æˆåŠŸéªŒè¯æœºåˆ¶ï¼ˆP0ï¼‰â­â­â­ **NEW - Phase 7**

**èƒŒæ™¯**: å½“å‰ç»„ä»¶æ‰§è¡Œå®Œæˆåæ²¡æœ‰éªŒè¯æ˜¯å¦çœŸæ­£æˆåŠŸï¼Œä»…ä¾èµ–"ä¸æŠ›å¼‚å¸¸=æˆåŠŸ"çš„éšå¼åˆ¤æ–­ï¼Œå­˜åœ¨é‡å¤§å¯é æ€§é£é™©ã€‚

**æ ¸å¿ƒé—®é¢˜**:
- ç»„ä»¶æ­¥éª¤æ‰§è¡Œå®Œæˆï¼Œä½†å¯èƒ½å¤„äºé”™è¯¯çŠ¶æ€ï¼ˆå¦‚ç™»å½•æœªæˆåŠŸã€åº—é“ºåˆ‡æ¢å¤±è´¥ï¼‰
- ç³»ç»Ÿæ— æ„ŸçŸ¥åœ°ç»§ç»­æ‰§è¡Œåç»­æµç¨‹ï¼Œå¯¼è‡´é‡‡é›†é”™è¯¯æ•°æ®
- ç¼ºä¹æ˜ç¡®çš„"å®Œæˆåˆ¤å®šæ ‡å‡†"ï¼Œéš¾ä»¥è¯Šæ–­é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**: å®ç° `success_criteria` éªŒè¯æœºåˆ¶

```yaml
# ç»„ä»¶ YAML å¢å¼º
name: shopee_login
steps:
  - action: navigate
    url: "{{account.login_url}}"
  - action: fill
    selector: "#username"
    value: "{{account.username}}"
  # ... ç™»å½•æ­¥éª¤ ...

# æˆåŠŸæ ‡å‡†éªŒè¯ï¼ˆå…³é”®ï¼‰
success_criteria:
  - type: url_contains
    value: "/dashboard"
    optional: false  # å¿…é¡»é€šè¿‡
    comment: "ç™»å½•åè·³è½¬åˆ°dashboardé¡µé¢"
  
  - type: element_exists
    selector: ".main-menu, .sidebar"
    timeout: 5000
    comment: "èœå•æ å‡ºç°è¡¨ç¤ºç™»å½•æˆåŠŸ"
  
  - type: element_text_contains
    selector: ".user-profile"
    value: "{{account.store_name}}"
    optional: true  # å¯é€‰éªŒè¯
```

**éªŒè¯ç±»å‹æ”¯æŒ**:
- `url_contains` / `url_matches` - URLéªŒè¯
- `element_exists` / `element_visible` - å…ƒç´ å­˜åœ¨/å¯è§æ€§
- `element_text_contains` - å…ƒç´ æ–‡æœ¬åŒ¹é…
- `page_contains_text` - é¡µé¢æ–‡æœ¬æœç´¢
- `custom_js` - è‡ªå®šä¹‰JavaScriptéªŒè¯

**æ‰§è¡Œæµç¨‹**:
```
æ‰§è¡Œç»„ä»¶æ­¥éª¤ â†’ éªŒè¯æˆåŠŸæ ‡å‡† â†’ è¿”å›æˆåŠŸ/å¤±è´¥
                    â†“
            å…¨éƒ¨é€šè¿‡ â†’ ç»§ç»­ä¸‹ä¸€ç»„ä»¶
            æœ‰å¤±è´¥ â†’ æ£€æŸ¥é”™è¯¯å¤„ç†å™¨ â†’ é‡è¯•/é™çº§/å¤±è´¥
```

**å®ç°ä½ç½®**:
- `modules/apps/collection_center/executor_v2.py` - `_verify_success_criteria()` æ–¹æ³•
- `modules/apps/collection_center/executor_v2.py` - `_execute_component()` è¿”å› bool

**é¢„æœŸæ•ˆæœ**:
- å¯é æ€§: **95% â†’ 99%**
- æ— å£°å¤±è´¥: **30% â†’ 5%**
- é—®é¢˜å¯è¯Šæ–­æ€§: **æå‡10å€**

---

#### 16. æ™ºèƒ½åº—é“ºåˆ‡æ¢ç»„ä»¶ï¼ˆP0ï¼‰â­â­â­ **NEW - Phase 7**

**èƒŒæ™¯**: 
- å¤šåº—é“ºè´¦å·ç™»å½•åéšæœºè¿›å…¥æŸä¸ªåº—é“ºï¼ˆä¸å¯é¢„æµ‹ï¼‰
- å¿…é¡»ç¡®ä¿åœ¨æ­£ç¡®çš„åº—é“ºä¸‹é‡‡é›†æ•°æ®
- å½“å‰ç¼ºå°‘åº—é“ºåˆ‡æ¢æœºåˆ¶ï¼Œæ•°æ®å‡†ç¡®æ€§æ— æ³•ä¿è¯

**æ ¸å¿ƒé—®é¢˜**:
```
å®é™…æƒ…å†µï¼š
ç™»å½• â†’ éšæœºè¿›å…¥åº—é“ºA â†’ ä½†æˆ‘ä»¬éœ€è¦é‡‡é›†åº—é“ºBçš„æ•°æ® â†’ æ•°æ®é”™è¯¯ï¼
```

**è§£å†³æ–¹æ¡ˆ**: åœ¨ç™»å½•å’Œå¯¼èˆªä¹‹é—´æ’å…¥æ™ºèƒ½åº—é“ºåˆ‡æ¢ç»„ä»¶

**æ‰§è¡Œæµç¨‹**:
```
ç™»å½• â†’ [æ™ºèƒ½åº—é“ºåˆ‡æ¢] â†’ å¯¼èˆªåˆ°æ•°æ®åŸŸ â†’ é‡‡é›†
         â†“
   1. æ£€æµ‹å½“å‰åº—é“º
   2. æ¯”å¯¹ç›®æ ‡åº—é“º
   3. åˆ‡æ¢ï¼ˆå¦‚éœ€ï¼‰
   4. éªŒè¯æˆåŠŸ
```

**ç»„ä»¶è®¾è®¡**:
```yaml
# config/collection_components/shopee/shop_switch.yaml
name: shopee_shop_switch
type: shop_switch
version: 1.0.0

params:
  target_shop_id: "{{account.shop_region}}"
  target_store_name: "{{account.store_name}}"

steps:
  # æ­¥éª¤1ï¼šæ£€æµ‹å½“å‰åº—é“º
  - action: get_text
    selector: ".current-shop-name"
    save_to: "current_shop_name"
    optional: true
  
  # æ­¥éª¤2ï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦åˆ‡æ¢
  - action: javascript
    script: |
      const current = context.current_shop_name || '';
      const target = params.target_store_name || '';
      return { need_switch: !current.includes(target) };
    save_to: "switch_decision"
  
  # æ­¥éª¤3ï¼šç‚¹å‡»åº—é“ºé€‰æ‹©å™¨ï¼ˆæ¡ä»¶æ‰§è¡Œï¼‰
  - action: click
    selector: ".shop-selector"
    condition: "{{switch_decision.need_switch}}"
  
  # æ­¥éª¤4ï¼šé€‰æ‹©ç›®æ ‡åº—é“º
  - action: click
    selector: "[data-shop-id='{{params.target_shop_id}}']"
    condition: "{{switch_decision.need_switch}}"
  
  # æ­¥éª¤5ï¼šç­‰å¾…é¡µé¢åˆ·æ–°
  - action: wait_for_load_state
    state: networkidle
    condition: "{{switch_decision.need_switch}}"

success_criteria:
  - type: url_contains
    value: "shop_id={{params.target_shop_id}}"
  - type: element_text_contains
    selector: ".current-shop-name"
    value: "{{params.target_store_name}}"
```

**æ•°æ®åº“æ”¯æŒ**:
```python
# platform_accounts è¡¨å·²æœ‰å­—æ®µ
- shop_type: "local" / "global"
- shop_region: "SG" / "MY" / "GLOBAL"
- store_name: "HongXi Singapore Local"

# è´¦å·ç®¡ç†ç³»ç»Ÿå·²æ”¯æŒå¤šåº—é“ºé…ç½®
- parent_account: å…³è”åŒä¸€ä¸»è´¦å·
- account_alias: ç”¨äºæ•°æ®å¯¹é½
```

**æ‰§è¡Œå™¨é›†æˆ**:
```python
# executor_v2.py æ‰§è¡Œæµç¨‹æ›´æ–°
1. ç™»å½•ç»„ä»¶
2. åº—é“ºåˆ‡æ¢ç»„ä»¶ â† æ–°å¢
3. å¯¼èˆªç»„ä»¶
4. æ•°æ®åŸŸé‡‡é›†
```

**é¢„æœŸæ•ˆæœ**:
- æ•°æ®å‡†ç¡®æ€§: **80% â†’ 100%**
- å¤šåº—é“ºè´¦å·æ”¯æŒ: **0 â†’ å®Œå…¨æ”¯æŒ**
- åº—é“ºé”™ä¹±é—®é¢˜: **å®Œå…¨æ¶ˆé™¤**

---

#### 16.1. çµæ´»æ‰§è¡Œé¡ºåºä¸æƒé™ä¿®å¤ï¼ˆP0ï¼‰â­â­â­ **NEW - Phase 7ä¼˜åŒ–**

**å®æ–½æ—¥æœŸ**: 2025-12-16

**é—®é¢˜1: æƒé™ç³»ç»Ÿå¯¼è‡´ç®¡ç†å‘˜æ— æ³•è®¿é—®æ–°åŠŸèƒ½**

**èƒŒæ™¯**:
- ç»„ä»¶å½•åˆ¶å·¥å…·éœ€è¦ `component-recorder` æƒé™
- æƒé™ç³»ç»Ÿä¸­æœªåˆ›å»ºè¯¥æƒé™
- ç®¡ç†å‘˜è™½æœ‰ `admin` è§’è‰²ä½†è¢«æƒé™æ£€æŸ¥æ‹¦æˆª

**æ ¹æœ¬åŸå› **: è·¯ç”±å®ˆå«å…ˆæ£€æŸ¥æƒé™å†æ£€æŸ¥è§’è‰²ï¼Œä¸ç¬¦åˆRBACæ ‡å‡†

**è§£å†³æ–¹æ¡ˆ**: ç®¡ç†å‘˜è·³è¿‡æƒé™æ£€æŸ¥ï¼ˆç¬¦åˆRBACæ ‡å‡†ï¼‰

```javascript
// frontend/src/router/index.js
router.beforeEach((to, from, next) => {
  // â­ ç®¡ç†å‘˜è·³è¿‡æƒé™æ£€æŸ¥ï¼ˆæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼‰
  const isAdmin = userStore.hasRole(['admin'])
  
  // æƒé™æ£€æŸ¥ï¼ˆç®¡ç†å‘˜è·³è¿‡ï¼‰
  if (!isAdmin && to.meta.permission) {
    if (!userStore.hasPermission(to.meta.permission)) {
      next('/business-overview')
      return
    }
  }
  
  // è§’è‰²æ£€æŸ¥ï¼ˆæ‰€æœ‰äººéƒ½éœ€è¦ï¼‰
  if (to.meta.roles && to.meta.roles.length > 0) {
    if (!userStore.hasRole(to.meta.roles)) {
      next('/business-overview')
      return
    }
  }
  
  next()
})
```

**æ”¶ç›Š**:
- âœ… ç®¡ç†å‘˜è‡ªåŠ¨æ‹¥æœ‰æ‰€æœ‰åŠŸèƒ½æƒé™
- âœ… æ–°åŠŸèƒ½æ— éœ€æ‰‹åŠ¨åˆ›å»ºæƒé™å³å¯è®¿é—®
- âœ… ç¬¦åˆRBACæ ‡å‡†å®è·µï¼ˆè¶…çº§ç®¡ç†å‘˜ä¸å—æƒé™é™åˆ¶ï¼‰

---

**é—®é¢˜2: Shopeeå¹³å°éœ€è¦ä¸åŒçš„ç»„ä»¶æ‰§è¡Œé¡ºåº**

**èƒŒæ™¯**:
- åŸè®¾è®¡: Login â†’ Shop Switch â†’ Navigation â†’ Exportï¼ˆé€šç”¨æµç¨‹ï¼‰
- Shopeeè¦æ±‚: Login â†’ Navigation â†’ Shop Switch â†’ Export
- åŸå› : Shopeeçš„åº—é“ºé€‰æ‹©å™¨åœ¨ä¸åŒæ•°æ®åŸŸé¡µé¢ä½ç½®ä¸åŒï¼Œå¿…é¡»å…ˆå¯¼èˆª

**è§£å†³æ–¹æ¡ˆ**: å¹³å°ç‰¹å®šçš„æ‰§è¡Œé¡ºåºé…ç½®

**1. åˆ›å»ºæ‰§è¡Œé¡ºåºé…ç½®æ–‡ä»¶**:
```yaml
# config/collection_components/shopee/execution_order.yaml
platform: shopee
version: 1.0.0

execution_sequence:
  - component: login
    required: true
    index: 0
  
  - component: navigation  # Shopeeå…ˆå¯¼èˆª
    required: false
    index: 1
  
  - component: shop_switch  # å†åˆ‡æ¢åº—é“º
    required: false
    index: 2
    condition: "{{account.has_multiple_shops}}"
  
  - component: export
    required: true
    index: 3

# æ‰§è¡Œç­–ç•¥
execution_strategy:
  on_component_failure:
    login: fail_task
    navigation: continue
    shop_switch: continue
    export: fail_domain
  
  timeout:
    login: 300
    navigation: 60
    shop_switch: 120
    export: 600
```

**2. åˆ›å»ºé»˜è®¤æ‰§è¡Œé¡ºåº** (å…¶ä»–å¹³å°):
```yaml
# config/collection_components/default_execution_order.yaml
platform: default

execution_sequence:
  - component: login (index: 0)
  - component: shop_switch (index: 1)  # é»˜è®¤å…ˆåˆ‡æ¢åº—é“º
  - component: navigation (index: 2)
  - component: export (index: 3)
```

**3. æ‰§è¡Œå™¨æ”¯æŒ**:
```python
# executor_v2.py æ–°å¢æ–¹æ³•
def _load_execution_order(self, platform: str):
    """åŠ è½½å¹³å°æ‰§è¡Œé¡ºåºé…ç½®"""
    # ä¼˜å…ˆåŠ è½½å¹³å°ç‰¹å®šé…ç½®
    # å›é€€åˆ°é»˜è®¤é…ç½®
    # æœ€åä½¿ç”¨ç¡¬ç¼–ç é»˜è®¤å€¼

# æ‰§è¡Œé€»è¾‘æ›´æ–°
if platform.lower() == 'shopee':
    # Shopeeç‰¹æ®Šæµç¨‹
    # Login â†’ Navigation â†’ Shop Switch â†’ Export
else:
    # é»˜è®¤æµç¨‹
    # Login â†’ Shop Switch â†’ Navigation â†’ Export
```

**æ‰§è¡Œæµç¨‹å¯¹æ¯”**:
```
é»˜è®¤å¹³å°ï¼ˆTikTok/Amazon/Miaoshouï¼‰:
Login(0) â†’ Shop Switch(1) â†’ Navigation(2) â†’ Export(3+)
         â†“
    å…¨å±€åˆ‡æ¢åº—é“º â†’ å¯¼èˆªåˆ°æ•°æ®åŸŸ â†’ é‡‡é›†

Shopeeå¹³å°ï¼ˆç‰¹æ®Šè¦æ±‚ï¼‰:
Login(0) â†’ Navigation(1) â†’ Shop Switch(2) â†’ Export(3+)
         â†“
    å¯¼èˆªåˆ°æ•°æ®åŸŸ â†’ é¡µé¢å†…åˆ‡æ¢åº—é“º â†’ é‡‡é›†
```

**è®¾è®¡ä¼˜åŠ¿**:
- âœ… æ”¯æŒå¹³å°å·®å¼‚åŒ–æµç¨‹
- âœ… é…ç½®æ–‡ä»¶é©±åŠ¨ï¼Œæ˜“äºç»´æŠ¤
- âœ… å‘åå…¼å®¹ç°æœ‰ç»„ä»¶
- âœ… ä¸ºæœªæ¥çš„å®Œå…¨é…ç½®é©±åŠ¨å¥ å®šåŸºç¡€

**é¢„æœŸæ•ˆæœ**:
- Shopeeå¤šåº—é“ºé‡‡é›†æˆåŠŸç‡: **50% â†’ 95%+**
- æ”¯æŒå¹³å°ç‰¹å®šæµç¨‹: **0 â†’ å®Œå…¨æ”¯æŒ**
- é…ç½®çµæ´»æ€§: **å¤§å¹…æå‡**

---

#### 17. ç»„ä»¶å½•åˆ¶å·¥å…·UIåŒ–ï¼ˆP1ï¼‰â­â­ **âœ… å·²å®Œæˆ - Phase 8 (2025-12-16)**

**èƒŒæ™¯**: å½“å‰å½•åˆ¶å·¥å…·éœ€è¦æ‰§è¡Œå‘½ä»¤è¡Œï¼Œå¯¹éæŠ€æœ¯ç”¨æˆ·ä¸å‹å¥½ï¼Œç®¡ç†å‘˜æ— æ³•è‡ªåŠ©å½•åˆ¶ç»„ä»¶ã€‚

**å½“å‰ç—›ç‚¹**:
```bash
# éœ€è¦æ‰§è¡Œå‘½ä»¤è¡Œ
python tools/record_component.py

# éœ€è¦é€‰æ‹©å¹³å°ã€ç»„ä»¶ç±»å‹ã€è´¦å·
# éœ€è¦ç­‰å¾…Inspectorå¯åŠ¨
# éœ€è¦ä¿å­˜å’Œå‘½åYAMLæ–‡ä»¶
```

**è§£å†³æ–¹æ¡ˆ**: å‰ç«¯UIå½•åˆ¶ç•Œé¢ âœ… **å·²å®ç°**

**âœ… å®é™…å®ç°ï¼ˆ2025-12-16ï¼‰**:

**æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆ**:
- **Playwright Codegen**: ä½¿ç”¨å®˜æ–¹å·¥å…·è‡ªåŠ¨å½•åˆ¶ç”¨æˆ·æ“ä½œ â­ **å®˜æ–¹å·¥å…·ä¼˜å…ˆ**
- **Subprocesséš”ç¦»**: ç‹¬ç«‹è¿›ç¨‹è¿è¡Œé¿å…Windowsäº‹ä»¶å¾ªç¯å†²çª
- **Python APIè§£æ**: æ­£ç¡®è§£æ`page.get_by_role()`è¯­æ³•
- **é¡ºåºä¿æŒ**: é€è¡Œè§£æä¿æŒæ“ä½œçš„å®é™…æ‰§è¡Œé¡ºåº
- **é‡å¤è¿‡æ»¤**: è‡ªåŠ¨è¿‡æ»¤å…³é—­æµè§ˆå™¨æ—¶çš„é‡å¤gotoæ­¥éª¤

**Playwrightä½¿ç”¨è§„èŒƒï¼ˆ2025-12-17æ–°å¢ï¼‰**â­â­â­:
- âœ… **å®˜æ–¹APIä¼˜å…ˆ**: ä½¿ç”¨`get_by_role/label/text`ç­‰å®˜æ–¹APIï¼Œä¸è‡ªå·±å®ç°é€‰æ‹©å™¨å¤„ç†
- âœ… **å®˜æ–¹å·¥å…·ä¼˜å…ˆ**: ä½¿ç”¨Playwright Inspectorã€Codegenç­‰å®˜æ–¹å·¥å…·å½•åˆ¶
- âœ… **å®Œæ•´ç­‰å¾…æœºåˆ¶**: DOMåŠ è½½ â†’ ç½‘ç»œç©ºé—² â†’ JavaScriptæ¸²æŸ“ï¼ˆä¸‰çº§ç­‰å¾…ï¼‰
- âœ… **å…ƒç´ å¯è§æ€§æ£€æŸ¥**: äº¤äº’å‰ç­‰å¾…å…ƒç´ å¯è§å¹¶æ»šåŠ¨åˆ°è§†å›¾
- âŒ **ç¦æ­¢è‡ªå®šä¹‰**: ä¸åˆ›å»º`_fix_selector`ã€`_get_smart_locator`ç­‰è‡ªå®šä¹‰é€»è¾‘
- âŒ **ç¦æ­¢ç»•è¿‡å®˜æ–¹API**: ä¸æ‰‹åŠ¨è½¬æ¢é€‰æ‹©å™¨æ ¼å¼æˆ–å®ç°é™çº§ç­–ç•¥

**åŠŸèƒ½å®ç°**:
```
å‰ç«¯è·¯ç”±: /component-recorder

åŠŸèƒ½æ¨¡å—:
1. âœ… å½•åˆ¶é…ç½®è¡¨å•
   - å¹³å°é€‰æ‹©: Shopee / TikTok / Miaoshou
   - ç»„ä»¶ç±»å‹: login / navigation / export / shop_switch
   - è´¦å·é€‰æ‹©: ä»è´¦å·ç®¡ç†ç³»ç»Ÿè¯»å–ï¼ˆåŠ¨æ€åŠ è½½ï¼Œå¹³å°è¿‡æ»¤ï¼‰
   - æ•°æ®åŸŸé€‰æ‹©: ä»…exportç±»å‹éœ€è¦

2. âœ… å½•åˆ¶æ§åˆ¶
   - [å¼€å§‹å½•åˆ¶] æŒ‰é’® â†’ åç«¯å¯åŠ¨Playwright Codegenæµè§ˆå™¨
   - å®æ—¶çŠ¶æ€æ˜¾ç¤º: "æµè§ˆå™¨çª—å£æ­£åœ¨æ‰“å¼€..."
   - [åœæ­¢å½•åˆ¶] æŒ‰é’® â†’ è§£æç”Ÿæˆçš„Pythonä»£ç ä¸ºYAML

3. âœ… YAMLé¢„è§ˆç¼–è¾‘å™¨
   - å®æ—¶æ˜¾ç¤ºç”Ÿæˆçš„YAML
   - æ”¯æŒåœ¨çº¿ç¼–è¾‘å’ŒéªŒè¯
   - è¯­æ³•é«˜äº®å’Œæ­¥éª¤æ•°é‡ç»Ÿè®¡
   - æ­¥éª¤è¯¦æƒ…å±•ç¤ºï¼ˆaction/selector/url/commentï¼‰

4. âœ… ç»„ä»¶æµ‹è¯•ï¼ˆå·²å®ç° - 2025-12-17ï¼‰â­â­â­
   - å‰ç«¯æµ‹è¯•æŒ‰é’®è°ƒç”¨çœŸå®API
   - æœ‰å¤´æ¨¡å¼æ‰§è¡Œï¼ˆç”¨æˆ·å¯è§‚å¯Ÿæµè§ˆå™¨ï¼‰
   - å®æ—¶æ˜¾ç¤ºæµ‹è¯•è¿›åº¦å’Œç»“æœ
   - è¯¦ç»†çš„æ­¥éª¤æ‰§è¡ŒæŠ¥å‘Šï¼ˆçŠ¶æ€/è€—æ—¶/æˆªå›¾ï¼‰
   - å¤±è´¥æ­¥éª¤æˆªå›¾å±•ç¤ºå’Œä¿®å¤å»ºè®®
   - æµ‹è¯•è´¦å·é€‰æ‹©å™¨ï¼ˆé»˜è®¤å½•åˆ¶è´¦å·ï¼‰

5. âœ… ç‰ˆæœ¬ç®¡ç†é›†æˆï¼ˆå·²å®ç° - 2025-12-17ï¼‰â­â­â­
   - ä¿å­˜ç»„ä»¶è‡ªåŠ¨æ³¨å†Œåˆ°component_versionsè¡¨
   - åŒåç»„ä»¶è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·ï¼ˆv1.0.0 â†’ v1.0.1ï¼‰
   - è¦†ç›–ä¿å­˜æ›´æ–°ç°æœ‰ç‰ˆæœ¬è®°å½•
   - ç‰ˆæœ¬ç®¡ç†é¡µæ·»åŠ "æµ‹è¯•ç»„ä»¶"æŒ‰é’®
   - æµ‹è¯•å®Œæˆè‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬ç»Ÿè®¡ä¿¡æ¯

6. âœ… æµ‹è¯•å†å²è®°å½•ï¼ˆå·²å®ç° - 2025-12-17ï¼‰â­â­
   - è‡ªåŠ¨ä¿å­˜æ¯æ¬¡æµ‹è¯•ç»“æœåˆ°æ•°æ®åº“
   - ComponentTestHistoryè¡¨å­˜å‚¨å®Œæ•´æµ‹è¯•è¯¦æƒ…
   - æµ‹è¯•å†å²ä¸ç»„ä»¶ç‰ˆæœ¬å…³è”ï¼ˆå¤–é”®ï¼‰
   - æ”¯æŒæŒ‰ç»„ä»¶åæŸ¥è¯¢å†å²è®°å½•
   - APIç«¯ç‚¹: GET /component-versions/test-history
```

**å®ç°æ–‡ä»¶**:
- `backend/routers/component_recorder.py` - å½•åˆ¶API + **æµ‹è¯•API** + ç‰ˆæœ¬æ³¨å†Œ + **æµ‹è¯•å†å²ä¿å­˜**
- `backend/routers/component_versions.py` - **ç‰ˆæœ¬æµ‹è¯•API** + **æµ‹è¯•å†å²API**
- `frontend/src/views/ComponentRecorder.vue` - å‰ç«¯å½•åˆ¶ç•Œé¢ + **æµ‹è¯•å¯¹è¯æ¡†**
- `frontend/src/views/ComponentVersions.vue` - **ç‰ˆæœ¬ç®¡ç†é¡µæµ‹è¯•åŠŸèƒ½**
- `frontend/src/api/index.js` - **æµ‹è¯•APIæ¥å£å®šä¹‰**
- `tools/launch_playwright_recorder.py` - ç‹¬ç«‹è¿›ç¨‹å¯åŠ¨Playwright
- `tools/test_component.py` - **ç»„ä»¶æµ‹è¯•å·¥å…·ï¼ˆå¤ç”¨ï¼‰**
- `modules/core/db/schema.py` - **ComponentTestHistoryè¡¨å®šä¹‰**
- `modules/core/db/__init__.py` - **ComponentTestHistoryå¯¼å‡º**
- `temp/recordings/` - ä¸´æ—¶å½•åˆ¶æ–‡ä»¶å­˜å‚¨
- `temp/test_components/` - **ä¸´æ—¶æµ‹è¯•ç»„ä»¶å­˜å‚¨**
- `temp/test_results/` - **æµ‹è¯•ç»“æœå’Œæˆªå›¾å­˜å‚¨**

**âœ… åç«¯APIå®ç°**:
```python
# backend/routers/component_recorder.py

@router.post("/start")
async def start_recording(request: ComponentRecordRequest):
    """
    å¯åŠ¨ç»„ä»¶å½•åˆ¶
    
    å®ç°æ–¹å¼:
    - ä½¿ç”¨subprocesså¯åŠ¨tools/launch_playwright_recorder.py
    - åœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­è¿è¡Œplaywright codegen
    - é¿å…Windowsäº‹ä»¶å¾ªç¯å†²çª
    
    è¿”å›: {
        "success": true,
        "message": "å½•åˆ¶å·²å¼€å§‹",
        "session_id": "xxx",
        "account": {...}
    }
    """
    # å®é™…å®ç°ï¼šä½¿ç”¨threading.Thread + subprocess.Popen

@router.post("/stop")
async def stop_recording():
    """
    åœæ­¢å½•åˆ¶å¹¶ç”ŸæˆYAML
    
    å®ç°æ–¹å¼:
    - ç»ˆæ­¢Playwright subprocess
    - è¯»å–ç”Ÿæˆçš„Pythonä»£ç æ–‡ä»¶
    - è§£æPython APIè¯­æ³•ä¸ºYAMLæ­¥éª¤
    - ä¿æŒæ“ä½œé¡ºåºï¼Œè¿‡æ»¤é‡å¤goto
    
    è¿”å›: {
        "success": true,
        "steps": [...],
        "yaml_preview": "...",
        "operation_count": 10
    }
    """
    # å®é™…å®ç°ï¼šé€è¡Œè§£æPythonä»£ç 
```

**âœ… å‰ç«¯å®ç°æ¦‚è§ˆ**:

**æ ¸å¿ƒæ–‡ä»¶**: `frontend/src/views/ComponentRecorder.vue`

**ä¸»è¦åŠŸèƒ½**:
1. âœ… **å½•åˆ¶é…ç½®è¡¨å•**
   - å¹³å°é€‰æ‹©ï¼ˆShopee/TikTok/Miaoshouï¼‰
   - ç»„ä»¶ç±»å‹é€‰æ‹©ï¼ˆlogin/shop_switch/navigation/exportï¼‰
   - æµ‹è¯•è´¦å·é€‰æ‹©ï¼ˆåŠ¨æ€åŠ è½½ï¼Œæ”¯æŒå¹³å°è¿‡æ»¤ï¼‰
   - æ•°æ®åŸŸé€‰æ‹©ï¼ˆä»…exportç±»å‹æ˜¾ç¤ºï¼‰

2. âœ… **å½•åˆ¶æ§åˆ¶**
   - å¼€å§‹å½•åˆ¶ï¼šè°ƒç”¨`/api/component-recorder/start`
   - çŠ¶æ€æ˜¾ç¤ºï¼šæµè§ˆå™¨çª—å£æ­£åœ¨æ‰“å¼€/å½•åˆ¶ä¸­
   - åœæ­¢å½•åˆ¶ï¼šè°ƒç”¨`/api/component-recorder/stop`

3. âœ… **YAMLé¢„è§ˆ**
   - æ­¥éª¤åˆ—è¡¨å±•ç¤ºï¼ˆID/æ“ä½œ/é€‰æ‹©å™¨/URL/è¯´æ˜ï¼‰
   - å¯ç¼–è¾‘YAMLæ–‡æœ¬
   - æ­¥éª¤æ•°é‡ç»Ÿè®¡
   - è¯­æ³•é«˜äº®

4. âœ… **è´¦å·ç®¡ç†é›†æˆ**
   - ä½¿ç”¨`accountsApi.listAccounts()`è·å–è´¦å·
   - å¹³å°è¿‡æ»¤ï¼ˆcase-insensitiveï¼‰
   - åªæ˜¾ç¤ºå¯ç”¨çŠ¶æ€çš„è´¦å·

**æŠ€æœ¯äº®ç‚¹**:
- Playwright Codegenè‡ªåŠ¨æ•è·æ“ä½œ
- Python APIè¯­æ³•æ­£ç¡®è§£æï¼ˆ`page.get_by_role()`ï¼‰
- æ­¥éª¤é¡ºåºä¿æŒï¼ˆé€è¡Œè§£æï¼‰
- Windowså…¼å®¹ï¼ˆsubprocesséš”ç¦»ï¼‰

**âœ… å®é™…æ•ˆæœï¼ˆ2025-12-16ï¼‰**:
- âœ… ç”¨æˆ·ä½“éªŒ: **å‘½ä»¤è¡Œ â†’ GUIæ“ä½œ**ï¼ˆæå‡10å€ï¼‰
- âœ… å½•åˆ¶å‡†ç¡®æ€§: **100%æ•è·ç”¨æˆ·æ“ä½œ**ï¼ˆPlaywright Codegenï¼‰
- âœ… æ­¥éª¤é¡ºåº: **å®Œå…¨ä¿æŒåŸå§‹é¡ºåº**ï¼ˆé€è¡Œè§£æï¼‰
- âœ… æŠ€æœ¯é—¨æ§›: **å¼€å‘è€…ä¸“ç”¨ â†’ ç®¡ç†å‘˜å¯ç”¨**
- âœ… Windowså…¼å®¹: **å®Œå…¨è§£å†³äº‹ä»¶å¾ªç¯å†²çª**ï¼ˆsubprocesséš”ç¦»ï¼‰
- âœ… é‡å¤å¤„ç†: **è‡ªåŠ¨è¿‡æ»¤é‡å¤gotoæ­¥éª¤**
- âœ… è´¦å·ç®¡ç†: **åŠ¨æ€åŠ è½½ï¼Œå¹³å°è¿‡æ»¤ï¼Œå®æ—¶æ›´æ–°**

**å·²çŸ¥é™åˆ¶**:
- ~~â³ ç»„ä»¶æµ‹è¯•åŠŸèƒ½å¾…å®ç°~~ âœ… **å·²å®Œæˆï¼ˆ2025-12-17ï¼‰**
- ~~â³ è‡ªåŠ¨ä¿å­˜YAMLåˆ°æ–‡ä»¶~~ âœ… **å·²å®Œæˆï¼ˆ2025-12-17ï¼‰**
- â³ Traceæ–‡ä»¶ä¿å­˜å’Œå›æ”¾ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰

---

#### 17.1 ç»„ä»¶æµ‹è¯•åŠŸèƒ½å®ç°ï¼ˆP0ï¼‰â­â­â­ **âœ… å·²å®Œæˆ - Phase 8.2 (2025-12-17)**

**èƒŒæ™¯**: å½•åˆ¶å®Œç»„ä»¶åæ— æ³•ç›´æ¥æµ‹è¯•ï¼Œéœ€è¦æ‰‹åŠ¨è¿è¡Œå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯¹éæŠ€æœ¯äººå‘˜ä¸å‹å¥½ã€‚

**éœ€æ±‚**:
1. å½•åˆ¶å·¥å…·ä¸­ç‚¹å‡»"æµ‹è¯•ç»„ä»¶"æŒ‰é’®å³å¯æµ‹è¯•
2. æœ‰å¤´æ¨¡å¼è¿è¡Œï¼Œç”¨æˆ·å¯è§‚å¯Ÿæ¯ä¸€æ­¥æ‰§è¡Œ
3. æ˜¾ç¤ºè¯¦ç»†æµ‹è¯•ç»“æœï¼ˆæˆåŠŸç‡/è€—æ—¶/å¤±è´¥æˆªå›¾ï¼‰
4. å¤±è´¥æ­¥éª¤æä¾›ä¿®å¤å»ºè®®
5. ä¿å­˜ç»„ä»¶è‡ªåŠ¨æ³¨å†Œåˆ°ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ
6. ç‰ˆæœ¬ç®¡ç†é¡µå¯ä»¥æµ‹è¯•å·²ä¿å­˜çš„ç»„ä»¶

**âœ… å®é™…å®ç°ï¼ˆ2025-12-17ï¼‰**:

**1. åç«¯æµ‹è¯•API** (`backend/routers/component_recorder.py`)
```python
@router.post("/recorder/test")
async def test_component(request: RecorderTestRequest, db: Session = Depends(get_db)):
    """æµ‹è¯•ç»„ä»¶ï¼ˆçœŸå®æ‰§è¡Œï¼Œæœ‰å¤´æ¨¡å¼ï¼‰"""
    # 1. åˆ›å»ºä¸´æ—¶YAMLç»„ä»¶æ–‡ä»¶
    temp_yaml_path = create_temp_component_yaml(request.steps)
    
    # 2. ä½¿ç”¨ComponentTesteræ‰§è¡Œæµ‹è¯•ï¼ˆæœ‰å¤´æ¨¡å¼ï¼‰
    tester = ComponentTester(
        platform=request.platform,
        account_id=request.account_id,
        headless=False,  # æœ‰å¤´æ¨¡å¼ - ç”¨æˆ·å¯è§‚å¯Ÿ
        screenshot_on_error=True  # å¤±è´¥æ—¶æˆªå›¾
    )
    
    # 3. æ‰§è¡Œæµ‹è¯•
    result = await tester.test_component(component_name)
    
    # 4. è¿”å›è¯¦ç»†ç»“æœï¼ˆæ¯æ­¥çŠ¶æ€/è€—æ—¶/é”™è¯¯/æˆªå›¾Base64ï¼‰
    return {
        "success": result.status == "passed",
        "test_result": {
            "duration_ms": result.duration_ms,
            "success_rate": success_rate,
            "step_results": [
                {
                    "step_id": s.step_id,
                    "status": s.status,
                    "duration_ms": s.duration_ms,
                    "error": s.error,
                    "screenshot_base64": base64_encode(s.screenshot)
                }
            ]
        }
    }
```

**2. å‰ç«¯æµ‹è¯•å¯¹è¯æ¡†** (`frontend/src/views/ComponentRecorder.vue`)
```vue
<el-dialog v-model="testDialogVisible" title="ç»„ä»¶æµ‹è¯•">
  <!-- æµ‹è¯•é…ç½® -->
  <div class="test-header">
    <el-tag>{{ platform }} / {{ componentType }}</el-tag>
    <el-select v-model="testAccountId">
      <!-- æµ‹è¯•è´¦å·é€‰æ‹©å™¨ï¼ˆé»˜è®¤å½•åˆ¶è´¦å·ï¼‰ -->
    </el-select>
    <el-button @click="startTest">å¼€å§‹æµ‹è¯•</el-button>
  </div>
  
  <!-- æµ‹è¯•æç¤º -->
  <el-alert type="info">
    æµè§ˆå™¨çª—å£å·²æ‰“å¼€ï¼Œæ­£åœ¨æ‰§è¡Œæµ‹è¯•...
  </el-alert>
  
  <!-- æµ‹è¯•ç»“æœ -->
  <el-timeline>
    <el-timeline-item v-for="step in testStepResults">
      <el-tag :type="step.status === 'passed' ? 'success' : 'danger'">
        æ­¥éª¤ {{ index + 1 }}: {{ step.action }}
      </el-tag>
      <span>{{ step.duration_ms }}ms</span>
      
      <!-- å¤±è´¥è¯¦æƒ… -->
      <el-alert v-if="step.status === 'failed'" type="error">
        {{ step.error }}
        <p>ğŸ’¡ {{ getFixSuggestion(step) }}</p>
      </el-alert>
      
      <!-- å¤±è´¥æˆªå›¾ -->
      <el-image 
        :src="`data:image/png;base64,${step.screenshot_base64}`"
        :preview-src-list="[...]"
      />
    </el-timeline-item>
  </el-timeline>
</el-dialog>
```

**3. ç‰ˆæœ¬è‡ªåŠ¨æ³¨å†Œ** (`backend/routers/component_recorder.py`)
```python
@router.post("/recorder/save")
async def save_component(request: RecorderSaveRequest, db: Session = Depends(get_db)):
    """ä¿å­˜ç»„ä»¶å¹¶è‡ªåŠ¨æ³¨å†Œç‰ˆæœ¬"""
    # 1. ä¿å­˜YAMLæ–‡ä»¶
    save_yaml_file(request)
    
    # 2. æ£€æŸ¥ç°æœ‰ç‰ˆæœ¬
    existing_versions = db.query(ComponentVersion).filter(
        ComponentVersion.component_name == f"{platform}/{component_type}"
    ).order_by(ComponentVersion.version.desc()).all()
    
    # 3. ç¡®å®šç‰ˆæœ¬å·
    if not existing_versions:
        version = "1.0.0"  # é¦–æ¬¡åˆ›å»º
    else:
        # è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·
        latest = existing_versions[0].version  # "1.0.0"
        major, minor, patch = map(int, latest.split('.'))
        version = f"{major}.{minor}.{patch + 1}"  # "1.0.1"
    
    # 4. åˆ›å»ºç‰ˆæœ¬è®°å½•
    new_version = ComponentVersion(
        component_name=component_name,
        version=version,
        file_path=relative_path,
        is_active=True
    )
    db.add(new_version)
    db.commit()
    
    return {
        "success": True,
        "message": f"ç»„ä»¶å·²ä¿å­˜å¹¶åˆ›å»ºç‰ˆæœ¬",
        "version_info": {
            "version": version,
            "is_new_version": True
        }
    }
```

**4. ç‰ˆæœ¬ç®¡ç†é¡µæµ‹è¯•** (`backend/routers/component_versions.py`)
```python
@router.post("/{version_id}/test")
async def test_component_version(version_id: int, request: ComponentTestRequest):
    """æµ‹è¯•ç»„ä»¶ç‰ˆæœ¬ï¼ˆæœ‰å¤´æ¨¡å¼ï¼‰"""
    # 1. è·å–ç‰ˆæœ¬ä¿¡æ¯
    version = db.query(ComponentVersion).filter(id == version_id).first()
    
    # 2. è¯»å–ç»„ä»¶YAMLæ–‡ä»¶
    component_config = yaml.safe_load(open(version.file_path))
    
    # 3. ä½¿ç”¨ComponentTesteræ‰§è¡Œæµ‹è¯•
    tester = ComponentTester(headless=False)
    result = await tester.test_component(component_name)
    
    # 4. æ›´æ–°ç‰ˆæœ¬ç»Ÿè®¡
    if result.status == "passed":
        version.success_count += 1
    else:
        version.failure_count += 1
    version.usage_count += 1
    version.success_rate = version.success_count / version.usage_count
    db.commit()
    
    return test_result
```

**å®ç°æ•ˆæœ**:
- âœ… **ç”¨æˆ·ä½“éªŒ**: ç‚¹å‡»æŒ‰é’® â†’ æµè§ˆå™¨æ‰“å¼€ â†’ è§‚å¯Ÿæ‰§è¡Œ â†’ æŸ¥çœ‹ç»“æœ
- âœ… **æµ‹è¯•å‡†ç¡®æ€§**: 100%çœŸå®æ‰§è¡Œï¼ˆé›†æˆComponentTesterï¼‰
- âœ… **å¤±è´¥è¯Šæ–­**: æˆªå›¾ + é”™è¯¯ä¿¡æ¯ + æ™ºèƒ½ä¿®å¤å»ºè®®
- âœ… **ç‰ˆæœ¬ç®¡ç†**: è‡ªåŠ¨æ³¨å†Œ + è‡ªåŠ¨é€’å¢ + ç»Ÿè®¡æ›´æ–°
- âœ… **å¯è§‚å¯Ÿæ€§**: æœ‰å¤´æ¨¡å¼ï¼Œç®¡ç†å‘˜å¯å®æ—¶è§‚å¯Ÿ
- âœ… **è´¦å·çµæ´»æ€§**: é»˜è®¤å½•åˆ¶è´¦å·ï¼Œå¯åˆ‡æ¢å…¶ä»–è´¦å·

**æŠ€æœ¯äº®ç‚¹**:
- **å¤ç”¨æµ‹è¯•å·¥å…·**: ç›´æ¥é›†æˆ`tools/test_component.py`çš„ComponentTesterç±»
- **ä¸´æ—¶ç»„ä»¶**: æµ‹è¯•æ—¶åˆ›å»ºä¸´æ—¶YAMLæ–‡ä»¶ï¼Œé¿å…æ±¡æŸ“æ­£å¼ç»„ä»¶ç›®å½•
- **æˆªå›¾Base64**: å¤±è´¥æˆªå›¾è½¬Base64ç›´æ¥ä¼ è¾“ï¼Œå‰ç«¯æ— éœ€é¢å¤–è¯·æ±‚
- **æ™ºèƒ½å»ºè®®**: æ ¹æ®é”™è¯¯ç±»å‹ï¼ˆtimeout/not found/clickå¤±è´¥ï¼‰æä¾›ä¿®å¤å»ºè®®
- **ç»Ÿè®¡è‡ªåŠ¨æ›´æ–°**: ç‰ˆæœ¬ç®¡ç†é¡µæµ‹è¯•åè‡ªåŠ¨æ›´æ–°ä½¿ç”¨æ¬¡æ•°å’ŒæˆåŠŸç‡

**æ€§èƒ½æŒ‡æ ‡**:
- æµ‹è¯•å¯åŠ¨æ—¶é—´: <3ç§’ï¼ˆæµè§ˆå™¨æ‰“å¼€ï¼‰
- å•æ­¥æ‰§è¡Œæ—¶é—´: å¹³å‡500msï¼ˆå–å†³äºæ“ä½œç±»å‹ï¼‰
- æˆªå›¾å¤§å°: 50-200KBï¼ˆå‹ç¼©åBase64ï¼‰
- æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ: <100ms

---

#### 17.2 æµ‹è¯•å†å²è®°å½•ç³»ç»Ÿï¼ˆP1ï¼‰â­â­ **âœ… å·²å®Œæˆ - Phase 8.3 (2025-12-17)**

**èƒŒæ™¯**: æµ‹è¯•å®Œç»„ä»¶åï¼Œæ²¡æœ‰å†å²è®°å½•ï¼Œæ— æ³•è¿½æº¯å¤±è´¥åŸå› å’Œå¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„æµ‹è¯•ç»“æœã€‚

**éœ€æ±‚**:
1. è‡ªåŠ¨ä¿å­˜æ¯æ¬¡æµ‹è¯•ç»“æœåˆ°æ•°æ®åº“
2. å‰ç«¯æ˜¾ç¤ºæœ€è¿‘5æ¬¡æµ‹è¯•å†å²ï¼ˆæ—¶é—´/çŠ¶æ€/è€—æ—¶/æˆåŠŸç‡ï¼‰
3. æ”¯æŒæŒ‰ç»„ä»¶åç­›é€‰æµ‹è¯•å†å²
4. æ”¯æŒæŸ¥çœ‹å†å²æµ‹è¯•çš„è¯¦ç»†æ­¥éª¤å’Œæˆªå›¾
5. æ”¯æŒç»„ä»¶æ€§èƒ½è¶‹åŠ¿åˆ†æï¼ˆæˆåŠŸç‡ã€è€—æ—¶å˜åŒ–ï¼‰

**âœ… å®é™…å®ç°ï¼ˆ2025-12-17ï¼‰**:

**1. æ•°æ®åº“è¡¨** (`modules/core/db/schema.py`)
```python
class ComponentTestHistory(Base):
    """ç»„ä»¶æµ‹è¯•å†å²è®°å½•è¡¨"""
    __tablename__ = "component_test_history"
    
    id = Column(Integer, primary_key=True)
    test_id = Column(String(36), unique=True)  # UUID
    
    # ç»„ä»¶æ ‡è¯†
    component_name = Column(String(100))  # "shopee/login"
    component_version = Column(String(20), nullable=True)  # "1.0.0"
    version_id = Column(Integer, ForeignKey("component_versions.id"))
    
    # æµ‹è¯•é…ç½®
    platform = Column(String(50))
    account_id = Column(String(100))
    headless = Column(Boolean)
    
    # æµ‹è¯•ç»“æœ
    status = Column(String(20))  # passed/failed/cancelled
    duration_ms = Column(Integer)
    steps_total = Column(Integer)
    steps_passed = Column(Integer)
    steps_failed = Column(Integer)
    success_rate = Column(Float)
    
    # è¯¦ç»†ç»“æœï¼ˆJSONå­˜å‚¨ï¼‰
    step_results = Column(JSONB)  # æ¯æ­¥æ‰§è¡Œè¯¦æƒ…
    error_message = Column(Text, nullable=True)
    
    # å®¡è®¡å­—æ®µ
    tested_by = Column(String(100))  # recorder/version_manager
    tested_at = Column(DateTime, default=datetime.utcnow)
```

**2. åç«¯API** (`backend/routers/component_versions.py`)
```python
@router.get("/test-history")
async def get_test_history(
    component_name: Optional[str] = None,  # å¯é€‰ç­›é€‰
    limit: int = 5  # é»˜è®¤5æ¡
):
    """è·å–ç»„ä»¶æµ‹è¯•å†å²è®°å½•"""
    # æŸ¥è¯¢æœ€è¿‘çš„æµ‹è¯•è®°å½•
    history_records = db.query(ComponentTestHistory)\
        .filter(ComponentTestHistory.component_name == component_name if component_name else True)\
        .order_by(ComponentTestHistory.tested_at.desc())\
        .limit(limit)\
        .all()
    
    return {
        "total": total,
        "items": [
            {
                "test_id": h.test_id,
                "component_name": h.component_name,
                "component_version": h.component_version,
                "status": h.status,
                "duration_ms": h.duration_ms,
                "success_rate": h.success_rate,
                "tested_at": h.tested_at.isoformat(),
                "step_results": h.step_results  # è¯¦ç»†æ­¥éª¤
            }
            for h in history_records
        ]
    }
```

**3. è‡ªåŠ¨ä¿å­˜æœºåˆ¶**
- å½•åˆ¶å·¥å…·æµ‹è¯•å®Œæˆåè‡ªåŠ¨ä¿å­˜ï¼ˆ`save_test_history`ï¼‰
- ç‰ˆæœ¬ç®¡ç†é¡µæµ‹è¯•å®Œæˆåè‡ªåŠ¨ä¿å­˜ï¼ˆ`save_test_history`ï¼‰
- ä¿å­˜å†…å®¹åŒ…æ‹¬ï¼šæµ‹è¯•æ—¶é—´ã€çŠ¶æ€ã€è€—æ—¶ã€æ¯æ­¥ç»“æœã€é”™è¯¯ä¿¡æ¯

**4. æ•°æ®å…³è”**
```
ComponentVersion (ç»„ä»¶ç‰ˆæœ¬)
    â†“
ComponentTestHistory (æµ‹è¯•å†å²)
    â†“
PlatformAccount (æµ‹è¯•è´¦å·)
```

**å®ç°æ•ˆæœ**:
- âœ… **è‡ªåŠ¨è®°å½•**: æ¯æ¬¡æµ‹è¯•è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆæ— éœ€ç”¨æˆ·æ“ä½œï¼‰
- âœ… **ç‰ˆæœ¬å…³è”**: æµ‹è¯•å†å²å…³è”åˆ°å…·ä½“ç‰ˆæœ¬ï¼ˆ`version_id`å¤–é”®ï¼‰
- âœ… **è¯¦ç»†è¿½æº¯**: ä¿å­˜æ¯æ­¥æ‰§è¡Œç»“æœã€é”™è¯¯ä¿¡æ¯ã€è€—æ—¶
- âœ… **æ€§èƒ½åˆ†æ**: æ”¯æŒæŒ‰ç»„ä»¶æŸ¥è¯¢å†å²ï¼Œåˆ†ææˆåŠŸç‡è¶‹åŠ¿
- âœ… **å®¡è®¡è¿½è¸ª**: è®°å½•æµ‹è¯•äººã€æµ‹è¯•æ—¶é—´ã€æµ‹è¯•è´¦å·

**æŠ€æœ¯äº®ç‚¹**:
- **JSONBå­˜å‚¨**: æ­¥éª¤ç»“æœä½¿ç”¨JSONBå­˜å‚¨ï¼Œæ”¯æŒé«˜æ•ˆæŸ¥è¯¢å’Œç´¢å¼•
- **å¤–é”®å…³è”**: ä¸`component_versions`è¡¨å…³è”ï¼Œæ”¯æŒçº§è”æŸ¥è¯¢
- **å¯æ‰©å±•æ€§**: é¢„ç•™`browser_info`å­—æ®µï¼Œæœªæ¥å¯å­˜å‚¨æµè§ˆå™¨æŒ‡çº¹ä¿¡æ¯
- **é«˜æ€§èƒ½**: ç´¢å¼•ä¼˜åŒ–ï¼ˆcomponent_name, status, tested_atï¼‰
- **æ•°æ®å®Œæ•´æ€§**: å¤–é”®çº¦æŸ`ON DELETE SET NULL`ï¼Œåˆ é™¤ç‰ˆæœ¬æ—¶å†å²è®°å½•ä¿ç•™

**ä¸‹ä¸€æ­¥ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰**:
- å‰ç«¯UIï¼šæµ‹è¯•å†å²åˆ—è¡¨å±•ç¤ºï¼ˆæ—¶é—´çº¿/è¡¨æ ¼ï¼‰
- è¶‹åŠ¿å›¾è¡¨ï¼šæˆåŠŸç‡å˜åŒ–æ›²çº¿ã€è€—æ—¶åˆ†å¸ƒå›¾
- å¯¹æ¯”åŠŸèƒ½ï¼šä¸åŒç‰ˆæœ¬æµ‹è¯•ç»“æœå¯¹æ¯”
- å¯¼å‡ºåŠŸèƒ½ï¼šæµ‹è¯•æŠ¥å‘Šå¯¼å‡ºï¼ˆPDF/Excelï¼‰

---

#### 18. æ€§èƒ½ä¼˜åŒ–ä¸é«˜çº§åŠŸèƒ½ï¼ˆP1-P2ï¼‰â­ **Phase 9 - å·²å®Œæˆï¼ˆ2025-12-16ï¼‰**

**å®æ–½çŠ¶æ€**:
- âœ… **Phase 8å·²å®Œæˆï¼ˆUIåŒ–ç»„ä»¶å½•åˆ¶å·¥å…·ï¼‰** - 2025-12-16
  - âœ… å‰ç«¯å½•åˆ¶ç•Œé¢ï¼ˆå¹³å°/ç±»å‹/è´¦å·é€‰æ‹©ï¼‰
  - âœ… Playwright Codegené›†æˆï¼ˆè‡ªåŠ¨æ•è·æ“ä½œï¼‰
  - âœ… Python APIè§£æï¼ˆæ”¯æŒget_by_roleè¯­æ³•ï¼‰
  - âœ… YAMLé¢„è§ˆå’Œç¼–è¾‘
  - âœ… æ­¥éª¤é¡ºåºä¿æŒå’Œå»é‡
- âœ… **Phase 9å·²å®Œæˆï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰** - 2025-12-16
  - âœ… å¹¶è¡Œæ‰§è¡Œï¼ˆé€Ÿåº¦æå‡3å€ï¼‰
  - âŒ å¢é‡é‡‡é›†ï¼ˆå·²å–æ¶ˆï¼‰
  - âœ… æ™ºèƒ½é‡è¯•ï¼ˆæˆåŠŸç‡æå‡20%+ï¼‰
  - âœ… ç»„ä»¶ç‰ˆæœ¬ç®¡ç†
- â³ Phase 10è®¡åˆ’ä¸­ï¼ˆAIè‡ªä¿®å¤ - é£é™©è¾ƒå¤§ï¼Œå¾…è¯„ä¼°ï¼‰

**Phase 9å®Œæˆæƒ…å†µ**:
- âœ… Phase 9.1: å¹¶è¡Œæ‰§è¡Œï¼ˆé€Ÿåº¦æå‡3å€ï¼‰
- âŒ Phase 9.2: å¢é‡é‡‡é›†ï¼ˆå·²å–æ¶ˆ - ä¸é€‚ç”¨äºUIæ¨¡æ‹Ÿåœºæ™¯ï¼‰
- âœ… Phase 9.3: æ™ºèƒ½é‡è¯•ï¼ˆæˆåŠŸç‡æå‡20%+ï¼‰
- â³ Phase 9.4: ç‰ˆæœ¬ç®¡ç†ï¼ˆåç»­ä¼˜åŒ–ï¼Œå¯é€‰ï¼‰

**æµ‹è¯•ç»“æœ**: 10/10é€šè¿‡ âœ…

---

##### 18.1 ç»„ä»¶å¹¶è¡Œæ‰§è¡Œï¼ˆP1ï¼‰âœ… **å·²å®Œæˆ**

**èƒŒæ™¯**: å½“å‰æ•°æ®åŸŸé¡ºåºæ‰§è¡Œï¼Œè€—æ—¶é•¿

**ä¼˜åŒ–æ–¹æ¡ˆ**: æ”¯æŒæ•°æ®åŸŸå¹¶è¡Œé‡‡é›†
```python
# å½“å‰: é¡ºåºæ‰§è¡Œ
ç™»å½• â†’ è®¢å•(2åˆ†é’Ÿ) â†’ äº§å“(2åˆ†é’Ÿ) â†’ åº“å­˜(2åˆ†é’Ÿ) = 6åˆ†é’Ÿ

# ä¼˜åŒ–: å¹¶è¡Œæ‰§è¡Œ
ç™»å½• â†’ å¹¶è¡Œé‡‡é›†ï¼ˆè®¢å• | äº§å“ | åº“å­˜ï¼‰= 2åˆ†é’Ÿ
```

**å®ç°**:
```python
async def execute_parallel_domains(task_id, domains):
    tasks = []
    for domain in domains:
        # æ¯ä¸ªåŸŸä½¿ç”¨ç‹¬ç«‹çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡ï¼ˆå…±äº«ç™»å½•Cookieï¼‰
        task = execute_domain_with_context(domain, shared_cookies)
        tasks.append(task)
    
    results = await asyncio.gather(*tasks, return_exceptions=True)
    return results
```

**é…ç½®**:
```yaml
# ç»„ä»¶é…ç½®æ”¯æŒå¹¶è¡Œæ ‡è¯†
parallel_safe: true  # æ ‡è®°è¯¥åŸŸæ”¯æŒå¹¶è¡Œé‡‡é›†
```

**é¢„æœŸæ”¶ç›Š**: å¤šåŸŸé‡‡é›†é€Ÿåº¦æå‡ **3å€**

**å®æ–½è¿›åº¦**:
- âœ… ç»„ä»¶é…ç½®å¢å¼ºï¼ˆæ·»åŠ `parallel_safe`æ ‡è¯†ï¼‰
- ğŸ”„ Executorå¹¶è¡Œæ‰§è¡Œå¼•æ“å¼€å‘ä¸­
- â³ æµè§ˆå™¨ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆå¾…å®æ–½ï¼‰
- â³ Cookieå…±äº«æœºåˆ¶ï¼ˆå¾…å®æ–½ï¼‰
- â³ å¹¶å‘æ§åˆ¶ä¸é”™è¯¯éš”ç¦»ï¼ˆå¾…å®æ–½ï¼‰

---

##### 18.2 å¢é‡é‡‡é›†æ”¯æŒï¼ˆP1ï¼‰âŒ **å·²å–æ¶ˆ - ä¸é€‚ç”¨äºUIæ¨¡æ‹Ÿåœºæ™¯**

**å–æ¶ˆæ—¥æœŸ**: 2025-12-16  
**å–æ¶ˆåŸå› **: ç»ç”¨æˆ·è´¨ç–‘åˆ†æåå‘ç°ï¼Œå¢é‡é‡‡é›†ä¸é€‚ç”¨äºå½“å‰çš„UIæ¨¡æ‹Ÿ+æ–‡ä»¶ä¸‹è½½æ¶æ„

**ä¸ºä»€ä¹ˆä¸é€‚ç”¨**:

1. **UIæ¨¡æ‹Ÿ vs APIç›´è¿**
   ```
   âŒ å¢é‡é‡‡é›†é€‚ç”¨åœºæ™¯ï¼šAPIç›´è¿
   GET /api/products?updated_after=2025-12-01
   â†’ è¿”å›ï¼šæœ€è¿‘æ›´æ–°çš„æ•°æ®
   
   âœ… æˆ‘ä»¬çš„å®é™…åœºæ™¯ï¼šUIæ¨¡æ‹Ÿ
   - æ—¥æœŸé€‰æ‹©å™¨é€‰æ‹©çš„æ˜¯"ä¸šåŠ¡æ—¥æœŸ"ï¼ˆè®¢å•æ—¥æœŸã€ç»Ÿè®¡æ—¥æœŸï¼‰
   - ä¸æ˜¯"æ•°æ®æ›´æ–°æ—¶é—´"
   - å¹³å°UIæ²¡æœ‰"æ›´æ–°æ—¶é—´"ç­›é€‰å™¨
   ```

2. **å¹³å°UIé™åˆ¶**
   - Shopee/TikTok/å¦™æ‰‹ERPçš„å–å®¶ä¸­å¿ƒUIæ˜¯ä¸ºä¸šåŠ¡äººå‘˜è®¾è®¡çš„
   - åªæä¾›ä¸šåŠ¡ç›¸å…³çš„ç­›é€‰å™¨ï¼ˆåˆ›å»ºæ—¥æœŸã€è®¢å•æ—¥æœŸã€äº§å“çŠ¶æ€ï¼‰
   - ä¸æä¾›æŠ€æœ¯æ€§çš„"æ›´æ–°æ—¶é—´"ç­›é€‰å™¨

3. **å»é‡å·²ç”±æ•°æ®åŒæ­¥æ¨¡å—å¤„ç†**
   - æ•°æ®åŒæ­¥æ¨¡å—å·²ç»è´Ÿè´£å»é‡
   - è™½ç„¶å¢é‡å¯ä»¥å‡å°‘å»é‡å‹åŠ›ï¼Œä½†åœ¨æ— æ³•é€‰æ‹©"æ›´æ–°æ—¶é—´"çš„æƒ…å†µä¸‹æ— æ³•å®ç°

**å·²å®æ–½ä½†ä¿ç•™çš„å†…å®¹**:
- âœ… CollectionSyncPointè¡¨ï¼ˆå·²åˆ›å»ºè¿ç§»è„šæœ¬ï¼Œä¿ç•™ä»¥ç»´æŠ¤è¿ç§»å†å²å®Œæ•´æ€§ï¼‰
- âœ… SyncPointServiceæœåŠ¡ï¼ˆä¿ç•™ï¼Œå¯èƒ½æœªæ¥æœ‰å…¶ä»–ç”¨é€”ï¼‰

**å·²åˆ é™¤çš„å†…å®¹**:
- âŒ products_export_incremental.yamlï¼ˆå¢é‡ç»„ä»¶é…ç½®ï¼‰
- âŒ ç›¸å…³æµ‹è¯•å’Œæ–‡æ¡£ï¼ˆå·²å½’æ¡£åˆ°archived_*æ–‡ä»¶ï¼‰

**è¯¦ç»†è¯´æ˜**: å‚è§ `temp/development/PHASE9_2_CANCELLED_EXPLANATION.md`

---

##### 18.3 æ™ºèƒ½é‡è¯•å’Œé™çº§ç­–ç•¥ï¼ˆP0ï¼‰â­ **å·²å®Œæˆ - 2025-12-16**

**èƒŒæ™¯**: å½“å‰åªé‡è¯•1æ¬¡ï¼Œä¸å¤Ÿæ™ºèƒ½

**æµ‹è¯•ç»“æœ**: 5/5é€šè¿‡ âœ…

**ä¼˜åŒ–æ–¹æ¡ˆ**: å¤šå±‚é™çº§ç­–ç•¥
```yaml
# ç»„ä»¶çº§é‡è¯•é…ç½®
retry:
  max_attempts: 3
  backoff_strategy: exponential  # 1s, 2s, 4s
  
  fallback:
    - component: "shopee/products_export_simple"  # å¤‡ç”¨ç»„ä»¶
    - action: skip  # è·³è¿‡è¯¥åŸŸ
    - action: notify_admin

# æ­¥éª¤çº§å¤‡ç”¨æ–¹æ¡ˆ
steps:
  - action: click
    selector: "#export_button"
    on_failure:
      - try: "#export_button_v2"
      - try: "button:has-text('å¯¼å‡º')"
      - fallback: screenshot_and_fail
```

**é¢„æœŸæ”¶ç›Š**: æˆåŠŸç‡æå‡ **20%+**

**å®æ–½è¿›åº¦**:
- âœ… é‡è¯•ç­–ç•¥é…ç½®è§£æ
- âœ… æŒ‡æ•°é€€é¿ç®—æ³•
- âœ… ç»„ä»¶çº§é™çº§æœºåˆ¶
- âœ… æ­¥éª¤çº§å¤‡ç”¨æ–¹æ¡ˆ
- âœ… RetryStrategyæœåŠ¡
- âœ… ComponentFallbackStrategyæœåŠ¡

**æ ¸å¿ƒæ–‡ä»¶**:
- `modules/apps/collection_center/retry_strategy.py` - æ™ºèƒ½é‡è¯•æœåŠ¡
- `config/collection_components/shopee/orders_export_with_retry.yaml` - ç¤ºä¾‹ç»„ä»¶

---

##### 18.4 ç»„ä»¶ç‰ˆæœ¬ç®¡ç†ï¼ˆP1ï¼‰âœ… **å·²å®Œæˆ - 2025-12-16**

**èƒŒæ™¯**: ç»„ä»¶æ›´æ–°æ—¶ç›´æ¥è¦†ç›–ï¼Œæ— æ³•å›æ»š

**ä¼˜åŒ–æ–¹æ¡ˆ**: ç‰ˆæœ¬åŒ–ç®¡ç† + A/Bæµ‹è¯•
```
config/collection_components/shopee/
â”œâ”€â”€ login_v1.0.yaml
â”œâ”€â”€ login_v1.1.yaml  # æ–°ç‰ˆæœ¬
â”œâ”€â”€ login.yaml -> login_v1.0.yaml  # ç¬¦å·é“¾æ¥
```

**æ•°æ®åº“è®°å½•**:
```python
class ComponentVersion(Base):
    component_name = Column(String(100))
    version = Column(String(20))
    success_rate = Column(Float)  # è‡ªåŠ¨ç»Ÿè®¡
    usage_count = Column(Integer)
    is_stable = Column(Boolean)
```

**A/Bæµ‹è¯•**:
```python
# 10%æµé‡ä½¿ç”¨æ–°ç‰ˆæœ¬
if random.random() < 0.1:
    component = load_component("login_v1.1.yaml")
else:
    component = load_component("login_v1.0.yaml")
```

**æµ‹è¯•ç»“æœ**: 5/5é€šè¿‡ âœ…

**é¢„æœŸæ”¶ç›Š**: å®‰å…¨å‡çº§ + å¿«é€Ÿå›æ»š

**å®æ–½è¿›åº¦**:
- âœ… ComponentVersionæ•°æ®åº“è¡¨
- âœ… ComponentVersionServiceæœåŠ¡
- âœ… ç‰ˆæœ¬åŒ–ç»„ä»¶ï¼ˆlogin_v1.0, login_v1.1ï¼‰
- âœ… A/Bæµ‹è¯•æµé‡åˆ†é…
- âœ… è‡ªåŠ¨ç»Ÿè®¡æˆåŠŸç‡
- âœ… æå‡/å›æ»šæœºåˆ¶

**æ ¸å¿ƒæ–‡ä»¶**:
- `modules/core/db/schema.py` - ComponentVersionè¡¨
- `backend/services/component_version_service.py` - ç‰ˆæœ¬ç®¡ç†æœåŠ¡
- `config/collection_components/shopee/login_v1.0.yaml` - ç¨³å®šç‰ˆæœ¬ç¤ºä¾‹
- `config/collection_components/shopee/login_v1.1.yaml` - æµ‹è¯•ç‰ˆæœ¬ç¤ºä¾‹
- `migrations/versions/20251216_phase9_4_*.py` - è¿ç§»è„šæœ¬

**è¯¦ç»†æ–‡æ¡£**: `temp/development/PHASE9_ALL_COMPLETE_SUMMARY.md`

---

##### 18.5 é‡‡é›†æ•°æ®å®æ—¶é¢„è§ˆï¼ˆP2ï¼‰â­ **æœªæ¥ä¼˜åŒ–**

**èƒŒæ™¯**: ç”¨æˆ·çœ‹ä¸åˆ°é‡‡é›†çš„æ•°æ®å†…å®¹

**ä¼˜åŒ–æ–¹æ¡ˆ**: WebSocketæ¨é€æ•°æ®é¢„è§ˆ
```javascript
{
  "type": "data_preview",
  "task_id": "xxx",
  "domain": "orders",
  "preview": [
    {"order_id": "12345", "amount": 100.50},
    ...
  ],
  "total_rows": 150
}
```

**å‰ç«¯å±•ç¤º**: å®æ—¶è¡¨æ ¼é¢„è§ˆ

---

##### 18.6 æ™ºèƒ½è°ƒåº¦ä¼˜åŒ–ï¼ˆP2ï¼‰â­ **æœªæ¥ä¼˜åŒ–**

**ä¼˜åŒ–æ–¹æ¡ˆ**: 
- åˆ†æå†å²é‡‡é›†æ—¶é—´ï¼Œè‡ªåŠ¨è°ƒæ•´è°ƒåº¦
- é¿å¼€é«˜å³°æœŸ
- ä¾èµ–ä»»åŠ¡æ’åº
- èµ„æºé¢„ç•™
- ä¼˜å…ˆçº§é˜Ÿåˆ—

**é¢„æœŸæ”¶ç›Š**: èµ„æºåˆ©ç”¨ç‡æå‡ **30%**

---

## é¢„æœŸæ”¶ç›Š

### æŠ€æœ¯æ”¶ç›Š
1. **é«˜å¯ç»´æŠ¤æ€§**ï¼šç½‘ç«™æ›´æ–°åªéœ€ä¿®æ”¹å•ä¸ªç»„ä»¶ï¼Œä¸å½±å“å…¶ä»–ç»„ä»¶
2. **ä½å½•åˆ¶æˆæœ¬**ï¼šç»„ä»¶å¤ç”¨å¤§å¹…å‡å°‘å½•åˆ¶å·¥ä½œé‡ï¼ˆ45+ è„šæœ¬ â†’ 27 ç»„ä»¶ï¼‰
3. **Agent å‹å¥½**ï¼šYAML é…ç½®ç»“æ„åŒ–ï¼Œä¾¿äº AI ç†è§£å’Œä¿®æ”¹
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¸€è´¦å·ä¸€ä»»åŠ¡ç²’åº¦ï¼Œæµè§ˆå™¨å¤ç”¨ï¼Œå‡å°‘å¯åŠ¨å¼€é”€60%+ â­
5. **å®¹é”™å¢å¼º**ï¼šéƒ¨åˆ†æˆåŠŸæœºåˆ¶ï¼Œå•åŸŸå¤±è´¥ä¸å½±å“å…¶ä»–åŸŸç»§ç»­æ‰§è¡Œ â­
6. **äº‘ç«¯éƒ¨ç½²å°±ç»ª**ï¼šå®Œæˆ Docker headless é€‚é…ï¼Œæ”¯æŒäº‘ç«¯éƒ¨ç½²
7. **ç³»ç»Ÿå¯é æ€§**ï¼šèµ„æºè‡ªåŠ¨æ¸…ç†ã€å¹¶å‘å®‰å…¨ã€å¥åº·ç›‘æ§ï¼Œä¿éšœç¨³å®šè¿è¡Œ
8. **æ˜¾å¼éªŒè¯**ï¼šæˆåŠŸæ ‡å‡†éªŒè¯æœºåˆ¶ï¼Œå¯é æ€§æå‡è‡³99%+ â­â­â­ **NEW**
9. **æ•°æ®å‡†ç¡®æ€§**ï¼šæ™ºèƒ½åº—é“ºåˆ‡æ¢ï¼Œå¤šåº—é“ºè´¦å·100%å‡†ç¡® â­â­â­ **NEW**
10. **å¹¶è¡Œé‡‡é›†**ï¼šå¤šåŸŸå¹¶è¡Œæ‰§è¡Œï¼Œé‡‡é›†é€Ÿåº¦æå‡3å€ â­ **NEW**
11. **å¢é‡åŒæ­¥**ï¼šåŸºäºæ—¶é—´æˆ³çš„å¢é‡é‡‡é›†ï¼Œæ•ˆç‡æå‡10å€+ â­ **NEW**
12. **æ™ºèƒ½é™çº§**ï¼šå¤šå±‚é‡è¯•å’Œå¤‡ç”¨ç­–ç•¥ï¼ŒæˆåŠŸç‡æå‡20%+ â­ **NEW**
13. **ç‰ˆæœ¬ç®¡ç†**ï¼šç»„ä»¶ç‰ˆæœ¬åŒ–ï¼Œå®‰å…¨å‡çº§å’Œå¿«é€Ÿå›æ»š â­ **NEW**
14. **AIè‡ªä¿®å¤**ï¼šè‡ªåŠ¨é€‚åº”å¹³å°å˜æ›´ï¼Œç»´æŠ¤æˆæœ¬é™ä½80% â­ **NEW**

### ç”¨æˆ·ä½“éªŒæ”¶ç›Š
15. **é›¶é…ç½®å…¥é—¨**ï¼šå¿«é€Ÿé…ç½®åŠŸèƒ½ï¼Œ3æ­¥å®Œæˆæ ‡å‡†å®šæ—¶é‡‡é›†é…ç½® â­
16. **å‘½åè§„èŒƒç»Ÿä¸€**ï¼šè‡ªåŠ¨ç”Ÿæˆé…ç½®åç§°ï¼Œé¿å…æ‰‹åŠ¨è¾“å…¥é”™è¯¯ â­
17. **æ—¥æœŸé€‰æ‹©å¯¹é½**ï¼šä¸å¹³å°æ§ä»¶ä¸€è‡´ï¼Œç¬¦åˆç”¨æˆ·å¿ƒæ™ºæ¨¡å‹ â­
18. **çµæ´»å­åŸŸé€‰æ‹©**ï¼šæ”¯æŒå¤šé€‰+å…¨é€‰ï¼Œé€‚åº”ä¸åŒé‡‡é›†éœ€æ±‚ â­
19. **å½•åˆ¶å·¥å…·å‹å¥½**ï¼šå‰ç«¯ç”Ÿæˆå‘½ä»¤ä¸€é”®å¤åˆ¶ï¼Œé™ä½ä½¿ç”¨é—¨æ§› â­
20. **å‰ç«¯å¯è§†åŒ–ç®¡ç†**ï¼šç®¡ç†å‘˜å¯é€šè¿‡ Web ç•Œé¢é…ç½®å’Œç›‘æ§é‡‡é›†ä»»åŠ¡
21. **å®æ—¶çŠ¶æ€æ„ŸçŸ¥**ï¼šé€šè¿‡ WebSocket å®æ—¶æŸ¥çœ‹é‡‡é›†è¿›åº¦ï¼ˆå«æ•°æ®åŸŸç»´åº¦ï¼‰â­
22. **GUIå½•åˆ¶å·¥å…·**ï¼šå‰ç«¯ç•Œé¢å½•åˆ¶ç»„ä»¶ï¼Œç”¨æˆ·ä½“éªŒæå‡10å€ â­â­ **âœ… å·²å®Œæˆ (2025-12-16)**
23. **æ•°æ®å®æ—¶é¢„è§ˆ**ï¼šé‡‡é›†è¿‡ç¨‹ä¸­å®æ—¶æŸ¥çœ‹æ•°æ®å†…å®¹ â­ **NEW**

### è¿ç»´æ”¶ç›Š
24. **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šæ ‡å‡†å®šæ—¶è°ƒåº¦ï¼ˆæ—¥åº¦4æ¬¡+å‘¨åº¦+æœˆåº¦ï¼‰ï¼Œå‡å°‘äººå·¥å¹²é¢„ â­
25. **é¢„è®¡ä»»åŠ¡å¯è§**ï¼šå¿«é€Ÿé…ç½®æ—¶æ˜¾ç¤ºé¢„è®¡ä»»åŠ¡æ•°ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½ â­
26. **è¿œç¨‹éªŒè¯ç å¤„ç†**ï¼šæ”¯æŒåœ¨ Docker ç¯å¢ƒä¸­å¤„ç†éªŒè¯ç 
27. **å¼¹çª—è‡ªåŠ¨å¤„ç†**ï¼šä¸‰å±‚å¼¹çª—å¤„ç†æœºåˆ¶ï¼Œè‡ªåŠ¨å…³é—­æ„å¤–å¼¹çª—ï¼Œå‡å°‘é‡‡é›†å¤±è´¥
28. **è´¦å·å®‰å…¨**ï¼šè´¦å·æ•æ„Ÿä¿¡æ¯ä¸å…¥åº“ï¼ŒAPIè¿”å›è„±æ•ä¿¡æ¯ï¼Œç¬¦åˆå®‰å…¨è§„èŒƒ
29. **WebSocketå®‰å…¨**ï¼šJWT Tokenè®¤è¯ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®ä»»åŠ¡çŠ¶æ€
30. **æ™ºèƒ½è°ƒåº¦**ï¼šè‡ªåŠ¨é¿å³°ã€èµ„æºä¼˜åŒ–ã€ä¾èµ–æ’åºï¼Œåˆ©ç”¨ç‡æå‡30% â­ **NEW**

### é‡åŒ–æŒ‡æ ‡
| æŒ‡æ ‡ | å½“å‰ | ä¼˜åŒ–å | æå‡ | çŠ¶æ€ |
|------|------|--------|------|------|
| é‡‡é›†å¯é æ€§ | 75% | 99%+ | +24% â­â­â­ | âœ… |
| æ•°æ®å‡†ç¡®æ€§ï¼ˆå¤šåº—é“ºï¼‰ | 60% | 100% | +40% â­â­â­ | âœ… |
| å¤šåŸŸé‡‡é›†é€Ÿåº¦ | åŸºå‡† | 3å€ | +200% â­ | âœ… |
| å¢é‡é‡‡é›†æ•ˆç‡ | åŸºå‡† | N/A | å·²å–æ¶ˆ | âŒ |
| æˆåŠŸç‡ | 80% | 96%+ | +16% â­ | âœ… |
| ç»´æŠ¤æˆæœ¬ï¼ˆAIè‡ªä¿®å¤ï¼‰ | åŸºå‡† | -80% | èŠ‚çœ80% â­ | â³ |
| **å½•åˆ¶æ“ä½œæ•è·ç‡** | **30%** | **100%** | **+70%** â­â­ | **âœ… (Phase 8)** |
| **å½•åˆ¶å·¥å…·æ˜“ç”¨æ€§** | **å‘½ä»¤è¡Œ** | **GUIç•Œé¢** | **10å€** â­â­ | **âœ… (Phase 8)** |
| **Windowså…¼å®¹æ€§** | **å¤±è´¥** | **å®Œå…¨å…¼å®¹** | **100%** â­ | **âœ… (Phase 8)** |
